---
title: 第 1 章 - Azure RTOS NetX Point-to-Point プロトコル (PPP) の概要
description: 通常、NetX アプリケーションは、イーサネット経由で実際の物理ネットワークに接続します。
author: philmea
ms.author: philmea
ms.date: 06/04/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 9f8cd9e6e0ab086fcbf76df890c03f8d73aa1a99
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/22/2021
ms.locfileid: "104811474"
---
# <a name="chapter-1---introduction-to-the-azure-rtos-netx-point-to-point-protocol-ppp"></a>第 1 章 - Azure RTOS NetX Point-to-Point プロトコル (PPP) の概要

通常、NetX アプリケーションは、イーサネット経由で実際の物理ネットワークに接続します。 これにより、高速かつ効率的なネットワーク アクセスが提供されます。 ただし、アプリケーションがイーサネットにアクセスできない場合もあります。 このような場合でも、アプリケーションは、別のネットワーク メンバーに直接接続されたシリアル インターフェイスを介してネットワークに接続できます。 このような接続の管理に使用される最も一般的なソフトウェア プロトコルが Point-to-Point プロトコル (PPP) です。

シリアル通信は比較的単純ですが、PPP はやや複雑です。 実際には、PPP はリンク制御プロトコル (LCP)、インターネット プロトコル制御プロトコル (IPCP)、パスワード認証プロトコル (PAP)、チャレンジ ハンドシェイク認証プロトコル (CHAP) などの複数のプロトコルで構成されています。 LCP は PPP の主要プロトコルです。 ここで、リンクの基本コンポーネントがピアツーピア方式で動的にネゴシエートされます。 リンクの基本特性が正常にネゴシエートされたら、PAP や CHAP を使用して、接続されたピアが有効であることが確認されます。 両方のピアが有効であれば、IPCP を使用して、ピアが使用する IP アドレスがネゴシエートされます。 IPCP が完了すると、PPP で IP パケットを送受信できるようになります。

NetX では、PPP は主にデバイス ドライバーと見なされます。 *nx_ppp_driver* 関数は、NetX IP 作成関数の *nx_ip_create* に提供されます。 それ以外の場合、NetX では PPP は直接認識されません。

## <a name="ppp-serial-communication"></a>PPP シリアル通信

NetX PPP パッケージでは、アプリケーションでシリアル通信ドライバーを提供する必要があります。 ドライバーでは 8 ビット文字をサポートしている必要があり、ソフトウェア フロー制御を使用する場合もあります。 ドライバーの初期化はアプリケーションの役割であり、PPP インスタンスを作成する前に実行する必要があります。

PPP パケットを送信するには、シリアル ドライバー バイト出力ルーチンを PPP に提供する必要があります (*nx_ppp_create* 関数で指定)。 このシリアル ドライバー バイト出力ルーチンは、PPP パケット全体を送信するために繰り返し呼び出されます。 シリアル ドライバーは、出力をバッファー処理する役割を担います。 受信側では、アプリケーションのシリアル ドライバーは、新しいバイトが到着するたびに、PPP の *nx_ppp_byte_receive* 関数を呼び出す必要があります。 通常、これは割り込みサービス ルーチン (ISR) のコンテキスト内から実行されます。 *nx_ppp_byte_receive* 関数により、受信バイトが循環バッファーに配置され、その存在が PPP 受信スレッドに通知されます。

## <a name="ppp-over-ethernet-communication"></a>PPP over Ethernet 通信

NetX PPP では、イーサネット経由で PPP メッセージを送信することもできます。この場合、NetX PPP パッケージでは、アプリケーションでイーサネット通信ドライバーを提供する必要があります。

PPP パケットをイーサネット経由で送信するには、出力ルーチンを PPP に提供する必要があります (*nx_ppp_packet_send_set* 関数で指定)。 この出力ルーチンは、PPP パケット全体を送信するために繰り返し呼び出されます。 受信側では、アプリケーションの受信者は、新しいバイトが到着するたびに、PPP の *nx_ppp_packet_receive* 関数を呼び出す必要があります。

## <a name="ppp-packet"></a>PPP パケット

PPP では、AHDLC フレーミング (HDLC のサブセット) を利用して、すべての PPP プロトコル制御とユーザー データをカプセル化します。 AHDLC フレームは次のようになります。

|**フラグ**|**Addr**|**Ctrl**|**情報**|**CRC**|**フラグ**|
|--------|--------|--------|---------------|-------|--------|
|7E |FF|03|[0 - 1502 バイト]|2 バイト| 7E|

どの PPP フレームも、全体的な外観はこのようになります。 情報フィールドの最初の 2 バイトには、PPP プロトコルの種類が含まれます。 有効な値は次のように定義されています。

- C021: LCP
- 8021: IPCP
- C023: PAP
- C223: CHAP
- 0021: IP データ パケット

プロトコルの種類として 0x0021 が存在する場合、すぐ後に IP パケットが続きます。 他のプロトコルのいずれかが存在する場合は、次のバイトがその特定のプロトコルに対応します。

一意の 0x7E 開始/終了フレーム マーカーを確保し、ソフトウェア フロー制御をサポートするために、AHDLC ではエスケープ シーケンスを使用してさまざまなバイト値を表します。 0x7D 値は、次の文字がエンコードされることを示します。基本的には、元の文字が 0x20 と排他的論理和されます。 たとえば、ヘッダーの Ctrl フィールドの 0x03 値は、2 バイト シーケンスの 7D 23 で表されます。 既定では、0x20 未満の値はエスケープ シーケンスに変換され、0x7E および 0x7D の値は情報フィールドにあります。 エスケープ シーケンスは、CRC フィールドにも適用されることに注意してください。

## <a name="link-control-protocol-lcp"></a>リンク制御プロトコル (LCP)

LCP はプライマリ PPP プロトコルであり、最初に実行されるプロトコルです。 LCP は、Maximum Receive Unit (MRU) や使用する認証プロトコル (PAP、CHAP、またはなし) など、さまざまな PPP パラメーターをネゴシエートする役割を担います。 LCP の両側が PPP パラメーターについて同意すると、認証プロトコル (存在する場合) の実行が開始されます。

## <a name="password-authentication-protocol-pap"></a>パスワード認証プロトコル (PAP)

PAP は、接続の一方の側から提供される名前とパスワード (LCP 中にネゴシエートされます) を利用する比較的単純なプロトコルです。 その後、もう一方の側がこの情報を確認します。 正しい場合は、送信側に受け入れメッセージが返され、PPP は IPCP ステート マシンに進むことができます。 名前またはパスワードが正しくない場合、接続は拒否されます。

>[!NOTE]
> インターフェイスの両側で PAP を要求できますが、通常、PAP は一方向でのみ使用されます。

## <a name="challenge-handshake-authentication-protocol-chap"></a>チャレンジ ハンドシェイク認証プロトコル (CHAP)

CHAP は、PAP よりも複雑な認証プロトコルです。 CHAP 認証子は、ピアに名前と値を提供します。 ピアでは提供された名前を使用して、2 つのエンティティ間で共有される "シークレット" を見つけます。 その後、ID、値、"シークレット" に対して計算が実行されます。 この計算の結果が応答で返されます。 正しい場合、PPP は IPCP ステート マシンに進むことができます。 結果が正しくない場合、接続は拒否されます。

CHAP のもう 1 つの興味深い点は、接続が確立された後に、ランダムな間隔で実行できることです。 これを使用して、認証後に接続がハイジャックされるのを防ぐことができます。 これらのランダムな時間のいずれかでチャレンジが失敗すると、接続は即座に終了します。

>[!NOTE]
> インターフェイスの両側で CHAP を要求できますが、通常、CHAP は一方向でのみ使用されます。

## <a name="internet-protocol-control-protocol-ipcp"></a>インターネット プロトコル制御プロトコル (IPCP)

IPCP は、PPP 通信を NetX IP データ転送に使用できるようになる前に実行される最後のプロトコルです。 このプロトコルの主な目的は、一方のピアがもう一方に IP アドレスを通知することです。 IP アドレスが設定されたら、NetX IP データ転送が有効になります。

## <a name="data-transfer"></a>データ転送

前述のように、NetX IP データ パケットは、プロトコル ID が 0x0021 の PPP フレームに存在します。 受信したすべてのデータ パケットは、1 つ以上の NX_PACKET 構造体に配置され、NetX 受信処理に転送されます。 送信時には、NetX パケットの内容が AHDLC フレームに配置されて送信されます。

## <a name="ppp-rfcs"></a>PPP RFC

NetX PPP は、RFC1332、RFC1334、RFC1661、RFC1994、および関連する RFC に準拠しています。