---
title: 第 3 章 - USBX ホスト スタックの機能コンポーネント
description: この章では、ハイ パフォーマンスの USBX 埋め込み USB ホスト スタックについて、機能の観点から説明します。
author: philmea
ms.author: philmea
ms.date: 5/19/2020
ms.service: rtos
ms.topic: article
ms.openlocfilehash: 17b8d884dd2c71d60e91f5fcec40c360060f4fe8
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/22/2021
ms.locfileid: "104813184"
---
# <a name="chapter-3---functional-components-of-usbx-host-stack"></a><span data-ttu-id="7b5c3-103">第 3 章 - USBX ホスト スタックの機能コンポーネント</span><span class="sxs-lookup"><span data-stu-id="7b5c3-103">Chapter 3 - Functional Components of USBX Host Stack</span></span>

<span data-ttu-id="7b5c3-104">この章では、ハイ パフォーマンスの USBX 埋め込み USB ホスト スタックについて、機能の観点から説明します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-104">This chapter contains a description of the high performance USBX embedded USB host stack from a functional perspective.</span></span>

## <a name="execution-overview"></a><span data-ttu-id="7b5c3-105">実行の概要</span><span class="sxs-lookup"><span data-stu-id="7b5c3-105">Execution Overview</span></span>

<span data-ttu-id="7b5c3-106">USBX は、以下の複数のコンポーネントで構成されています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-106">USBX is composed of several components:</span></span>

- <span data-ttu-id="7b5c3-107">初期化</span><span class="sxs-lookup"><span data-stu-id="7b5c3-107">Initialization</span></span>
- <span data-ttu-id="7b5c3-108">アプリケーション インターフェイスの呼び出し</span><span class="sxs-lookup"><span data-stu-id="7b5c3-108">Application interface calls</span></span>
- <span data-ttu-id="7b5c3-109">ルート ハブ</span><span class="sxs-lookup"><span data-stu-id="7b5c3-109">Root Hub</span></span>
- <span data-ttu-id="7b5c3-110">ハブ クラス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-110">Hub Class</span></span>
- <span data-ttu-id="7b5c3-111">ホスト クラス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-111">Host Classes</span></span>
- <span data-ttu-id="7b5c3-112">USB ホスト スタック</span><span class="sxs-lookup"><span data-stu-id="7b5c3-112">USB Host Stack</span></span>
- <span data-ttu-id="7b5c3-113">ホスト コントローラー</span><span class="sxs-lookup"><span data-stu-id="7b5c3-113">Host controller</span></span>

<span data-ttu-id="7b5c3-114">次の図は、USBX ホスト スタックを示しています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-114">The following diagram illustrates the USBX host stack.</span></span>

![USBX ホスト スタック](./media/usbx-host-stack/usbx-host-stack.png)

### <a name="initialization"></a><span data-ttu-id="7b5c3-116">初期化</span><span class="sxs-lookup"><span data-stu-id="7b5c3-116">Initialization</span></span>

<span data-ttu-id="7b5c3-117">USBX をアクティブにするには、関数 ***ux_system_initialize*** を呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-117">In order to activate USBX, the function ***ux_system_initialize*** must be called.</span></span> <span data-ttu-id="7b5c3-118">この関数により、USBX のメモリ リソースが初期化されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-118">This function initializes the memory resources of USBX.</span></span>

<span data-ttu-id="7b5c3-119">USBX ホスト機能をアクティブにするには、関数 ***ux_host_stack_initialize*** を呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-119">In order to activate USBX host facilities, the function ***ux_host_stack_initialize*** must be called.</span></span> <span data-ttu-id="7b5c3-120">この関数により、ThreadX ホスト スタックによって使用されるすべてのリソース (ThreadX スレッド、ミューテックス、セマフォなど) が初期化されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-120">This function will in turn initialize all the resources used by the USBX host stack such as ThreadX threads, mutexes, and semaphores.</span></span>

<span data-ttu-id="7b5c3-121">少なくとも 1 つの USB ホスト コントローラーと 1 つ以上の USB クラスをアクティブにするには、アプリケーションの初期化が必要です。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-121">It is up to the application initialization to activate at least one USB host controller and one or more USB classes.</span></span> <span data-ttu-id="7b5c3-122">スタックにクラスが登録され、ホスト コントローラー初期化関数が呼び出されると、バスがアクティブになり、デバイスの検出を開始できます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-122">When the classes have been registered to the stack and the host controller(s) initialization function has been called the bus is active and device discovery can start.</span></span> <span data-ttu-id="7b5c3-123">接続されているデバイスがホスト コントローラーのルート ハブによって検出されると、USB トポロジを担当する USB 列挙スレッドがウェイク アップし、デバイスの列挙に進みます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-123">If the root hub of the host controller detects an attached device, the USB enumeration thread, in charge of the USB topology, will be wake up and proceed to enumerate the device(s).</span></span>

<span data-ttu-id="7b5c3-124">ルート ハブと下流ハブの性質上、ホスト コントローラー初期化関数から制御が戻ったときに、接続されているすべての USB デバイスがまだ完全に構成されていない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-124">It is possible, due to the nature of the root hub and downstream hubs, that all attached USB devices may not have been configured completely when the host controller initialization function returns.</span></span> <span data-ttu-id="7b5c3-125">特にルート ハブと USB デバイスの間に 1 つ以上のハブがある場合、すべての USB デバイスを列挙するのに数秒かかることがあります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-125">It can take several seconds to enumerate all USB devices, especially if there are one or more hubs between the root hub and USB devices.</span></span>

### <a name="application-interface-calls"></a><span data-ttu-id="7b5c3-126">アプリケーション インターフェイスの呼び出し</span><span class="sxs-lookup"><span data-stu-id="7b5c3-126">Application Interface Calls</span></span>

<span data-ttu-id="7b5c3-127">USBX には、2 つのレベルの API があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-127">There are two levels of APIs in USBX.</span></span>

- <span data-ttu-id="7b5c3-128">USB ホスト スタック API</span><span class="sxs-lookup"><span data-stu-id="7b5c3-128">USB Host Stack APIs</span></span>
- <span data-ttu-id="7b5c3-129">USB ホスト クラス API</span><span class="sxs-lookup"><span data-stu-id="7b5c3-129">USB Host Class APIs</span></span>

<span data-ttu-id="7b5c3-130">通常、USBX アプリケーションでは、どの USB ホスト スタック API 関数も呼び出す必要はありません。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-130">Normally, a USBX application should not have to call any of the USB host stack API functions.</span></span> <span data-ttu-id="7b5c3-131">ほとんどのアプリケーションは、USB クラス API 関数にのみアクセスします。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-131">Most applications will only access the USB Class API functions.</span></span>

### <a name="usb-host-stack-apis"></a><span data-ttu-id="7b5c3-132">USB ホスト スタック API</span><span class="sxs-lookup"><span data-stu-id="7b5c3-132">USB Host Stack APIs</span></span>

<span data-ttu-id="7b5c3-133">ホスト スタック API 関数は、USBX コンポーネント (ホスト クラスとホスト コントローラー) の登録、デバイスの構成、および使用可能なデバイス エンドポイントの転送要求を担当します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-133">The host stack API functions are responsible for the registration of USBX components (host classes and host controllers), configuration of devices, and the transfer requests for available device endpoints.</span></span>

### <a name="usb-host-class-api"></a><span data-ttu-id="7b5c3-134">USB ホスト クラス API</span><span class="sxs-lookup"><span data-stu-id="7b5c3-134">USB Host Class API</span></span>

<span data-ttu-id="7b5c3-135">クラス API は、USB クラスごとに非常に特化しています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-135">The Class APIs are very specific to each USB class.</span></span> <span data-ttu-id="7b5c3-136">USB クラス用の一般的な API 関数の多くは、デバイスのオープン/クローズ、デバイスとの読み書きなどのサービスを提供します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-136">Most of the common API functions for USB classes provide services such as opening/closing a device and reading from and writing to a device.</span></span>

### <a name="root-hub"></a><span data-ttu-id="7b5c3-137">ルート ハブ</span><span class="sxs-lookup"><span data-stu-id="7b5c3-137">Root Hub</span></span>

<span data-ttu-id="7b5c3-138">ホスト コントローラーの各インスタンスには、1 つ以上の USB ルート ハブがあります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-138">Each host controller instance has one or more USB root hubs.</span></span> <span data-ttu-id="7b5c3-139">ルート ハブの数は、コントローラーの性質によって決まります。または、コントローラーから特定のレジスタを読み取ることによっても取得できます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-139">The number of root hubs is either determined by the nature of the controller or can be retrieved by reading specific registers from the controller.</span></span>

### <a name="hub-class"></a><span data-ttu-id="7b5c3-140">ハブ クラス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-140">Hub Class</span></span>

<span data-ttu-id="7b5c3-141">ハブ クラスは、USB ハブの駆動を担当します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-141">The hub class is in charge of driving USB hubs.</span></span> <span data-ttu-id="7b5c3-142">USB ハブは、スタンドアロン ハブとするか、またはキーボードやモニターなどの複合デバイスの一部とすることもできます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-142">A USB hub can either be a stand-alone hub or as part of a compound device such as a keyboard or a monitor.</span></span> <span data-ttu-id="7b5c3-143">ハブは、セルフパワー型またはバスパワー型とすることができます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-143">A hub can be self-powered or bus-powered.</span></span> <span data-ttu-id="7b5c3-144">バスパワー型のハブには最大 4 つの下流ポートを搭載でき、使用電力が 100mA 未満であるセルフパワー型またはバスパワー型のデバイスのみを接続できます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-144">Bus-powered hubs have a maximum of four downstream ports and can only allow for the connection of devices that are either self-powered or bus-powered devices that use less than 100mA of power.</span></span> <span data-ttu-id="7b5c3-145">ハブはカスケード化できます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-145">Hubs can be cascaded.</span></span> <span data-ttu-id="7b5c3-146">最大 5 つのハブを相互に接続できます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-146">Up to five hubs can be connected to one another.</span></span>

### <a name="usb-host-stack"></a><span data-ttu-id="7b5c3-147">USB ホスト スタック</span><span class="sxs-lookup"><span data-stu-id="7b5c3-147">USB Host Stack</span></span>

<span data-ttu-id="7b5c3-148">USB ホスト スタックは、USBX の中核を成しています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-148">The USB host stack is the centerpiece of USBX.</span></span> <span data-ttu-id="7b5c3-149">主に 3 つの機能を持ちます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-149">It has three main functions.</span></span>

- <span data-ttu-id="7b5c3-150">USB のトポロジを管理する。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-150">Manage the topology of the USB.</span></span>
- <span data-ttu-id="7b5c3-151">1 つ以上のクラスに USB デバイスをバインドする。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-151">Bind a USB device to one or more classes.</span></span>
- <span data-ttu-id="7b5c3-152">デバイス記述子問い合わせと USB 転送を実行するための API をクラスに提供する。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-152">Provide an API to classes to perform device descriptor interrogation and USB transfers.</span></span>

### <a name="topology-manager"></a><span data-ttu-id="7b5c3-153">トポロジ マネージャー</span><span class="sxs-lookup"><span data-stu-id="7b5c3-153">Topology Manager</span></span>

<span data-ttu-id="7b5c3-154">新しいデバイスが接続されたとき、またはデバイスの接続が解除されたときに、USB スタック トポロジ スレッドがウェイク アップします。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-154">The USB stack topology thread is awakened when a new device is connected or when a device has been disconnected.</span></span> <span data-ttu-id="7b5c3-155">ルート ハブまたは通常のハブのいずれも、デバイスの接続を受け入れることができます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-155">Either the root hub or a regular hub can accept device connections.</span></span> <span data-ttu-id="7b5c3-156">USB にデバイスが接続されると、トポロジ マネージャーはデバイス記述子を取得します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-156">Once a device has been connected to the USB, the topology manager will retrieve the device descriptor.</span></span> <span data-ttu-id="7b5c3-157">この記述子には、そのデバイスで使用可能な構成の数が含まれています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-157">This descriptor will contain the number of possible configurations available for this device.</span></span> <span data-ttu-id="7b5c3-158">ほとんどのデバイスは 1 つの構成のみを持ちます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-158">Most devices have one configuration only.</span></span> <span data-ttu-id="7b5c3-159">一部のデバイスは、接続先のポートで利用可能な電力に応じて、異なる動作が可能です。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-159">Some devices can operate differently according to the available power available on the port where it is connected.</span></span> <span data-ttu-id="7b5c3-160">この場合、デバイスには利用可能な電力に応じて選択できる複数の構成があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-160">If this is the case, the device will have multiple configurations that can be selected depending on the available power.</span></span> <span data-ttu-id="7b5c3-161">トポロジ マネージャーによってデバイスが構成されると、その構成記述子で指定されている電力を消費できるようになります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-161">When the device is configured by the topology manager, it is then allowed to draw the amount of power specified in its configuration descriptor.</span></span>

## <a name="usb-class-binding"></a><span data-ttu-id="7b5c3-162">USB クラスのバインド</span><span class="sxs-lookup"><span data-stu-id="7b5c3-162">USB Class Binding</span></span>

<span data-ttu-id="7b5c3-163">デバイスが構成されたら、トポロジ マネージャーによって、クラス マネージャーがデバイスのインターフェイス記述子を確認してデバイスの検出を続行できるようになります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-163">When the device is configured, the topology manager will let the class manager continue the device discovery by looking at the device interface descriptors.</span></span> <span data-ttu-id="7b5c3-164">デバイスには、1 つ以上のインターフェイス記述子を持たせることができます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-164">A device can have one or more interface descriptors.</span></span>

<span data-ttu-id="7b5c3-165">インターフェイスは、デバイス内の機能を表します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-165">An interface represents a function in a device.</span></span> <span data-ttu-id="7b5c3-166">たとえば USB スピーカーには、オーディオ ストリーミング用、オーディオ コントロール用、各種スピーカー ボタン管理用の 3 つのインターフェイスがあります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-166">For instance, a USB speaker has three interfaces, one for audio streaming, one for audio control, and one to manage the various speaker buttons.</span></span>

<span data-ttu-id="7b5c3-167">クラス マネージャーには、デバイス インターフェイスを 1 つ以上のクラスに結合するためのメカニズムが 2 種類あります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-167">The class manager has two mechanisms to join the device interface(s) to one or more classes.</span></span> <span data-ttu-id="7b5c3-168">すなわち、インターフェイス記述子で見つかった PID/VID (製品 ID とベンダー ID) の組み合わせを使用する方法と、クラス/サブクラス/プロトコルの組み合わせを使用する方法です。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-168">It can either use the combination of a PID/VID (product ID and vendor ID) found in the interface descriptor or the combination of Class/Subclass/Protocol.</span></span>

<span data-ttu-id="7b5c3-169">PID/VID の組み合わせは、汎用クラスでは駆動できないインターフェイスに対して有効です。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-169">The PID/VID combination is valid for interfaces that cannot be driven by a generic class.</span></span> <span data-ttu-id="7b5c3-170">クラス/サブクラス/プロトコルの組み合わせは、プリンターやハブ、ストレージ、オーディオ、HID などの、USB-IF 認定クラスに属しているインターフェイスによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-170">The Class/Subclass/Protocol combination is used by interfaces that belong to a USB-IF certified class such as a printer, hub, storage, audio, or HID.</span></span>

<span data-ttu-id="7b5c3-171">クラス マネージャーには、USBX の初期化によって登録されたクラスの一覧が含まれています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-171">The class manager contains a list of registered classes from the initialization of USBX.</span></span> <span data-ttu-id="7b5c3-172">クラス マネージャーは、いずれかのクラスがそのデバイスのインターフェイスの管理を引き受けるまで、各クラスを 1 つずつ呼び出し続けます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-172">The class manager will call each class one at a time until one class accepts to manage the interface for that device.</span></span> <span data-ttu-id="7b5c3-173">1 つのクラスは、1 つのインターフェイスのみを管理できます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-173">A class can only manage one interface.</span></span> <span data-ttu-id="7b5c3-174">USB オーディオ スピーカーの例では、各インターフェイスに対してクラス マネージャーがすべてのクラスを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-174">For the example of the USB audio speaker, the class manager will call all the classes for each of the interfaces.</span></span>

<span data-ttu-id="7b5c3-175">クラスがインターフェイスを引き受けると、そのクラスの新しいインスタンスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-175">Once a class accepts an interface, a new instance of that class is created.</span></span> <span data-ttu-id="7b5c3-176">次にクラス マネージャーは、そのインターフェイスの既定の代替設定を検索します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-176">The class manager will then search for the default alternate setting for the interface.</span></span> <span data-ttu-id="7b5c3-177">デバイスでは、インターフェイスごとに 1 つ以上の代替設定を持つことができます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-177">A device may have one or more alternate settings for each interface.</span></span> <span data-ttu-id="7b5c3-178">クラスで変更が決定されるまでは、代替設定 0 が既定で使用されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-178">The alternate setting 0 will be the on used by default until a class decides to change it.</span></span>

<span data-ttu-id="7b5c3-179">既定の代替設定では、クラス マネージャーによって代替設定に含まれるすべてのエンドポイントがマウントされます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-179">For the default alternate setting, the class manager will mount all the endpoints contained in the alternate setting.</span></span> <span data-ttu-id="7b5c3-180">各エンドポイントのマウントが成功すると、クラス マネージャーはインターフェイスの初期化を完成させるクラスに戻り、そのジョブを完了させます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-180">If the mounting of each endpoint is successful, the class manager will complete its job by returning to the class that will finish the initialization of the interface.</span></span>

### <a name="usbx-apis"></a><span data-ttu-id="7b5c3-181">USBX API</span><span class="sxs-lookup"><span data-stu-id="7b5c3-181">USBX APIs</span></span>

<span data-ttu-id="7b5c3-182">USB スタックから、一定の数の API がエクスポートされます。これは、USB クラスがデバイス上で問い合わせおよび特定のエンドポイントでの USB 転送を実行するためのものです。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-182">The USB stack exports a certain number of APIs for the USB classes to perform interrogation on the device and USB transfers on specific endpoints.</span></span> <span data-ttu-id="7b5c3-183">これらの API 関数の詳細については、こちらのリファレンス マニュアルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-183">These API functions are described in detail in this reference manual.</span></span>

### <a name="host-controller"></a><span data-ttu-id="7b5c3-184">ホスト コントローラー</span><span class="sxs-lookup"><span data-stu-id="7b5c3-184">Host Controller</span></span>

<span data-ttu-id="7b5c3-185">ホスト コントローラー ドライバーは、特定の種類の USB コントローラーを駆動する役割を担います。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-185">The host controller driver is responsible for driving a specific type of USB controller.</span></span> <span data-ttu-id="7b5c3-186">USB ホスト コントローラーは、複数のコントローラーを内蔵できます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-186">A USB host controller can have multiple controllers inside.</span></span> <span data-ttu-id="7b5c3-187">たとえば、ある Intel PC チップセットには、2 つの UHCI コントローラーが内蔵されています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-187">For instance, certain Intel PC chipset contain two UHCI controllers.</span></span> <span data-ttu-id="7b5c3-188">一部の USB 2.0 コントローラーには、EHCI コントローラーのインスタンス 1 つに加えて、OHCI コントローラーのインスタンスが複数内蔵されています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-188">Some USB 2.0 controllers contain multiple instances of an OHCI controller in addition to one instance of the EHCI controller.</span></span>

<span data-ttu-id="7b5c3-189">ホスト コントローラーは、同じコントローラーの複数のインスタンスのみを管理します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-189">The Host controller will manage multiple instance of the same controller only.</span></span> <span data-ttu-id="7b5c3-190">ほとんどの USB 2.0 ホスト コントローラーを駆動するためには、USBX の初期化時に OCHI コントローラーと EHCI コントローラーの両方を初期化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-190">In order to drive most USB 2.0 host controllers, it will be required to initialize both the OCHI controller and the EHCI controller during the initialization of USBX.</span></span>

<span data-ttu-id="7b5c3-191">ホスト コントローラーは、次の管理を担当します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-191">The host controller is responsible for managing the following.</span></span>

- <span data-ttu-id="7b5c3-192">ルート ハブ</span><span class="sxs-lookup"><span data-stu-id="7b5c3-192">Root Hub</span></span>
- <span data-ttu-id="7b5c3-193">電源管理</span><span class="sxs-lookup"><span data-stu-id="7b5c3-193">Power Management</span></span>
- <span data-ttu-id="7b5c3-194">エンドポイント</span><span class="sxs-lookup"><span data-stu-id="7b5c3-194">Endpoints</span></span>
- <span data-ttu-id="7b5c3-195">転送</span><span class="sxs-lookup"><span data-stu-id="7b5c3-195">Transfers</span></span>

### <a name="root-hub"></a><span data-ttu-id="7b5c3-196">ルート ハブ</span><span class="sxs-lookup"><span data-stu-id="7b5c3-196">Root Hub</span></span>

<span data-ttu-id="7b5c3-197">ルート ハブの管理は、各コントローラー ポートの電源を入れ、デバイスが挿入されているかどうかを判定する役割を担います。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-197">The root hub management is responsible for the powering up of each controller port and determining if there is a device inserted or not.</span></span> <span data-ttu-id="7b5c3-198">この機能は、コントローラーの下流ポートに問い合わせを行うために USBX 汎用ルート ハブによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-198">This functionality is used by the USBX generic root hub to interrogate the controller downstream ports.</span></span>

### <a name="power-management"></a><span data-ttu-id="7b5c3-199">電源管理</span><span class="sxs-lookup"><span data-stu-id="7b5c3-199">Power Management</span></span>

<span data-ttu-id="7b5c3-200">電源管理の処理では、中断/再開信号を扱います。ギャング モードにしてコントローラーのすべての下流ポートに同時に影響を与えるようにするか、または (コントローラー側で対応している場合は) 各ポートに対して個別に行います。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-200">The power management processing provides for the handling of suspend/resume signals either in gang mode, therefore affecting all controller downstream ports at the same time, or individually if the controller offers this functionality.</span></span>

### <a name="endpoints"></a><span data-ttu-id="7b5c3-201">エンドポイント</span><span class="sxs-lookup"><span data-stu-id="7b5c3-201">Endpoints</span></span>

<span data-ttu-id="7b5c3-202">エンドポイント管理では、コントローラーに対する物理エンドポイントの作成または破棄を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-202">The endpoint management provides for the creation or destruction of physical endpoints to the controller.</span></span> <span data-ttu-id="7b5c3-203">物理エンドポイントとはメモリ エンティティであり、マスタ DMA をサポートしているコントローラーによって解析される場合と、コントローラーに書き込まれている場合があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-203">The physical endpoints are memory entities that are parsed by the controller if the controller supports master DMA or that are written in the controller.</span></span> <span data-ttu-id="7b5c3-204">物理エンドポイントには、コントローラーによって実行されるトランザクション情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-204">The physical endpoints contain transactions information to be performed by the controller.</span></span>

### <a name="transfers"></a><span data-ttu-id="7b5c3-205">転送</span><span class="sxs-lookup"><span data-stu-id="7b5c3-205">Transfers</span></span>

<span data-ttu-id="7b5c3-206">転送管理では、作成された各エンドポイントでトランザクションを実行するクラスが提供されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-206">Transfer management provides for a class to perform a transaction on each of the endpoints that have been created.</span></span> <span data-ttu-id="7b5c3-207">各論理エンドポイントには、USB 転送要求用のTRANSFER REQUEST と呼ばれるコンポーネントが含まれています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-207">Each logical endpoint contains a component called TRANSFER REQUEST for USB transfer requests.</span></span> <span data-ttu-id="7b5c3-208">TRANSFER REQUEST は、トランザクションを記述するためにスタックによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-208">The TRANSFER REQUEST is used by the stack to describe the transaction.</span></span> <span data-ttu-id="7b5c3-209">その後、この TRANSFER REQUEST はスタックとコントローラーに渡され、コントローラーの機能に応じていくつかのサブ トランザクションに分割することができます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-209">This TRANSFER REQUEST is then passed to the stack and to the controller, which may divide it into several sub transactions depending on the capabilities of the controller.</span></span>

## <a name="usb-device-framework"></a><span data-ttu-id="7b5c3-210">USB デバイスのフレームワーク</span><span class="sxs-lookup"><span data-stu-id="7b5c3-210">USB Device Framework</span></span>

<span data-ttu-id="7b5c3-211">USB デバイスは、記述子のツリーによって表されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-211">A USB device is represented by a tree of descriptors.</span></span> <span data-ttu-id="7b5c3-212">記述子には、6 つの主要な種類があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-212">There are six main types of descriptors.</span></span>

- <span data-ttu-id="7b5c3-213">デバイス記述子</span><span class="sxs-lookup"><span data-stu-id="7b5c3-213">Device descriptors</span></span>
- <span data-ttu-id="7b5c3-214">構成記述子</span><span class="sxs-lookup"><span data-stu-id="7b5c3-214">Configuration descriptors</span></span>
- <span data-ttu-id="7b5c3-215">インターフェイス記述子</span><span class="sxs-lookup"><span data-stu-id="7b5c3-215">Interface descriptors</span></span>
- <span data-ttu-id="7b5c3-216">エンドポイント記述子</span><span class="sxs-lookup"><span data-stu-id="7b5c3-216">Endpoint descriptors</span></span>
- <span data-ttu-id="7b5c3-217">文字列記述子</span><span class="sxs-lookup"><span data-stu-id="7b5c3-217">String descriptors</span></span>
- <span data-ttu-id="7b5c3-218">機能記述子</span><span class="sxs-lookup"><span data-stu-id="7b5c3-218">Functional descriptors</span></span>

<span data-ttu-id="7b5c3-219">USB デバイスは非常に簡単に記述することができ、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-219">A USB device may have a very simple description and looks like this.</span></span>
<span data-ttu-id="7b5c3-220">![簡単な USB デバイス](./media/usbx-host-stack/usb-device-simple.png)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-220">![Simple USB device](./media/usbx-host-stack/usb-device-simple.png)</span></span>

<span data-ttu-id="7b5c3-221">上の図では、デバイスに含まれる構成は 1 つだけです。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-221">In the above illustration, the device has only one configuration.</span></span> <span data-ttu-id="7b5c3-222">この構成には 1 つのインターフェイスがアタッチされています。これは、このデバイスの機能が 1 つだけで、エンドポイントも 1 つだけであることを示しています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-222">A single interface is attached to this configuration, indicating that the device has only one function, and it has one endpoint only.</span></span> <span data-ttu-id="7b5c3-223">デバイス記述子にアタッチされている文字列記述子は、デバイスの識別を可視化しています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-223">Attached to the device descriptor is a string descriptor providing a visible identification of the device.</span></span>

<span data-ttu-id="7b5c3-224">ただし、より複雑なデバイスとすることも可能であり、その場合は次のように表示されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-224">However, a device may be more complex and may appear as follows.</span></span>

![複雑な USB デバイス](./media/usbx-host-stack/usb-device-complex.png)

<span data-ttu-id="7b5c3-226">上の図のデバイスでは、デバイス記述子に 2 つの構成記述子がアタッチされています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-226">In the above illustration, the device has two configuration descriptors attached to the device descriptor.</span></span> <span data-ttu-id="7b5c3-227">このデバイスは、電源モードが 2 つあることを示している場合もあれば、標準クラスと各社独自のクラスのどちらでも駆動できることを示している場合もあります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-227">This device may indicate that it has two power modes or can be driven by either standard classes or proprietary classes.</span></span>

<span data-ttu-id="7b5c3-228">最初の構成には 2 つのインターフェイスがアタッチされており、デバイスに 2 つの論理機能があることを示しています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-228">Attached to the first configuration are two interfaces indicating that the device has two logical functions.</span></span> <span data-ttu-id="7b5c3-229">最初の機能には、3 つのエンドポイント記述子と 1 つの機能記述子があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-229">The first function has 3 endpoint descriptors and a functional descriptor.</span></span> <span data-ttu-id="7b5c3-230">機能記述子は、このインターフェイスに関して汎用記述子には通常含まれていない追加情報を取得するために、インターフェイスの駆動を担当するクラスによって使用される場合があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-230">The functional descriptor may be used by the class responsible to drive the interface to obtain further information about this interface normally not found by a generic descriptor.</span></span>

### <a name="device-descriptors"></a><span data-ttu-id="7b5c3-231">デバイス記述子</span><span class="sxs-lookup"><span data-stu-id="7b5c3-231">Device Descriptors</span></span>

<span data-ttu-id="7b5c3-232">各 USB デバイスには、1 つのデバイス記述子があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-232">Each USB device has one single device descriptor.</span></span> <span data-ttu-id="7b5c3-233">この記述子には、デバイス識別子、サポートされている構成の数、およびデバイスの構成に使用される既定のコントロール エンドポイントの特性が含まれます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-233">This descriptor contains the device identification, the number of configurations supported, and the characteristics of the default control endpoint used for configuring the device.</span></span>

| <span data-ttu-id="7b5c3-234">Offset</span><span class="sxs-lookup"><span data-stu-id="7b5c3-234">Offset</span></span> | <span data-ttu-id="7b5c3-235">フィールド</span><span class="sxs-lookup"><span data-stu-id="7b5c3-235">Field</span></span>              | <span data-ttu-id="7b5c3-236">Size</span><span class="sxs-lookup"><span data-stu-id="7b5c3-236">Size</span></span> | <span data-ttu-id="7b5c3-237">値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-237">Value</span></span>    | <span data-ttu-id="7b5c3-238">説明</span><span class="sxs-lookup"><span data-stu-id="7b5c3-238">Description</span></span>                             |
| ------ | ------------------ | ---- | -------- | --------------------------------------- |
| <span data-ttu-id="7b5c3-239">0</span><span class="sxs-lookup"><span data-stu-id="7b5c3-239">0</span></span>      | <span data-ttu-id="7b5c3-240">BLength</span><span class="sxs-lookup"><span data-stu-id="7b5c3-240">BLength</span></span>            | <span data-ttu-id="7b5c3-241">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-241">1</span></span>    | <span data-ttu-id="7b5c3-242">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-242">Number</span></span>   | <span data-ttu-id="7b5c3-243">この記述子のサイズ (byte 単位)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-243">Size of this descriptor in bytes</span></span> |
| <span data-ttu-id="7b5c3-244">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-244">1</span></span>      | <span data-ttu-id="7b5c3-245">bDescriptorType</span><span class="sxs-lookup"><span data-stu-id="7b5c3-245">bDescriptorType</span></span>    | <span data-ttu-id="7b5c3-246">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-246">1</span></span>    | <span data-ttu-id="7b5c3-247">一定</span><span class="sxs-lookup"><span data-stu-id="7b5c3-247">Constant</span></span> | <span data-ttu-id="7b5c3-248">デバイス記述子の型</span><span class="sxs-lookup"><span data-stu-id="7b5c3-248">DEVICE Descriptor Type</span></span> |
| <span data-ttu-id="7b5c3-249">2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-249">2</span></span>      | <span data-ttu-id="7b5c3-250">bcdUSB</span><span class="sxs-lookup"><span data-stu-id="7b5c3-250">bcdUSB</span></span>             | <span data-ttu-id="7b5c3-251">2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-251">2</span></span>    | <span data-ttu-id="7b5c3-252">BCD●bcd○</span><span class="sxs-lookup"><span data-stu-id="7b5c3-252">BCD</span></span>      | <span data-ttu-id="7b5c3-253">USB 仕様リリース番号 (2 進化 10 進数)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-253">USB Specification Release Number in BinaryCoded Dec</span></span><br /><span data-ttu-id="7b5c3-254">例: 2.10 は 0x210 と等しいです。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-254">Example: 2.10 is equivalent to 0x210.</span></span> <span data-ttu-id="7b5c3-255">このフィールドは、デバイスとその記述子が準拠している USB 仕様のリリースを特定します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-255">This field identifies the release of the USB Specification that the device and its descriptors are compliant with.</span></span> |
| <span data-ttu-id="7b5c3-256">4</span><span class="sxs-lookup"><span data-stu-id="7b5c3-256">4</span></span>      | <span data-ttu-id="7b5c3-257">bDeviceClass</span><span class="sxs-lookup"><span data-stu-id="7b5c3-257">bDeviceClass</span></span>       | <span data-ttu-id="7b5c3-258">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-258">1</span></span>    | <span data-ttu-id="7b5c3-259">クラス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-259">Class</span></span>    | <span data-ttu-id="7b5c3-260">クラス コード (USB-IF により割り当てられる)。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-260">Class code (assigned by USB-IF).</span></span><br /><span data-ttu-id="7b5c3-261">このフィールドが 0 にリセットされた場合、構成内の各インターフェイスが自身のクラス情報を指定し、さまざまなインターフェイスが独立して動作します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-261">If this field is reset to 0, each interface within a configuration specifies its own class information and the various interfaces operate independently.</span></span><br /><span data-ttu-id="7b5c3-262">このフィールドが 1 から 0xFE の範囲の値に設定された場合、デバイスは異なるインターフェイスごとに異なるクラス仕様をサポートすることになり、インターフェイスは独立して動作しない場合があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-262">If this field is set to a value between 1 and 0xFE, the device supports different class specifications on different interfaces and the interfaces may not operate independently.</span></span> <span data-ttu-id="7b5c3-263">この値は、インターフェイスの集合に使用されるクラス定義を特定します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-263">This value identifies the class definition used for the aggregate interfaces.</span></span><br /><span data-ttu-id="7b5c3-264">このフィールドが 0xFF に設定された場合、デバイス クラスはベンダー固有となります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-264">If this field is set to 0xFF, the device class is vendor specific.</span></span> |
| <span data-ttu-id="7b5c3-265">5</span><span class="sxs-lookup"><span data-stu-id="7b5c3-265">5</span></span>      | <span data-ttu-id="7b5c3-266">bDeviceSubClass</span><span class="sxs-lookup"><span data-stu-id="7b5c3-266">bDeviceSubClass</span></span>    | <span data-ttu-id="7b5c3-267">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-267">1</span></span>    | <span data-ttu-id="7b5c3-268">サブクラス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-268">SubClass</span></span> | <span data-ttu-id="7b5c3-269">サブクラス コード (USB-IF により割り当てられる)。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-269">Subclass code (assigned by USB-IF).</span></span><br /><span data-ttu-id="7b5c3-270">これらのコードは、bDeviceClass フィールドの値によって修飾されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-270">These codes are qualified by the value of the bDeviceClass field.</span></span> <span data-ttu-id="7b5c3-271">bDeviceClass フィールドが 0 にリセットされた場合、このフィールドも 0 にリセットする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-271">If the bDeviceClass field is reset to 0, this field must also be reset to 0.</span></span> <span data-ttu-id="7b5c3-272">bDeviceClass フィールドが 0xFF に設定されていない場合、すべての値が USB による割り当て用に予約されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-272">If the bDeviceClass field is not set to 0xFF, all values are reserved for assignment by USB.</span></span> |
| <span data-ttu-id="7b5c3-273">6</span><span class="sxs-lookup"><span data-stu-id="7b5c3-273">6</span></span>      | <span data-ttu-id="7b5c3-274">bDeviceProtocol</span><span class="sxs-lookup"><span data-stu-id="7b5c3-274">bDeviceProtocol</span></span>    | <span data-ttu-id="7b5c3-275">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-275">1</span></span>    | <span data-ttu-id="7b5c3-276">プロトコル</span><span class="sxs-lookup"><span data-stu-id="7b5c3-276">Protocol</span></span> | <span data-ttu-id="7b5c3-277">プロトコル コード (USB-IF により割り当てられる)。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-277">Protocol code (assigned by USB-IF).</span></span><br /><span data-ttu-id="7b5c3-278">これらのコードは、bDeviceClass フィールドと bDeviceSubClass フィールドの値によって修飾されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-278">These codes are qualified by the value of the bDeviceClass and the bDeviceSubClass fields.</span></span> <span data-ttu-id="7b5c3-279">インターフェイス ベースではなくデバイス ベースでクラス固有プロトコルをサポートしているデバイスの場合、このコードはデバイスが使用するプロトコルを、デバイス クラスの仕様による定義に従って特定します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-279">If a device supports class-specific protocols on a device basis as opposed to an interface basis, this code identifies the protocols that the device uses as defined by the specification of the device class.</span></span> <span data-ttu-id="7b5c3-280">このフィールドが 0 にリセットされた場合、デバイスはクラス固有プロトコルをデバイス ベースで使用しません。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-280">If this field is reset to 0, the device does not use class specific protocols on a device basis.</span></span><br /><span data-ttu-id="7b5c3-281">ただし、クラス固有プロトコルをインターフェイス ベースで使用することはできます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-281">However, it may use class specific protocols on an interface basis.</span></span><br /><span data-ttu-id="7b5c3-282">このフィールドが 0xFF に設定された場合、デバイスはベンダー固有プロトコルをデバイス ベースで使用します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-282">If this field is set to 0xFF, the device uses a vendor specific protocol on a device basis.</span></span> |
| <span data-ttu-id="7b5c3-283">7</span><span class="sxs-lookup"><span data-stu-id="7b5c3-283">7</span></span>      | <span data-ttu-id="7b5c3-284">bMaxPacketSize0</span><span class="sxs-lookup"><span data-stu-id="7b5c3-284">bMaxPacketSize0</span></span>    | <span data-ttu-id="7b5c3-285">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-285">1</span></span>    | <span data-ttu-id="7b5c3-286">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-286">Number</span></span>   | <span data-ttu-id="7b5c3-287">エンドポイント 0 の最大パケット サイズ (byte サイズ 8、16、32、または 64 のみ有効)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-287">Maximum packet size for endpoint zero (only byte sizes of 8, 16, 32, or 64 are valid)</span></span> |
| <span data-ttu-id="7b5c3-288">8</span><span class="sxs-lookup"><span data-stu-id="7b5c3-288">8</span></span>      | <span data-ttu-id="7b5c3-289">idVendor</span><span class="sxs-lookup"><span data-stu-id="7b5c3-289">idVendor</span></span>           | <span data-ttu-id="7b5c3-290">2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-290">2</span></span>    | <span data-ttu-id="7b5c3-291">id</span><span class="sxs-lookup"><span data-stu-id="7b5c3-291">ID</span></span>       | <span data-ttu-id="7b5c3-292">ベンダー ID (USB-IF により割り当てられる)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-292">Vendor ID (assigned by USB-IF)</span></span> |
| <span data-ttu-id="7b5c3-293">10</span><span class="sxs-lookup"><span data-stu-id="7b5c3-293">10</span></span>     | <span data-ttu-id="7b5c3-294">idProduct</span><span class="sxs-lookup"><span data-stu-id="7b5c3-294">idProduct</span></span>          | <span data-ttu-id="7b5c3-295">2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-295">2</span></span>    | <span data-ttu-id="7b5c3-296">id</span><span class="sxs-lookup"><span data-stu-id="7b5c3-296">ID</span></span>       | <span data-ttu-id="7b5c3-297">製品 ID (製造元により割り当てられる)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-297">Product ID (assigned by the Manufacturer)</span></span> |
| <span data-ttu-id="7b5c3-298">12</span><span class="sxs-lookup"><span data-stu-id="7b5c3-298">12</span></span>     | <span data-ttu-id="7b5c3-299">bcdDevice</span><span class="sxs-lookup"><span data-stu-id="7b5c3-299">bcdDevice</span></span>          | <span data-ttu-id="7b5c3-300">2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-300">2</span></span>    | <span data-ttu-id="7b5c3-301">BCD●bcd○</span><span class="sxs-lookup"><span data-stu-id="7b5c3-301">BCD</span></span>      | <span data-ttu-id="7b5c3-302">デバイス リリース番号 (2 進化 10 進数)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-302">Device release number in binary-coded decimal</span></span> |
| <span data-ttu-id="7b5c3-303">14</span><span class="sxs-lookup"><span data-stu-id="7b5c3-303">14</span></span>     | <span data-ttu-id="7b5c3-304">iManufacturer</span><span class="sxs-lookup"><span data-stu-id="7b5c3-304">iManufacturer</span></span>      | <span data-ttu-id="7b5c3-305">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-305">1</span></span>    | <span data-ttu-id="7b5c3-306">インデックス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-306">Index</span></span>    | <span data-ttu-id="7b5c3-307">製造元を記述する文字列記述子のインデックス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-307">Index of string descriptor describing manufacturer</span></span> |
| <span data-ttu-id="7b5c3-308">15</span><span class="sxs-lookup"><span data-stu-id="7b5c3-308">15</span></span>     | <span data-ttu-id="7b5c3-309">iProduct</span><span class="sxs-lookup"><span data-stu-id="7b5c3-309">iProduct</span></span>           | <span data-ttu-id="7b5c3-310">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-310">1</span></span>    | <span data-ttu-id="7b5c3-311">インデックス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-311">Index</span></span>    | <span data-ttu-id="7b5c3-312">製品を記述する文字列記述子のインデックス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-312">Index of string descriptor describing product</span></span> |
| <span data-ttu-id="7b5c3-313">16</span><span class="sxs-lookup"><span data-stu-id="7b5c3-313">16</span></span>     | <span data-ttu-id="7b5c3-314">iSerialNumbe</span><span class="sxs-lookup"><span data-stu-id="7b5c3-314">iSerialNumbe</span></span>       | <span data-ttu-id="7b5c3-315">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-315">1</span></span>    | <span data-ttu-id="7b5c3-316">インデックス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-316">Index</span></span>    | <span data-ttu-id="7b5c3-317">デバイスのシリアル番号を記述する文字列記述子のインデックス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-317">Index of string descriptor describing the device's serial number</span></span> |
| <span data-ttu-id="7b5c3-318">17</span><span class="sxs-lookup"><span data-stu-id="7b5c3-318">17</span></span>     | <span data-ttu-id="7b5c3-319">bNumConfigurations</span><span class="sxs-lookup"><span data-stu-id="7b5c3-319">bNumConfigurations</span></span> | <span data-ttu-id="7b5c3-320">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-320">1</span></span>    | <span data-ttu-id="7b5c3-321">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-321">Number</span></span>   | <span data-ttu-id="7b5c3-322">可能な構成の数</span><span class="sxs-lookup"><span data-stu-id="7b5c3-322">Number of possible configurations</span></span> |

<span data-ttu-id="7b5c3-323">USBX では、USB デバイス記述子を次のように定義します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-323">USBX defines a USB device descriptor as follows:</span></span>

```c
typedef struct UX_DEVICE_DESCRIPTOR_STRUCT
{
    UINT      bLength;
    UINT      bDescriptorType;
    USHORT    bcdUSB;
    UINT      bDeviceClass;
    UINT      bDeviceSubClass;
    UINT      bDeviceProtocol;
    UINT      bMaxPacketSize0;
    USHORT    idVendor;
    USHORT    idProduct;
    USHORT    bcdDevice;
    UINT      iManufacturer;
    UINT      iProduct;
    UINT      iSerialNumber;
    UINT      bNumConfigurations;
} UX_DEVICE_DESCRIPTOR;
```

<span data-ttu-id="7b5c3-324">USB デバイス記述子は、次に示すデバイス コンテナーの一部となっています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-324">The USB device descriptor is part of a device container described as:</span></span>

```c
typedef struct UX_DEVICE_STRUCT
{
    ULONG ux_device_handle;
    ULONG ux_device_type;
    ULONG ux_device_state;
    ULONG ux_device_address;
    ULONG ux_device_speed;
    ULONG ux_device_port_location;
    ULONG ux_device_max_power;
    ULONG ux_device_power_source;
    UINT ux_device_current_configuration;

    TX_SEMAPHORE ux_device_protection_semaphore;
    struct UX_DEVICE_STRUCT *ux_device_parent; 
    struct UX_HOST_CLASS_STRUCT *ux_device_class; 
    VOID *ux_device_class_instance;
    struct UX_HCD_STRUCT *ux_device_hcd;
    struct UX_CONFIGURATION_STRUCT *ux_device_first_configuration; 
    struct UX_DEVICE_STRUCT *ux_device_next_device;
    struct UX_DEVICE_DESCRIPTOR_STRUCT ux_device_descriptor;
    struct UX_ENDPOINT_STRUCT ux_device_control_endpoint;
    struct UX_HUB_TT_STRUCT ux_device_hub_tt[UX_MAX_TT];
} UX_DEVICE;
```

- <span data-ttu-id="7b5c3-325">**ux_device_handle**: デバイスのハンドル。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-325">**ux_device_handle**: Handle of the device.</span></span> <span data-ttu-id="7b5c3-326">これは通常、デバイスのこの構造体のインスタンスのアドレスです。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-326">This is typically the address of the instance of this structure for the device.</span></span>
- <span data-ttu-id="7b5c3-327">**ux_device_type**: 古い値。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-327">**ux_device_type**: Obsolete value.</span></span> <span data-ttu-id="7b5c3-328">未使用。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-328">Unused.</span></span>
- <span data-ttu-id="7b5c3-329">**ux_device_state**: デバイスの状態。次のいずれかの値を指定できます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-329">**ux_device_state**: Device State, which can have one of the following values:</span></span>
    - <span data-ttu-id="7b5c3-330">**UX_DEVICE_RESET**                0</span><span class="sxs-lookup"><span data-stu-id="7b5c3-330">**UX_DEVICE_RESET**                0</span></span>
    - <span data-ttu-id="7b5c3-331">**UX_DEVICE_ATTACHED**             1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-331">**UX_DEVICE_ATTACHED**             1</span></span>
    - <span data-ttu-id="7b5c3-332">**UX_DEVICE_ADDRESSED**            2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-332">**UX_DEVICE_ADDRESSED**            2</span></span>
    - <span data-ttu-id="7b5c3-333">**UX_DEVICE_CONFIGURED**           3</span><span class="sxs-lookup"><span data-stu-id="7b5c3-333">**UX_DEVICE_CONFIGURED**           3</span></span>
    - <span data-ttu-id="7b5c3-334">**UX_DEVICE_SUSPENDED**            4</span><span class="sxs-lookup"><span data-stu-id="7b5c3-334">**UX_DEVICE_SUSPENDED**            4</span></span>
    - <span data-ttu-id="7b5c3-335">**UX_DEVICE_RESUMED**              5</span><span class="sxs-lookup"><span data-stu-id="7b5c3-335">**UX_DEVICE_RESUMED**              5</span></span>
    - <span data-ttu-id="7b5c3-336">**UX_DEVICE_SELF_POWERED_STATE**   6</span><span class="sxs-lookup"><span data-stu-id="7b5c3-336">**UX_DEVICE_SELF_POWERED_STATE**   6</span></span>
    - <span data-ttu-id="7b5c3-337">**UX_DEVICE_SELF_POWERED_STATE**   7</span><span class="sxs-lookup"><span data-stu-id="7b5c3-337">**UX_DEVICE_SELF_POWERED_STATE**   7</span></span>
    - <span data-ttu-id="7b5c3-338">**UX_DEVICE_REMOTE_WAKEUP**        8</span><span class="sxs-lookup"><span data-stu-id="7b5c3-338">**UX_DEVICE_REMOTE_WAKEUP**        8</span></span>
    - <span data-ttu-id="7b5c3-339">**UX_DEVICE_BUS_RESET_COMPLETED**  9</span><span class="sxs-lookup"><span data-stu-id="7b5c3-339">**UX_DEVICE_BUS_RESET_COMPLETED**  9</span></span>
    - <span data-ttu-id="7b5c3-340">**UX_DEVICE_REMOVED**              10</span><span class="sxs-lookup"><span data-stu-id="7b5c3-340">**UX_DEVICE_REMOVED**              10</span></span>
    - <span data-ttu-id="7b5c3-341">**UX_DEVICE_FORCE_DISCONNECT**     11</span><span class="sxs-lookup"><span data-stu-id="7b5c3-341">**UX_DEVICE_FORCE_DISCONNECT**     11</span></span>
- <span data-ttu-id="7b5c3-342">**ux_device_address**: **SET_ADDRESS** コマンドが受け付けられた後のデバイスのアドレス (1 から 127)。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-342">**ux_device_address**: Address of the device after the **SET_ADDRESS** command has been accepted (from 1 to 127).</span></span>
- <span data-ttu-id="7b5c3-343">**ux_device_speed**: デバイスの速度。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-343">**ux_device_speed**: Speed of the device:</span></span>
    - <span data-ttu-id="7b5c3-344">**UX_LOW_SPEED_DEVICE**      0</span><span class="sxs-lookup"><span data-stu-id="7b5c3-344">**UX_LOW_SPEED_DEVICE**      0</span></span>
    - <span data-ttu-id="7b5c3-345">**UX_FULL_SPEED_DEVICE**     1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-345">**UX_FULL_SPEED_DEVICE**     1</span></span>
    - <span data-ttu-id="7b5c3-346">**UX_HIGH_SPEED_DEVICE**     2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-346">**UX_HIGH_SPEED_DEVICE**     2</span></span>
- <span data-ttu-id="7b5c3-347">**ux_device_port_location**: 親デバイス (ルート ハブまたはハブ) のポートのインデックス。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-347">**ux_device_port_location**: Index of the port of the parent device (root hub or hub).</span></span>
- <span data-ttu-id="7b5c3-348">**ux_device_max_power**: 選択された構成においてデバイスが取り込むことのできる最大電力 (単位 mA)。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-348">**ux_device_max_power**: Maximum power in mA that the device may take in the selected configuration.</span></span>
- <span data-ttu-id="7b5c3-349">**ux_device_power_source**: 次の 2 つの値のうちのいずれかを指定できます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-349">**ux_device_power_source**: Can be one of the two following values:</span></span>
    - <span data-ttu-id="7b5c3-350">**UX_DEVICE_BUS_POWERED**     1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-350">**UX_DEVICE_BUS_POWERED**     1</span></span>
    - <span data-ttu-id="7b5c3-351">**UX_DEVICE_SELF_POWERED**    2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-351">**UX_DEVICE_SELF_POWERED**    2</span></span>
- <span data-ttu-id="7b5c3-352">**ux_device_current_configuration**: このデバイスで現在使用されている構成のインデックス。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-352">**ux_device_current_configuration**: Index of the current configuration being used by this device.</span></span>
- <span data-ttu-id="7b5c3-353">**ux_device_parent**: このデバイスの親のデバイス コンテナー ポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-353">**ux_device_parent**: Device container pointer of the parent of this device.</span></span> <span data-ttu-id="7b5c3-354">ポインターが null 値の場合、親はコントローラーのルート ハブです。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-354">If the pointer is null, the parent is the root hub of the controller.</span></span>
- <span data-ttu-id="7b5c3-355">**ux_device_class**: このデバイスを所有するクラス型へのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-355">**ux_device_class**: Pointer to the class type that owns this device.</span></span>
- <span data-ttu-id="7b5c3-356">**ux_device_class_instance**: このデバイスを所有するクラスのインスタンスへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-356">**ux_device_class_instance**: Pointer to the instance of the class that owns this device.</span></span>
- <span data-ttu-id="7b5c3-357">**ux_device_hcd**: このデバイスがアタッチされる USB ホスト コントローラー インスタンス。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-357">**ux_device_hcd**: USB Host Controller Instance where this device is attached.</span></span>
- <span data-ttu-id="7b5c3-358">**ux_device_first_configuration**: このデバイスの最初の構成コンテナーへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-358">**ux_device_first_configuration**: Pointer to the first configuration container for this device.</span></span>
- <span data-ttu-id="7b5c3-359">**ux_device_next_device**: USBX によって検出される任意のバス上にあるデバイスの一覧内の、次のデバイスへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-359">**ux_device_next_device**: Pointer to the next device in the list of device on any of the buses detected by USBX.</span></span>
- <span data-ttu-id="7b5c3-360">**ux_device_descriptor**: USB デバイス記述子。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-360">**ux_device_descriptor**: USB device descriptor.</span></span>
- <span data-ttu-id="7b5c3-361">**ux_device_control_endpoint**: このデバイスで使用される既定のコントロール エンドポイントの記述子。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-361">**ux_device_control_endpoint**: Descriptor of the default control endpoint used by this device.</span></span>
- <span data-ttu-id="7b5c3-362">**ux_device_hub_tt**: デバイスのハブ TT の配列</span><span class="sxs-lookup"><span data-stu-id="7b5c3-362">**ux_device_hub_tt**: Array of Hub TTs for the device</span></span>

### <a name="configuration-descriptors"></a><span data-ttu-id="7b5c3-363">構成記述子</span><span class="sxs-lookup"><span data-stu-id="7b5c3-363">Configuration Descriptors</span></span>

<span data-ttu-id="7b5c3-364">構成記述子には、特定のデバイス構成に関する情報を記述します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-364">The configuration descriptor describes information about a specific device configuration.</span></span> <span data-ttu-id="7b5c3-365">USB デバイスには、1 つ以上の構成記述子を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-365">A USB device may contain one or more configuration descriptors.</span></span> <span data-ttu-id="7b5c3-366">デバイス記述子の **bNumConfigurations** フィールドには、構成記述子の数が示されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-366">The **bNumConfigurations** field in the device descriptor indicates the number of configuration descriptors.</span></span> <span data-ttu-id="7b5c3-367">記述子には **bConfigurationValue** フィールドが含まれており、その値が Set Configuration 要求へのパラメーターとして使用された場合、デバイスは記述された構成を取るようになります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-367">The descriptor contains a **bConfigurationValue** field with a value that, when used as a parameter to the Set Configuration request, causes the device to assume the described configuration.</span></span>

<span data-ttu-id="7b5c3-368">記述子には、構成によって提供されるインターフェイスの数を記述します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-368">The descriptor describes the number of interfaces provided by the configuration.</span></span> <span data-ttu-id="7b5c3-369">各インターフェイスはデバイス内の論理機能を表し、それぞれ独立して動作することが可能です。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-369">Each interface represents a logical function within the device and may operate independently.</span></span> <span data-ttu-id="7b5c3-370">たとえば USB オーディオ スピーカーの場合、オーディオ ストリーミング用インターフェイス、オーディオ コントロール用インターフェイス、スピーカー ボタン管理用の HID インターフェイスの計 3 つのインターフェイスを設けることができます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-370">For instance a USB audio speaker may have three interfaces, one for audio streaming, one for audio control, and one HID interface to manage the speaker's buttons.</span></span>

<span data-ttu-id="7b5c3-371">ホストが構成記述子に対して GET_DESCRIPTOR 要求を発行すると、関連するすべてのインターフェイス記述子およびエンドポイント記述子が返されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-371">When the host issues a GET_DESCRIPTOR request for the configuration descriptor, all related interface and endpoint descriptors are returned.</span></span>

| <span data-ttu-id="7b5c3-372">Offset</span><span class="sxs-lookup"><span data-stu-id="7b5c3-372">Offset</span></span> | <span data-ttu-id="7b5c3-373">フィールド</span><span class="sxs-lookup"><span data-stu-id="7b5c3-373">Field</span></span>               | <span data-ttu-id="7b5c3-374">Size</span><span class="sxs-lookup"><span data-stu-id="7b5c3-374">Size</span></span> | <span data-ttu-id="7b5c3-375">値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-375">Value</span></span>    | <span data-ttu-id="7b5c3-376">説明</span><span class="sxs-lookup"><span data-stu-id="7b5c3-376">Description</span></span>                       |
| ------ | ------------------- | ---- | -------- | --------------------------------- |
| <span data-ttu-id="7b5c3-377">0</span><span class="sxs-lookup"><span data-stu-id="7b5c3-377">0</span></span>      | <span data-ttu-id="7b5c3-378">bLength</span><span class="sxs-lookup"><span data-stu-id="7b5c3-378">bLength</span></span>             | <span data-ttu-id="7b5c3-379">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-379">1</span></span>    | <span data-ttu-id="7b5c3-380">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-380">Number</span></span>   | <span data-ttu-id="7b5c3-381">この記述子のサイズ (byte 単位)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-381">Size of this descriptor in bytes.</span></span> |
| <span data-ttu-id="7b5c3-382">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-382">1</span></span>      | <span data-ttu-id="7b5c3-383">bDescriptorType</span><span class="sxs-lookup"><span data-stu-id="7b5c3-383">bDescriptorType</span></span>     | <span data-ttu-id="7b5c3-384">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-384">1</span></span>    | <span data-ttu-id="7b5c3-385">一定</span><span class="sxs-lookup"><span data-stu-id="7b5c3-385">Constant</span></span> | <span data-ttu-id="7b5c3-386">CONFIGURATION</span><span class="sxs-lookup"><span data-stu-id="7b5c3-386">CONFIGURATION</span></span>                     |
| <span data-ttu-id="7b5c3-387">2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-387">2</span></span>      | <span data-ttu-id="7b5c3-388">wTotalLength</span><span class="sxs-lookup"><span data-stu-id="7b5c3-388">wTotalLength</span></span>        | <span data-ttu-id="7b5c3-389">2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-389">2</span></span>    | <span data-ttu-id="7b5c3-390">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-390">Number</span></span>   | <span data-ttu-id="7b5c3-391">この構成に対して返されるデータの合計長さ。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-391">Total length of data returned for this configuration.</span></span> <span data-ttu-id="7b5c3-392">この構成に対して返されるすべての記述子 (構成、インターフェイス、エンドポイント、クラスまたはベンダー固有) を合計した長さが含まれます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-392">Includes the combined length of all descriptors (configuration, interface, endpoint, and class or vendor specific) returned for this configuration.</span></span> |
| <span data-ttu-id="7b5c3-393">4</span><span class="sxs-lookup"><span data-stu-id="7b5c3-393">4</span></span>      | <span data-ttu-id="7b5c3-394">bNumInterfaces</span><span class="sxs-lookup"><span data-stu-id="7b5c3-394">bNumInterfaces</span></span>      | <span data-ttu-id="7b5c3-395">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-395">1</span></span>    | <span data-ttu-id="7b5c3-396">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-396">Number</span></span>   | <span data-ttu-id="7b5c3-397">この構成でサポートされるインターフェイスの数。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-397">Number of interfaces supported by this configuration.</span></span> |
| <span data-ttu-id="7b5c3-398">5</span><span class="sxs-lookup"><span data-stu-id="7b5c3-398">5</span></span>      | <span data-ttu-id="7b5c3-399">bConfigurationValue</span><span class="sxs-lookup"><span data-stu-id="7b5c3-399">bConfigurationValue</span></span> | <span data-ttu-id="7b5c3-400">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-400">1</span></span>    | <span data-ttu-id="7b5c3-401">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-401">Number</span></span>   | <span data-ttu-id="7b5c3-402">この構成を選択するために Set</span><span class="sxs-lookup"><span data-stu-id="7b5c3-402">Value to use as an argument to Set</span></span><br/><span data-ttu-id="7b5c3-403">Configuration の引数として使用する値。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-403">Configuration to select this configuration.</span></span> |
| <span data-ttu-id="7b5c3-404">6</span><span class="sxs-lookup"><span data-stu-id="7b5c3-404">6</span></span>      | <span data-ttu-id="7b5c3-405">iConfiguration</span><span class="sxs-lookup"><span data-stu-id="7b5c3-405">iConfiguration</span></span>      | <span data-ttu-id="7b5c3-406">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-406">1</span></span>    | <span data-ttu-id="7b5c3-407">インデックス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-407">Index</span></span>    | <span data-ttu-id="7b5c3-408">この構成を記述する文字列記述子のインデックス。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-408">Index of string descriptor describing this configuration.</span></span> |
| <span data-ttu-id="7b5c3-409">7</span><span class="sxs-lookup"><span data-stu-id="7b5c3-409">7</span></span>      | <span data-ttu-id="7b5c3-410">bMAttributes</span><span class="sxs-lookup"><span data-stu-id="7b5c3-410">bMAttributes</span></span>        | <span data-ttu-id="7b5c3-411">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-411">1</span></span>    | <span data-ttu-id="7b5c3-412">Bitmap</span><span class="sxs-lookup"><span data-stu-id="7b5c3-412">Bitmap</span></span>   | <span data-ttu-id="7b5c3-413">構成特性 D7 バス パワー</span><span class="sxs-lookup"><span data-stu-id="7b5c3-413">Configuration characteristics D7 Bus Powered</span></span><br /><span data-ttu-id="7b5c3-414">D6 セルフ パワー</span><span class="sxs-lookup"><span data-stu-id="7b5c3-414">D6 Self Powered</span></span><br /><span data-ttu-id="7b5c3-415">D5 リモート ウェイクアップ</span><span class="sxs-lookup"><span data-stu-id="7b5c3-415">D5 Remote Wakeup</span></span><br /><span data-ttu-id="7b5c3-416">D4..0 予約済み (0 にリセット)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-416">D4..0 Reserved (reset to 0)</span></span><br /><span data-ttu-id="7b5c3-417">バス パワーおよびローカル電源を使用するデバイス構成では、D7 と D6 の両方を設定します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-417">A device configuration that uses power from the bus and a local source sets both D7 and D6.</span></span> <span data-ttu-id="7b5c3-418">実行時の実際の電源は、Get Status デバイス要求を使用して決定することもできます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-418">The actual power source at runtime may be determined using the Get Status device request.</span></span><br /><span data-ttu-id="7b5c3-419">デバイス構成がリモート ウェイクアップをサポートしている場合は、D5 を 1 に設定します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-419">If a device configuration supports remote wakeup, D5 is set to 1.</span></span> |
| <span data-ttu-id="7b5c3-420">8</span><span class="sxs-lookup"><span data-stu-id="7b5c3-420">8</span></span>      | <span data-ttu-id="7b5c3-421">MaxPower</span><span class="sxs-lookup"><span data-stu-id="7b5c3-421">MaxPower</span></span>            | <span data-ttu-id="7b5c3-422">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-422">1</span></span>    | <span data-ttu-id="7b5c3-423">mA</span><span class="sxs-lookup"><span data-stu-id="7b5c3-423">mA</span></span>       | <span data-ttu-id="7b5c3-424">デバイスが完全に動作しているときの、この特定の構成における USB デバイスのバス パワーからの最大消費電力。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-424">Maximum power consumption of USB device from the bus in this specific configuration when the device is fully operational.</span></span><br /><span data-ttu-id="7b5c3-425">2 mA 単位で表現します (例: 50 = 100 mA)。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-425">Expressed in 2 mA units (e.g., 50 = 100 mA).</span></span><br /><span data-ttu-id="7b5c3-426">注: デバイス構成は、構成がバスパワーとセルフパワーのどちらであるかを報告します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-426">Note: A device configuration reports whether the configuration is bus-powered or self-powered.</span></span><br /><span data-ttu-id="7b5c3-427">デバイスの状態は、デバイスが現在セルフパワーで動作しているかどうかを報告します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-427">Device status reports whether the device is currently self-powered.</span></span> <span data-ttu-id="7b5c3-428">デバイスの外部電源との接続が切断された場合、デバイスの状態が更新され、セルフパワーではなくなったことが示されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-428">If a device is disconnected from its external power source, it updates device status to indicate that it is no longer self-powered.</span></span> |

<span data-ttu-id="7b5c3-429">USBX では、USB 構成記述子を次のように定義します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-429">USBX defines a USB configuration descriptor as follows.</span></span>

```c
typedef struct UX_CONFIGURATION_DESCRIPTOR_STRUCT
{
    UINT bLength;
    UINT bDescriptorType;
    USHORT wTotalLength;
    UINT bNumInterfaces;
    UINT bConfigurationValue;
    UINT iConfiguration;
    UINT bmAttributes;
    UINT MaxPower;
} UX_CONFIGURATION_DESCRIPTOR;
```

<span data-ttu-id="7b5c3-430">USB 構成記述子は、次に示す構成コンテナーの一部となっています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-430">The USB configuration descriptor is part of a configuration container described as shown below.</span></span>

```c
typedef struct UX_CONFIGURATION_STRUCT
{
    ULONG ux_configuration_handle;
    ULONG ux_configuration_state;
    struct UX_CONFIGURATION_DESCRIPTOR_STRUCT ux_configuration_descriptor;
    struct UX_INTERFACE_STRUCT *ux_configuration_first_interface;
    struct UX_CONFIGURATION_STRUCT *ux_configuration_next_configuration;
    struct UX_DEVICE_STRUCT *ux_configuration_device;
} UX_CONFIGURATION;
```

- <span data-ttu-id="7b5c3-431">**ux_configuration_handle**: 構成のハンドル。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-431">**ux_configuration_handle**: Handle of the configuration.</span></span> <span data-ttu-id="7b5c3-432">これは通常、構成のこの構造体のインスタンスのアドレスです。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-432">This is typically the address of the instance of this structure for the configuration.</span></span>
- <span data-ttu-id="7b5c3-433">**ux_configuration_state**: 構成の状態。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-433">**ux_configuration_state**: State of the configuration.</span></span>
- <span data-ttu-id="7b5c3-434">**ux_configuration_descriptor**: USB デバイス記述子。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-434">**ux_configuration_descriptor**: USB device descriptor.</span></span>
- <span data-ttu-id="7b5c3-435">**ux_configuration_first_interface**: この構成の最初のインターフェイスへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-435">**ux_configuration_first_interface**: Pointer to the first interface for this configuration.</span></span>
- <span data-ttu-id="7b5c3-436">**ux_configuration_next_configuration**: 同じデバイスの次の構成へのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-436">**ux_configuration_next_configuration**: Pointer to the next configuration for the same device.</span></span>
- <span data-ttu-id="7b5c3-437">**ux_configuration_device**: この構成のデバイス所有者へのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-437">**ux_configuration_device**: Pointer to the device owner of this configuration.</span></span>

### <a name="interface-descriptors"></a><span data-ttu-id="7b5c3-438">インターフェイス記述子</span><span class="sxs-lookup"><span data-stu-id="7b5c3-438">Interface Descriptors</span></span>

<span data-ttu-id="7b5c3-439">インターフェイス記述子には、構成内の特定のインターフェイスを記述します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-439">The interface descriptor describes a specific interface within a configuration.</span></span> <span data-ttu-id="7b5c3-440">インターフェイスとは、USB デバイス内の論理機能です。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-440">An interface is a logical function within a USB device.</span></span> <span data-ttu-id="7b5c3-441">構成には、1 つ以上のインターフェイスが用意されています。各インターフェイスには、構成内のエンドポイントの一意のセットを記述する 0 個以上のエンドポイント記述子が含まれます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-441">A configuration provides one or more interfaces, each with zero or more endpoint descriptors describing a unique set of endpoints within the configuration.</span></span> <span data-ttu-id="7b5c3-442">複数のインターフェイスをサポートしている構成の場合、特定のインターフェイスのエンドポイント記述子は、指定された構成の **GET_DESCRIPTOR** 要求によって返されるデータに含まれるインターフェイス記述子に従います。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-442">When a configuration supports more than one interface, the endpoint descriptors for a particular interface follow the interface descriptor in the data returned by the **GET_DESCRIPTOR** request for the specified configuration.</span></span>

<span data-ttu-id="7b5c3-443">インターフェイス記述子は、常に構成記述子の一部として返されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-443">An interface descriptor is always returned as part of a configuration descriptor.</span></span> <span data-ttu-id="7b5c3-444">GET_DESCRIPTOR 要求によってインターフェイス記述子に直接アクセスすることはできません。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-444">An interface descriptor cannot be directly access by a GET_DESCRIPTOR request.</span></span>

<span data-ttu-id="7b5c3-445">インターフェイスには、デバイスが構成された後にエンドポイントやその特性を変化させることを可能にする代替設定を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-445">An interface may include alternate settings that allow the endpoints and/or their characteristics to be varied after the device has been configured.</span></span> <span data-ttu-id="7b5c3-446">インターフェイスの既定の設定では、常に代替設定は 0 です。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-446">The default setting for an interface is always alternate setting zero.</span></span> <span data-ttu-id="7b5c3-447">クラスによって現在の代替設定を変更して、インターフェイスの動作および関連するエンドポイントの特性を変更することができます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-447">A class can select to change the current alternate setting to change the interface behavior and the characteristics of the associated endpoints.</span></span> <span data-ttu-id="7b5c3-448">代替設定の選択や既定の設定への復帰には、SET_INTERFACE 要求を使用します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-448">The SET_INTERFACE request is used to select an alternate setting or to return to the default setting.</span></span>

<span data-ttu-id="7b5c3-449">代替設定を使用すると、他のインターフェイスを動作させたままで、デバイスの構成の一部を変更することができます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-449">Alternate settings allow a portion of the device configuration to be varied while other interfaces remain in operation.</span></span> <span data-ttu-id="7b5c3-450">1 つ以上のインターフェイスに対する代替設定を持つ構成の場合、それぞれの設定には、個別のインターフェイス記述子と、その関連するエンドポイントが含まれます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-450">If a configuration has alternate settings for one or more of its interfaces, a separate interface descriptor and its associated endpoints are included for each setting.</span></span>

<span data-ttu-id="7b5c3-451">デバイス構成に 2 つの代替設定を持つ 1 つのインターフェイスが含まれている場合、構成に対して GET_DESCRIPTOR 要求を行うと構成記述子が返され、次に **bInterfaceNumber** フィールドと **bAlternateSetting** フィールドが 0 に設定されたインターフェイス記述子が返され、次いでその設定のエンドポイント記述子が返されます。その後で、もう 1 つのインターフェイス記述子とそれに関連するエンドポイント記述子が返されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-451">If a device configuration contains a single interface with two alternate settings, the GET_DESCRIPTOR request for the configuration would return the configuration descriptor, then the interface descriptor with the **bInterfaceNumber** and **bAlternateSetting** fields set to zero and then the endpoint descriptors for that setting, followed by another interface descriptor and its associated endpoint descriptors.</span></span> <span data-ttu-id="7b5c3-452">2 番目のインターフェイス記述子では、**bInterfaceNumber** フィールドは 0 に設定されていますが、**bAlternateSetting** フィールドは 1 に設定されています。これは、この代替設定が最初のインターフェイスに属していることを示しています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-452">The second interface descriptor's **bInterfaceNumber** field would also be set to zero, but the **bAlternateSetting** field of the second interface descriptor would be set to 1 indicating that this alternate setting belongs to the first interface.</span></span>

<span data-ttu-id="7b5c3-453">関連するエンドポイントを持たないインターフェイスもあります。この場合、そのインターフェイスに対しては既定のコントロール エンドポイントのみが有効です。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-453">An interface may not have any endpoints associated with it, in which case only the default control endpoint is valid for that interface.</span></span>

<span data-ttu-id="7b5c3-454">代替設定は、主にインターフェイスに関連する周期的なエンドポイントに対する要求帯域幅を変更するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-454">Alternate settings are used mainly to change the requested bandwidth for periodic endpoints associated with the interface.</span></span> <span data-ttu-id="7b5c3-455">たとえば、USB スピーカーのストリーミング インターフェイスの場合、最初の代替設定で、アイソクロナス エンドポイントでの帯域幅の要求を 0 とする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-455">For example, a USB speaker streaming interface should have the first alternate setting with a 0 bandwidth demand on its isochronous endpoint.</span></span> <span data-ttu-id="7b5c3-456">その他の代替設定では、オーディオ ストリーミング周波数に応じて異なる帯域幅要件を選択できます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-456">Other alternate settings may select different bandwidth requirements depending on the audio streaming frequency.</span></span>

<span data-ttu-id="7b5c3-457">インターフェイスの USB 記述子は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-457">The USB descriptor for the interface is as follows:</span></span>

| <span data-ttu-id="7b5c3-458">Offset</span><span class="sxs-lookup"><span data-stu-id="7b5c3-458">Offset</span></span> | <span data-ttu-id="7b5c3-459">フィールド</span><span class="sxs-lookup"><span data-stu-id="7b5c3-459">Field</span></span>              | <span data-ttu-id="7b5c3-460">Size</span><span class="sxs-lookup"><span data-stu-id="7b5c3-460">Size</span></span> | <span data-ttu-id="7b5c3-461">値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-461">Value</span></span>     | <span data-ttu-id="7b5c3-462">記述子</span><span class="sxs-lookup"><span data-stu-id="7b5c3-462">Descriptor</span></span>                              |
| ------ | ------------------ | ---- | --------- | --------------------------------------- |
| <span data-ttu-id="7b5c3-463">0</span><span class="sxs-lookup"><span data-stu-id="7b5c3-463">0</span></span>      | <span data-ttu-id="7b5c3-464">bLength</span><span class="sxs-lookup"><span data-stu-id="7b5c3-464">bLength</span></span>            | <span data-ttu-id="7b5c3-465">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-465">1</span></span>    | <span data-ttu-id="7b5c3-466">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-466">Number</span></span>    | <span data-ttu-id="7b5c3-467">この記述子のサイズ (byte 単位)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-467">Size of this descriptor in bytes.</span></span>       |
| <span data-ttu-id="7b5c3-468">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-468">1</span></span>      | <span data-ttu-id="7b5c3-469">bDescriptorType</span><span class="sxs-lookup"><span data-stu-id="7b5c3-469">bDescriptorType</span></span>    | <span data-ttu-id="7b5c3-470">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-470">1</span></span>    | <span data-ttu-id="7b5c3-471">一定</span><span class="sxs-lookup"><span data-stu-id="7b5c3-471">Constant</span></span>  | <span data-ttu-id="7b5c3-472">インターフェイス記述子の型</span><span class="sxs-lookup"><span data-stu-id="7b5c3-472">INTERFACE Descriptor Type</span></span>               |
| <span data-ttu-id="7b5c3-473">2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-473">2</span></span>      | <span data-ttu-id="7b5c3-474">bInterfaceNumber</span><span class="sxs-lookup"><span data-stu-id="7b5c3-474">bInterfaceNumber</span></span>   | <span data-ttu-id="7b5c3-475">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-475">1</span></span>    | <span data-ttu-id="7b5c3-476">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-476">Number</span></span>    | <span data-ttu-id="7b5c3-477">インターフェイスの番号。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-477">Number of interface.</span></span> <span data-ttu-id="7b5c3-478">この構成でサポートされているコンカレント インターフェイスの配列内のインデックスを特定する、0 から始まる値。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-478">Zero-based value identifying the index in the array of concurrent interfaces supported by this configuration.</span></span> |
| <span data-ttu-id="7b5c3-479">3</span><span class="sxs-lookup"><span data-stu-id="7b5c3-479">3</span></span>      | <span data-ttu-id="7b5c3-480">bAltenateSetting</span><span class="sxs-lookup"><span data-stu-id="7b5c3-480">bAltenateSetting</span></span>   | <span data-ttu-id="7b5c3-481">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-481">1</span></span>    | <span data-ttu-id="7b5c3-482">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-482">Number</span></span>    | <span data-ttu-id="7b5c3-483">前のフィールドで特定されたインターフェイスに対する代替設定を選択するために使用される値。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-483">Value used to select alternate setting for the interface identified in the prior field.</span></span> |
| <span data-ttu-id="7b5c3-484">4</span><span class="sxs-lookup"><span data-stu-id="7b5c3-484">4</span></span>      | <span data-ttu-id="7b5c3-485">bNumEndpoints</span><span class="sxs-lookup"><span data-stu-id="7b5c3-485">bNumEndpoints</span></span>      | <span data-ttu-id="7b5c3-486">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-486">1</span></span>    | <span data-ttu-id="7b5c3-487">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-487">Number</span></span>    | <span data-ttu-id="7b5c3-488">このインターフェイスで使用されているエンドポイントの数 (エンドポイント 0 を除く)。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-488">Number of endpoints used by this interface (excluding endpoint zero).</span></span> <span data-ttu-id="7b5c3-489">この値が 0 の場合、このインターフェイスはエンドポイント 0 のみを使用します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-489">If this value is 0, this interface only uses endpoint zero.</span></span> |
| <span data-ttu-id="7b5c3-490">5</span><span class="sxs-lookup"><span data-stu-id="7b5c3-490">5</span></span>      | <span data-ttu-id="7b5c3-491">bInterfaceClass</span><span class="sxs-lookup"><span data-stu-id="7b5c3-491">bInterfaceClass</span></span>    | <span data-ttu-id="7b5c3-492">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-492">1</span></span>    | <span data-ttu-id="7b5c3-493">クラス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-493">Class</span></span>     | <span data-ttu-id="7b5c3-494">クラス コード (USB により割り当てられる)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-494">Class code (assigned by USB)</span></span><br /><span data-ttu-id="7b5c3-495">このフィールドが 0 にリセットされた場合、インターフェイスはどの USB 指定デバイス クラスにも属しません。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-495">If this field is reset to 0, the interface does not belong to any USB specified device class.</span></span><br /><span data-ttu-id="7b5c3-496">このフィールドが 0xFF に設定された場合、インターフェイス クラスはベンダー固有となります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-496">If this field is set to 0xFF, the interface class is vendor specific.</span></span><br /><span data-ttu-id="7b5c3-497">その他の値はすべて、USB による割り当て用に予約されています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-497">All other values are reserved for assignment by USB.</span></span> |
| <span data-ttu-id="7b5c3-498">6</span><span class="sxs-lookup"><span data-stu-id="7b5c3-498">6</span></span>      | <span data-ttu-id="7b5c3-499">bInterfaceSubClass</span><span class="sxs-lookup"><span data-stu-id="7b5c3-499">bInterfaceSubClass</span></span> | <span data-ttu-id="7b5c3-500">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-500">1</span></span>    | <span data-ttu-id="7b5c3-501">サブクラス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-501">SubClass</span></span>  | <span data-ttu-id="7b5c3-502">サブクラス コード (USB により割り当てられる)。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-502">Subclass code (assigned by USB).</span></span><br /><span data-ttu-id="7b5c3-503">これらのコードは、bInterfaceClass フィールドの値によって修飾されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-503">These codes are qualified by the value of the bInterfaceClass field.</span></span> <span data-ttu-id="7b5c3-504">bInterfaceClass フィールドが 0 にリセットされた場合、このフィールドも 0 にリセットする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-504">If the bInterfaceClass field is reset to 0, this field must also be reset to 0.</span></span> <span data-ttu-id="7b5c3-505">bInterfaceClass フィールドが 0xFF に設定されていない場合、すべての値が USB による割り当て用に予約されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-505">If the bInterfaceClass field is not set to 0xFF, all values are reserved for assignment by USB.</span></span> |
| <span data-ttu-id="7b5c3-506">7</span><span class="sxs-lookup"><span data-stu-id="7b5c3-506">7</span></span>      | <span data-ttu-id="7b5c3-507">bInterfaceProtocol</span><span class="sxs-lookup"><span data-stu-id="7b5c3-507">bInterfaceProtocol</span></span> | <span data-ttu-id="7b5c3-508">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-508">1</span></span>    | <span data-ttu-id="7b5c3-509">プロトコル</span><span class="sxs-lookup"><span data-stu-id="7b5c3-509">Protocol</span></span>  | <span data-ttu-id="7b5c3-510">プロトコル コード (USB により割り当てられる)。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-510">Protocol code (assigned by USB).</span></span> <span data-ttu-id="7b5c3-511">これらのコードは、bInterfaceClass フィールドと bInterfaceSubClass フィールドの値によって修飾されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-511">These codes are qualified by the value of the bInterfaceClass and the bInterfaceSubClass fields.</span></span> <span data-ttu-id="7b5c3-512">インターフェイスがクラス固有の要求をサポートしている場合、このコードはデバイスが使用するプロトコルを、デバイス クラスの仕様による定義に従って特定します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-512">If an interface supports class-specific requests, this code identifies the protocols that the device uses as defined by the specification of the device class.</span></span><br /><span data-ttu-id="7b5c3-513">このフィールドが 0 にリセットされた場合、デバイスはこのインターフェイスにクラス固有プロトコルを使用しません。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-513">If this field is reset to 0, the device does not use a class specific protocol on this interface.</span></span> <span data-ttu-id="7b5c3-514">このフィールドが 0xFF に設定された場合、デバイスはこのインターフェイスにベンダー固有プロトコルを使用します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-514">If this field is set to 0xFF, the device uses a vendor specific protocol for this interface.</span></span> |
| <span data-ttu-id="7b5c3-515">8</span><span class="sxs-lookup"><span data-stu-id="7b5c3-515">8</span></span>      | <span data-ttu-id="7b5c3-516">iInterface</span><span class="sxs-lookup"><span data-stu-id="7b5c3-516">iInterface</span></span>         | <span data-ttu-id="7b5c3-517">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-517">1</span></span>    | <span data-ttu-id="7b5c3-518">インデックス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-518">Index</span></span>     | <span data-ttu-id="7b5c3-519">このインターフェイスを記述する文字列記述子のインデックス。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-519">Index of string descriptor describing this interface.</span></span> |

<span data-ttu-id="7b5c3-520">USBX では、USB インターフェイス記述子を次のように定義します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-520">USBX defines a USB interface descriptor as follows.</span></span>

```c
typedef struct UX_INTERFACE_DESCRIPTOR_STRUCT
{
    UINT bLength;
    UINT bDescriptorType;
    UINT bInterfaceNumber;
    UINT bAlternateSetting;
    UINT bNumEndpoints;
    UINT bInterfaceClass
    UINT bInterfaceSubClass;
    UINT bInterfaceProtocol;
    UINT iInterface;
} UX_INTERFACE_DESCRIPTOR;
```

<span data-ttu-id="7b5c3-521">USB インターフェイス記述子は、次に示すインターフェイス コンテナーの一部となっています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-521">The USB interface descriptor is part of an interface container described as follows.</span></span>

```c
typedef struct UX_INTERFACE_STRUCT
{
    ULONG ux_interface_handle;
    ULONG ux_interface_state;
    ULONG ux_interface_current_alternate_setting;
    struct UX_INTERFACE_DESCRIPTOR_STRUCT ux_interface_descriptor;
    struct UX_HOST_CLASS_STRUCT    *ux_interface_class;
    VOID    *ux_interface_class_instance;
    struct UX_ENDPOINT_STRUCT    *ux_interface_first_endpoint;
    struct UX_INTERFACE_STRUCT    *ux_interface_next_interface;
    struct UX_CONFIGURATION_STRUCT    *ux_interface_configuration;
} UX_INTERFACE;
```

- <span data-ttu-id="7b5c3-522">**ux_interface_handle**: インターフェイスのハンドル。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-522">**ux_interface_handle**: Handle of the interface.</span></span> <span data-ttu-id="7b5c3-523">これは通常、インターフェイスのこの構造体のインスタンスのアドレスです。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-523">This is typically the address of the instance of this structure for the interface.</span></span>
- <span data-ttu-id="7b5c3-524">**ux_interface_state**: インターフェイスの状態。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-524">**ux_interface_state**: State of the interface.</span></span>
- <span data-ttu-id="7b5c3-525">**ux_interface_descriptor**: USB インターフェイス記述子。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-525">**ux_interface_descriptor**: USB interface descriptor.</span></span>
- <span data-ttu-id="7b5c3-526">**ux_interface_class**: このインターフェイスを所有するクラス型へのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-526">**ux_interface_class**: Pointer to the class type that owns this interface.</span></span>
- <span data-ttu-id="7b5c3-527">**ux_interface_class_instance**: このインターフェイスを所有するクラスのインスタンスへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-527">**ux_interface_class_instance**: Pointer to the instance of the class that owns this interface.</span></span>
- <span data-ttu-id="7b5c3-528">**ux_interface_first_endpoint**: このインターフェイスで登録される最初のエンドポイントへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-528">**ux_interface_first_endpoint**: Pointer to the first endpoint registered with this interface.</span></span>
- <span data-ttu-id="7b5c3-529">**ux_interface_next_interface**: 構成に関連する次のインターフェイスへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-529">**ux_interface_next_interface**: Pointer to the next interface associated with the configuration.</span></span>
- <span data-ttu-id="7b5c3-530">**ux_interface_configuration**: このインターフェイスの構成所有者へのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-530">**ux_interface_configuration**: Pointer to the configuration owner of this interface.</span></span>

### <a name="endpoint-descriptors"></a><span data-ttu-id="7b5c3-531">エンドポイント記述子</span><span class="sxs-lookup"><span data-stu-id="7b5c3-531">Endpoint Descriptors</span></span>

<span data-ttu-id="7b5c3-532">インターフェイスに関連する各エンドポイントには、それぞれ自身のエンドポイント記述子があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-532">Each endpoint associated with an interface has its own endpoint descriptor.</span></span> <span data-ttu-id="7b5c3-533">この記述子には、各エンドポイントの帯域幅要件、エンドポイントに関連する最大ペイロード、周期性、および方向を決定するためにホスト スタックが必要とする情報を記述します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-533">This descriptor contains the information required by the host stack to determine the bandwidth requirements of each endpoint, the maximum payload associated with the endpoint, its periodicity, and its direction.</span></span> <span data-ttu-id="7b5c3-534">エンドポイント記述子は常に、構成に対する GET_DESCRIPTOR コマンドによって返されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-534">An endpoint descriptor is always returned by a GET_DESCRIPTOR command for the configuration.</span></span>

<span data-ttu-id="7b5c3-535">デバイス記述子に関連する既定のコントロール エンドポイントは、インターフェイスに関連するエンドポイントの一部としてはカウントされないため、この記述子では返されません。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-535">The default control endpoint associated with the device descriptor is not counted as part of the endpoint(s) associated with the interface and therefore not returned in this descriptor.</span></span>

<span data-ttu-id="7b5c3-536">ホスト ソフトウェアがインターフェイスの代替設定の変更を要求すると、関連するすべてのエンドポイントとその USB リソースが新しい代替設定に従って変更されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-536">When the host software requests a change of the alternate setting for an interface, all the associated endpoints and their USB resources are modified according to the new alternate setting.</span></span>

<span data-ttu-id="7b5c3-537">既定のコントロール エンドポイントを除き、エンドポイントをインターフェイス間で共有することはできません。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-537">Except for the default control endpoints, endpoints cannot be share between interfaces.</span></span>

| <span data-ttu-id="7b5c3-538">Offset</span><span class="sxs-lookup"><span data-stu-id="7b5c3-538">Offset</span></span> | <span data-ttu-id="7b5c3-539">フィールド</span><span class="sxs-lookup"><span data-stu-id="7b5c3-539">Field</span></span>            | <span data-ttu-id="7b5c3-540">Size</span><span class="sxs-lookup"><span data-stu-id="7b5c3-540">Size</span></span> | <span data-ttu-id="7b5c3-541">値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-541">Value</span></span>    | <span data-ttu-id="7b5c3-542">説明</span><span class="sxs-lookup"><span data-stu-id="7b5c3-542">Description</span></span>                       |
| ------ | ---------------- | ---- | -------- | --------------------------------- |
| <span data-ttu-id="7b5c3-543">0</span><span class="sxs-lookup"><span data-stu-id="7b5c3-543">0</span></span>      | <span data-ttu-id="7b5c3-544">bLength</span><span class="sxs-lookup"><span data-stu-id="7b5c3-544">bLength</span></span>          | <span data-ttu-id="7b5c3-545">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-545">1</span></span>    | <span data-ttu-id="7b5c3-546">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-546">Number</span></span>   | <span data-ttu-id="7b5c3-547">この記述子のサイズ (byte 単位)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-547">Size of this descriptor in bytes.</span></span> |
| <span data-ttu-id="7b5c3-548">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-548">1</span></span>      | <span data-ttu-id="7b5c3-549">bDescriptorType</span><span class="sxs-lookup"><span data-stu-id="7b5c3-549">bDescriptorType</span></span>  | <span data-ttu-id="7b5c3-550">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-550">1</span></span>    | <span data-ttu-id="7b5c3-551">一定</span><span class="sxs-lookup"><span data-stu-id="7b5c3-551">Constant</span></span> | <span data-ttu-id="7b5c3-552">エンドポイント記述子の型。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-552">ENDPOINT Descriptor Type.</span></span> |
| <span data-ttu-id="7b5c3-553">2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-553">2</span></span>      | <span data-ttu-id="7b5c3-554">bEndpointAddress</span><span class="sxs-lookup"><span data-stu-id="7b5c3-554">bEndpointAddress</span></span> | <span data-ttu-id="7b5c3-555">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-555">1</span></span>    | <span data-ttu-id="7b5c3-556">エンドポイント</span><span class="sxs-lookup"><span data-stu-id="7b5c3-556">Endpoint</span></span> | <span data-ttu-id="7b5c3-557">この記述子によって記述される USB デバイス上のエンドポイントのアドレス。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-557">The address of the endpoint on the USB device described by this descriptor.</span></span> <span data-ttu-id="7b5c3-558">アドレスは次のようにエンコードされます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-558">The address is encoded as follows:</span></span><br /><span data-ttu-id="7b5c3-559">ビット 3...0: エンドポイント番号</span><span class="sxs-lookup"><span data-stu-id="7b5c3-559">Bit 3...0: The endpoint number</span></span><br /><span data-ttu-id="7b5c3-560">ビット 6...4: 予約済み、0 にリセット</span><span class="sxs-lookup"><span data-stu-id="7b5c3-560">Bit 6...4: Reserved, reset to zero</span></span><br /><span data-ttu-id="7b5c3-561">ビット 7: 方向、コントロール エンドポイントの場合は無視</span><span class="sxs-lookup"><span data-stu-id="7b5c3-561">Bit 7: Direction, ignored for control endpoints</span></span><br /><span data-ttu-id="7b5c3-562">0 = OUT エンドポイント</span><span class="sxs-lookup"><span data-stu-id="7b5c3-562">0 = OUT endpoint</span></span><br /><span data-ttu-id="7b5c3-563">1 = IN エンドポイント</span><span class="sxs-lookup"><span data-stu-id="7b5c3-563">1 = IN endpoint</span></span> |
| <span data-ttu-id="7b5c3-564">3</span><span class="sxs-lookup"><span data-stu-id="7b5c3-564">3</span></span>      | <span data-ttu-id="7b5c3-565">bmAttributes</span><span class="sxs-lookup"><span data-stu-id="7b5c3-565">bmAttributes</span></span>     | <span data-ttu-id="7b5c3-566">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-566">1</span></span>    | <span data-ttu-id="7b5c3-567">Bitmap</span><span class="sxs-lookup"><span data-stu-id="7b5c3-567">Bitmap</span></span>   | <span data-ttu-id="7b5c3-568">このフィールドには、**bConfigurationValue** フィールドを使用してエンドポイントを構成する場合のエンドポイントの属性を記述します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-568">This field describes the endpoint's attributes when it is configured using the **bConfigurationValue** field.</span></span> <span data-ttu-id="7b5c3-569">ビット 1..0: 転送の種類</span><span class="sxs-lookup"><span data-stu-id="7b5c3-569">Bits 1..0: Transfer Type</span></span><br /><span data-ttu-id="7b5c3-570">00 = コントロール</span><span class="sxs-lookup"><span data-stu-id="7b5c3-570">00 = Control</span></span><br /><span data-ttu-id="7b5c3-571">01 = アイソクロナス</span><span class="sxs-lookup"><span data-stu-id="7b5c3-571">01 = Isochronous</span></span><br /><span data-ttu-id="7b5c3-572">10 = バルク</span><span class="sxs-lookup"><span data-stu-id="7b5c3-572">10 = Bulk</span></span><br /><span data-ttu-id="7b5c3-573">11 = 割り込み</span><span class="sxs-lookup"><span data-stu-id="7b5c3-573">11 = Interrupt</span></span><br /><span data-ttu-id="7b5c3-574">アイソクロナス エンドポイントでない場合は、ビット 5..2 は予約されており、0 に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-574">If not an isochronous endpoint, bits 5..2 are reserved and must be set to zero.</span></span> <span data-ttu-id="7b5c3-575">アイソクロナスの場合は、次のように定義されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-575">If isochronous, they are defined as follows:</span></span><br /><span data-ttu-id="7b5c3-576">ビット 3..2: 同期の種類</span><span class="sxs-lookup"><span data-stu-id="7b5c3-576">Bits 3..2: Synchronization Type</span></span><br /><span data-ttu-id="7b5c3-577">00 = 同期なし</span><span class="sxs-lookup"><span data-stu-id="7b5c3-577">00 = No Synchronization</span></span><br /><span data-ttu-id="7b5c3-578">01 = 非同期</span><span class="sxs-lookup"><span data-stu-id="7b5c3-578">01 = Asynchronous</span></span><br /><span data-ttu-id="7b5c3-579">10 = 適応</span><span class="sxs-lookup"><span data-stu-id="7b5c3-579">10 = Adaptive</span></span><br /><span data-ttu-id="7b5c3-580">11 = 同期</span><span class="sxs-lookup"><span data-stu-id="7b5c3-580">11 = Synchronous</span></span><br /><span data-ttu-id="7b5c3-581">ビット 5..4: 使用法の種類</span><span class="sxs-lookup"><span data-stu-id="7b5c3-581">Bits 5..4: Usage Type</span></span><br /><span data-ttu-id="7b5c3-582">00 = データ エンドポイント</span><span class="sxs-lookup"><span data-stu-id="7b5c3-582">00 = Data endpoint</span></span><br /><span data-ttu-id="7b5c3-583">01 = フィードバック エンドポイント</span><span class="sxs-lookup"><span data-stu-id="7b5c3-583">01 = Feedback endpoint</span></span><br /><span data-ttu-id="7b5c3-584">10 = 暗黙のフィードバック データ エンドポイント</span><span class="sxs-lookup"><span data-stu-id="7b5c3-584">10 = Implicit feedback data endpoint</span></span><br /><span data-ttu-id="7b5c3-585">11 = 予約済み</span><span class="sxs-lookup"><span data-stu-id="7b5c3-585">11 = Reserved</span></span> |
| <span data-ttu-id="7b5c3-586">4</span><span class="sxs-lookup"><span data-stu-id="7b5c3-586">4</span></span>      | <span data-ttu-id="7b5c3-587">wMaxPacketSize</span><span class="sxs-lookup"><span data-stu-id="7b5c3-587">wMaxPacketSize</span></span>   | <span data-ttu-id="7b5c3-588">2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-588">2</span></span>    | <span data-ttu-id="7b5c3-589">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-589">Number</span></span>   | <span data-ttu-id="7b5c3-590">この構成を選択した場合に、このエンドポイントで送受信できる最大パケット サイズ。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-590">Maximum packet size this endpoint is capable of sending or receiving when this configuration is selected.</span></span><br /><span data-ttu-id="7b5c3-591">アイソクロナス エンドポイントの場合、この値を使用して、(マイクロ) フレームあたりのデータ ペイロードに必要となるバス時間をスケジュールに予約します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-591">For isochronous endpoints, this value is used to reserve the bus time in the schedule, required for the per-(micro)frame data payloads.</span></span> <span data-ttu-id="7b5c3-592">パイプで実際に継続的に使用される帯域幅は、予約した帯域幅よりも少ない場合があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-592">The pipe may, on an ongoing basis, actually use less bandwidth than that reserved.</span></span> <span data-ttu-id="7b5c3-593">デバイスは必要に応じて、通常の非 USB 定義のメカニズムを介して実際に使用された帯域幅を報告します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-593">The device reports, if necessary, the actual bandwidth used via its normal, non-USB defined mechanisms.</span></span><br /><span data-ttu-id="7b5c3-594">すべてのエンドポイントについて、ビット 10..0 は最大パケット サイズ (バイト単位) を指定します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-594">For all endpoints, bits 10..0 specify the maximum packet size (in bytes).</span></span><br /><span data-ttu-id="7b5c3-595">高速アイソクロナスおよび割り込みエンドポイントの場合:</span><span class="sxs-lookup"><span data-stu-id="7b5c3-595">For high-speed isochronous and interrupt endpoints:</span></span><br /><span data-ttu-id="7b5c3-596">ビット 12..11 では、マイクロ フレームあたりの追加トランザクションの機会の数を指定します。00 = なし (マイクロ フレームあたり 1 トランザクション)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-596">Bits 12..11 specify the number of additional transaction opportunities per microframe: 00 = None (1 transaction per microframe)</span></span><br /><span data-ttu-id="7b5c3-597">01 = 1 つ追加 (マイクロ フレームあたり 2)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-597">01 = 1 additional (2 per microframe)</span></span><br /><span data-ttu-id="7b5c3-598">10 = 2 つ追加 (マイクロ フレームあたり 3)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-598">10 = 2 additional (3 per microframe)</span></span><br /><span data-ttu-id="7b5c3-599">11 = 予約済み</span><span class="sxs-lookup"><span data-stu-id="7b5c3-599">11 = Reserved</span></span><br /><span data-ttu-id="7b5c3-600">ビット 15..13 は予約されており、0 に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-600">Bits 15..13 are reserved and must be set to zero.</span></span> |
| <span data-ttu-id="7b5c3-601">6</span><span class="sxs-lookup"><span data-stu-id="7b5c3-601">6</span></span>      | <span data-ttu-id="7b5c3-602">bInterval</span><span class="sxs-lookup"><span data-stu-id="7b5c3-602">bInterval</span></span>        | <span data-ttu-id="7b5c3-603">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-603">1</span></span>     | <span data-ttu-id="7b5c3-604">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-604">Number</span></span>   | <span data-ttu-id="7b5c3-605">データ転送用にエンドポイントをポーリングする間隔の値。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-605">Number interval for polling endpoint for data transfers.</span></span><br /><span data-ttu-id="7b5c3-606">デバイスの動作速度に応じて、フレームまたはマイクロ フレームで表現されます (1 ミリ秒または 125 マイクロ秒単位のいずれか)。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-606">Expressed in frames or microframes depending on the device operating speed (i.e., either 1 millisecond or 125 µs units).</span></span><br /><span data-ttu-id="7b5c3-607">全速/高速アイソクロナス エンドポイントの場合、この値は 1 から 16 の範囲内である必要があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-607">For full-/high-speed isochronous endpoints, this value must be in the range from 1 to 16.</span></span> <span data-ttu-id="7b5c3-608">**bInterval** は、2bInterval - 1 乗の指数の値として使用されます。たとえば、**bInterval** を 4 とすると、周期は 8 (24-1) となります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-608">The **bInterval** is used as the exponent for a 2bInterval-1 value; e.g., a **bInterval** 4 means a period of 8 (24-1).</span></span><br /><span data-ttu-id="7b5c3-609">全速/低速割り込みエンドポイントの場合、このフィールドの値は 1 から 255 の範囲とすることができます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-609">For full-/low-speed interrupt endpoints, the value of this field may be from 1 to 255.</span></span><br /><span data-ttu-id="7b5c3-610">高速割り込みエンドポイントの場合、**bInterval** は、2bInterval - 1 乗の指数の値として使用されます。たとえば、**bInterval** を 4 とすると、周期は 8 (24-1) となります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-610">For high-speed interrupt endpoints, the **bInterval** is used as the exponent for a 2bInterval-1 value; e.g., a **bInterval** 4 means a period of 8 (24-1).</span></span> <span data-ttu-id="7b5c3-611">この値は、1 から 16 の範囲内とする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-611">This value must be from 1 to 16.</span></span><br /><span data-ttu-id="7b5c3-612">高速バルク/コントロール OUT エンドポイントの場合、**bInterval** ではエンドポイントの最大 NAK 率を指定します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-612">For high-speed bulk/control OUT endpoints, the **bInterval** specify the maximum NAK rate of the endpoint.</span></span> <span data-ttu-id="7b5c3-613">値 0 は、エンドポイントで NAK が絶対に発生しないことを示します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-613">A value of 0 indicates the endpoint never NAKs.</span></span> <span data-ttu-id="7b5c3-614">その他の値では、**bInterval** マイクロ フレームごとに最大 1 回の NAK であることを示します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-614">Other values indicate at most one NAK each **bInterval** of microframes.</span></span><br /><span data-ttu-id="7b5c3-615">この値は、0 から 255 の範囲内である必要があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-615">This value must be in the range from 0 to 255.</span></span> |

<span data-ttu-id="7b5c3-616">USBX では、USB エンドポイント記述子を次のように定義します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-616">USBX defines a USB endpoint descriptor as follows:</span></span>

```c
typedef struct UX_ENDPOINT_DESCRIPTOR_STRUCT
{
    UINT bLength;
    UINT bDescriptorType;
    UINT bEndpointAddress;
    UINT bmAttributes;
    USHORT wMaxPacketSize;
    UINT bInterval;
} UX_ENDPOINT_DESCRIPTOR;
```

<span data-ttu-id="7b5c3-617">USB エンドポイント記述子は、次に示すエンドポイント コンテナーの一部となっています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-617">The USB endpoint descriptor is part of an endpoint container, which is described as follows.</span></span>

```c
typedef struct UX_ENDPOINT_STRUCT {
    ULONG    ux_endpoint_handle;
    ULONG    ux_endpoint_state;
    VOID    *ux_endpoint_ed;
    struct UX_ENDPOINT_DESCRIPTOR_STRUCT    ux_endpoint_descriptor;
    struct UX_ENDPOINT_STRUCT    *ux_endpoint_next_endpoint;
    struct UX_INTERFACE_STRUCT    *ux_endpoint_interface;
    struct UX_DEVICE_STRUCT    *ux_endpoint_device;
    struct UX_TRANSFER REQUEST_STRUCT    ux_endpoint_transfer request;
} UX_ENDPOINT;

```

- <span data-ttu-id="7b5c3-618">**ux_endpoint_handle**: エンドポイントのハンドル。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-618">**ux_endpoint_handle**: Handle of the endpoint.</span></span> <span data-ttu-id="7b5c3-619">これは通常、エンドポイントのこの構造体のインスタンスのアドレスです。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-619">This is typically the address of the instance of this structure for the endpoint.</span></span>
- <span data-ttu-id="7b5c3-620">**ux_endpoint_state**: エンドポイントの状態。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-620">**ux_endpoint_state**: State of the endpoint.</span></span>
- <span data-ttu-id="7b5c3-621">**ux_endpoint_ed**: ホスト コントローラー レイヤーでの物理エンドポイントへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-621">**ux_endpoint_ed**: Pointer to the physical endpoint at the host controller layer.</span></span>
- <span data-ttu-id="7b5c3-622">**ux_endpoint_descriptor**: USB エンドポイント記述子。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-622">**ux_endpoint_descriptor**: USB endpoint descriptor.</span></span>
- <span data-ttu-id="7b5c3-623">**ux_endpoint_next_endpoint**: 同じインターフェイスに属する次のエンドポイントへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-623">**ux_endpoint_next_endpoint**: Pointer to the next endpoint that belongs to the same interface.</span></span>
- <span data-ttu-id="7b5c3-624">**ux_endpoint_interface**: このエンドポイント インターフェイスを所有するインターフェイスへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-624">**ux_endpoint_interface**: Pointer to the interface that owns this endpoint interface.</span></span>
- <span data-ttu-id="7b5c3-625">**ux_endpoint_device**: 親デバイス コンテナーへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-625">**ux_endpoint_device**: Pointer to the parent device container.</span></span>
- <span data-ttu-id="7b5c3-626">**ux_endpoint_transfer request**: デバイスとの間でデータを送受信するために使用される USB 転送要求。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-626">**ux_endpoint_transfer request**: USB transfer request used to send/receive data from to/from the device.</span></span>

### <a name="string-descriptors"></a><span data-ttu-id="7b5c3-627">文字列記述子</span><span class="sxs-lookup"><span data-stu-id="7b5c3-627">String descriptors</span></span>

<span data-ttu-id="7b5c3-628">文字列記述子は省略可能です。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-628">String descriptors are optional.</span></span> <span data-ttu-id="7b5c3-629">デバイスで文字列記述子がサポートされていない場合は、デバイス記述子、構成記述子、およびインターフェイス記述子内に含まれる文字列記述子への参照を、すべて 0 にリセットする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-629">If a device does not support string descriptors, all references to string descriptors within device, configuration, and interface descriptors must be reset to zero.</span></span>

<span data-ttu-id="7b5c3-630">文字列記述子では UNICODE エンコードが使用されるため、複数の文字セットをサポートできます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-630">String descriptors use UNICODE encoding, thus allowing the support for several character sets.</span></span> <span data-ttu-id="7b5c3-631">USB デバイス内の文字列は、複数の言語をサポートすることが可能です。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-631">The strings in a USB device may support multiple languages.</span></span> <span data-ttu-id="7b5c3-632">文字列記述子を要求する際に要求元は、USB-IF によって定義されている言語 ID を使用して目的の言語を指定します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-632">When requesting a string descriptor, the requester specifies the desired language using a language ID defined by the USB-IF.</span></span> <span data-ttu-id="7b5c3-633">現在定義されている USB LANGID の一覧については、『USBX 付録 ??』を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-633">The list of currently defined USB LANGIDs can be found in the USBX appendix ??.</span></span>
<span data-ttu-id="7b5c3-634">すべての言語に対して文字列インデックスを 0 にすると、デバイスでサポートされている 2 バイトの LANGID コードの配列を含む文字列記述子が返されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-634">String index zero for all languages returns a string descriptor that contains an array of two-byte LANGID codes supported by the device.</span></span> <span data-ttu-id="7b5c3-635">UNICODE 文字列は 0 で終端しない点に注意してください。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-635">It should be noted that the UNICODE string is not 0 terminated.</span></span> <span data-ttu-id="7b5c3-636">代わりに、記述子の先頭バイトに格納されている配列のサイズから 2 を減算することで、文字列配列のサイズを計算します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-636">Instead, the size of the string array is computed by subtracting two from the size of the array contained in the first byte of the descriptor.</span></span>

<span data-ttu-id="7b5c3-637">USB 文字列記述子 0 は、次のようにエンコードされます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-637">The USB string descriptor 0 is encoded as follows.</span></span>

| <span data-ttu-id="7b5c3-638">Offset</span><span class="sxs-lookup"><span data-stu-id="7b5c3-638">Offset</span></span> | <span data-ttu-id="7b5c3-639">フィールド</span><span class="sxs-lookup"><span data-stu-id="7b5c3-639">Field</span></span>           | <span data-ttu-id="7b5c3-640">Size</span><span class="sxs-lookup"><span data-stu-id="7b5c3-640">Size</span></span> | <span data-ttu-id="7b5c3-641">値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-641">Value</span></span>    | <span data-ttu-id="7b5c3-642">説明</span><span class="sxs-lookup"><span data-stu-id="7b5c3-642">Description</span></span>                      |
| ------ | --------------- | ---- | -------- | -------------------------------- |
| <span data-ttu-id="7b5c3-643">0</span><span class="sxs-lookup"><span data-stu-id="7b5c3-643">0</span></span>      | <span data-ttu-id="7b5c3-644">bLength</span><span class="sxs-lookup"><span data-stu-id="7b5c3-644">bLength</span></span>         | <span data-ttu-id="7b5c3-645">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-645">1</span></span>    | <span data-ttu-id="7b5c3-646">N+2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-646">N+2</span></span>      | <span data-ttu-id="7b5c3-647">この記述子のサイズ (byte 単位)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-647">Size of this descriptor in bytes</span></span> |
| <span data-ttu-id="7b5c3-648">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-648">1</span></span>      | <span data-ttu-id="7b5c3-649">bDescriptorType</span><span class="sxs-lookup"><span data-stu-id="7b5c3-649">bDescriptorType</span></span> | <span data-ttu-id="7b5c3-650">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-650">1</span></span>    | <span data-ttu-id="7b5c3-651">一定</span><span class="sxs-lookup"><span data-stu-id="7b5c3-651">Constant</span></span> | <span data-ttu-id="7b5c3-652">文字列記述子の型</span><span class="sxs-lookup"><span data-stu-id="7b5c3-652">STRING Descriptor Type</span></span>           |
| <span data-ttu-id="7b5c3-653">2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-653">2</span></span>      | <span data-ttu-id="7b5c3-654">wLANGID[0]</span><span class="sxs-lookup"><span data-stu-id="7b5c3-654">wLANGID[0]</span></span>      | <span data-ttu-id="7b5c3-655">2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-655">2</span></span>    | <span data-ttu-id="7b5c3-656">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-656">Number</span></span>   | <span data-ttu-id="7b5c3-657">LANGID コード 0</span><span class="sxs-lookup"><span data-stu-id="7b5c3-657">LANGID code 0</span></span>                    |
| <span data-ttu-id="7b5c3-658">...</span><span class="sxs-lookup"><span data-stu-id="7b5c3-658">...</span></span>    | <span data-ttu-id="7b5c3-659">...]</span><span class="sxs-lookup"><span data-stu-id="7b5c3-659">...]</span></span>            | <span data-ttu-id="7b5c3-660">...</span><span class="sxs-lookup"><span data-stu-id="7b5c3-660">...</span></span>  | <span data-ttu-id="7b5c3-661">...</span><span class="sxs-lookup"><span data-stu-id="7b5c3-661">...</span></span>      | <span data-ttu-id="7b5c3-662">...</span><span class="sxs-lookup"><span data-stu-id="7b5c3-662">...</span></span>                              |
| <span data-ttu-id="7b5c3-663">N</span><span class="sxs-lookup"><span data-stu-id="7b5c3-663">N</span></span>      | <span data-ttu-id="7b5c3-664">wLANGID[n]</span><span class="sxs-lookup"><span data-stu-id="7b5c3-664">wLANGID[n]</span></span>      | <span data-ttu-id="7b5c3-665">2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-665">2</span></span>    | <span data-ttu-id="7b5c3-666">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-666">Number</span></span>   | <span data-ttu-id="7b5c3-667">LANGID コード n</span><span class="sxs-lookup"><span data-stu-id="7b5c3-667">LANGID code n</span></span>                    |

<span data-ttu-id="7b5c3-668">他の USB 文字列記述子は、次のようにエンコードされます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-668">Other USB string descriptors are encoded as follows.</span></span>

| <span data-ttu-id="7b5c3-669">Offset</span><span class="sxs-lookup"><span data-stu-id="7b5c3-669">Offset</span></span> | <span data-ttu-id="7b5c3-670">フィールド</span><span class="sxs-lookup"><span data-stu-id="7b5c3-670">Field</span></span>           | <span data-ttu-id="7b5c3-671">Size</span><span class="sxs-lookup"><span data-stu-id="7b5c3-671">Size</span></span> | <span data-ttu-id="7b5c3-672">値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-672">Value</span></span>    | <span data-ttu-id="7b5c3-673">説明</span><span class="sxs-lookup"><span data-stu-id="7b5c3-673">Description</span></span>                      |
| ------ | --------------- | ---- | -------- | -------------------------------- |
| <span data-ttu-id="7b5c3-674">0</span><span class="sxs-lookup"><span data-stu-id="7b5c3-674">0</span></span>      | <span data-ttu-id="7b5c3-675">bLength</span><span class="sxs-lookup"><span data-stu-id="7b5c3-675">bLength</span></span>         | <span data-ttu-id="7b5c3-676">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-676">1</span></span>    | <span data-ttu-id="7b5c3-677">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-677">Number</span></span>   | <span data-ttu-id="7b5c3-678">この記述子のサイズ (byte 単位)</span><span class="sxs-lookup"><span data-stu-id="7b5c3-678">Size of this descriptor in bytes</span></span> |
| <span data-ttu-id="7b5c3-679">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-679">1</span></span>      | <span data-ttu-id="7b5c3-680">bDescriptorType</span><span class="sxs-lookup"><span data-stu-id="7b5c3-680">bDescriptorType</span></span> | <span data-ttu-id="7b5c3-681">1</span><span class="sxs-lookup"><span data-stu-id="7b5c3-681">1</span></span>    | <span data-ttu-id="7b5c3-682">一定</span><span class="sxs-lookup"><span data-stu-id="7b5c3-682">Constant</span></span> | <span data-ttu-id="7b5c3-683">文字列記述子の型</span><span class="sxs-lookup"><span data-stu-id="7b5c3-683">STRING Descriptor Type</span></span>           |
| <span data-ttu-id="7b5c3-684">2</span><span class="sxs-lookup"><span data-stu-id="7b5c3-684">2</span></span>      | <span data-ttu-id="7b5c3-685">bString</span><span class="sxs-lookup"><span data-stu-id="7b5c3-685">bString</span></span>         | <span data-ttu-id="7b5c3-686">n</span><span class="sxs-lookup"><span data-stu-id="7b5c3-686">n</span></span>    | <span data-ttu-id="7b5c3-687">数値</span><span class="sxs-lookup"><span data-stu-id="7b5c3-687">Number</span></span>   | <span data-ttu-id="7b5c3-688">UNICODE でエンコードされた文字列</span><span class="sxs-lookup"><span data-stu-id="7b5c3-688">UNICODE encoded string</span></span>           |

<span data-ttu-id="7b5c3-689">USBX では、非 0 長の USB 文字列記述子を次のように定義します。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-689">USBX defines a non-zero length USB string descriptor as follows:</span></span>

```c
typedef struct UX_STRING_DESCRIPTOR_STRUCT
{
    UINT bLength;
    UINT bDescriptorType;
    USHORT bString[1];
} UX_STRING_DESCRIPTOR;
```

### <a name="functional-descriptors"></a><span data-ttu-id="7b5c3-690">機能記述子</span><span class="sxs-lookup"><span data-stu-id="7b5c3-690">Functional Descriptors</span></span>

<span data-ttu-id="7b5c3-691">機能記述子は、クラス固有記述子とも呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-691">Functional descriptors are also known as class-specific descriptors.</span></span> <span data-ttu-id="7b5c3-692">通常は、汎用記述子と同じ基本構造を使用し、追加情報がクラスで使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-692">They normally use the same basic structures as generic descriptors and allow for additional information to be available to the class.</span></span> <span data-ttu-id="7b5c3-693">たとえば USB オーディオ スピーカーの場合、クラス固有記述子を使用すると、オーディオ クラスはサポートされるオーディオ周波数の種類を代替設定ごとに取得できます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-693">For example, in the case of the USB audio speaker, class specific descriptors allow the audio class to retrieve for each alternate setting the type of audio frequency supported.</span></span>

### <a name="usbx-device-descriptor-framework-in-memory"></a><span data-ttu-id="7b5c3-694">メモリ内の USBX デバイス記述子フレームワーク</span><span class="sxs-lookup"><span data-stu-id="7b5c3-694">USBX Device Descriptor Framework in Memory</span></span>

<span data-ttu-id="7b5c3-695">USBX では、ほとんどのデバイス記述子、すなわち文字列と機能記述子を除くすべての記述子がメモリ内に保持されます。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-695">USBX maintains most device descriptors in memory, that is, all descriptors except the string and functional descriptors.</span></span> <span data-ttu-id="7b5c3-696">次の図は、これらの記述子がどのように格納され、関連するかを示しています。</span><span class="sxs-lookup"><span data-stu-id="7b5c3-696">The following diagram shows how these descriptors are stored and related.</span></span>

![メモリ内の USBX デバイス記述子フレームワーク](./media/usbx-host-stack/usbx-device-descriptor-framework.png)
