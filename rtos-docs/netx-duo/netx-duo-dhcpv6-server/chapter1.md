---
title: 第 1 章 - Azure RTOS NetX Duo DHCPv6 サーバーの概要
description: このドキュメントでは、NetX Duo DHCPv6 サーバーが DHCPv6 クライアントに IPv6 アドレスを割り当てるしくみについて詳しく説明します。
author: philmea
ms.author: philmea
ms.date: 06/08/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 6cf7baa91b1804876b97b1d75d1872d1120ad028
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/22/2021
ms.locfileid: "104810859"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-dhcpv6-server"></a><span data-ttu-id="6daf3-103">第 1 章 - Azure RTOS NetX Duo DHCPv6 サーバーの概要</span><span class="sxs-lookup"><span data-stu-id="6daf3-103">Chapter 1 - Introduction to Azure RTOS NetX Duo DHCPv6 server</span></span>

<span data-ttu-id="6daf3-104">IPv6 ネットワークでは、クライアントが IPv6 アドレスを取得するには DHCPv6 が必要です。</span><span class="sxs-lookup"><span data-stu-id="6daf3-104">In IPv6 networks, DHCPv6is required for Clients to obtain IPv6 addresses.</span></span> <span data-ttu-id="6daf3-105">これは、IPv4 アドレスを提供しないという点で、IPv4 に限定される DHCP に代わるものではありません。</span><span class="sxs-lookup"><span data-stu-id="6daf3-105">It does not replace DHCP which is limited to IPv4in that it does not offer IPv4 addresses.</span></span> <span data-ttu-id="6daf3-106">DHCPv6 は、DHCP と同様の機能に加え、多くの拡張機能も備えています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-106">DHCPv6 has similar features to DHCP as well as many enhancements.</span></span> <span data-ttu-id="6daf3-107">IPv6 ステートレス アドレス自動構成を使用しないまたは使用できないクライアントでは、DHCPv6 を使用することで、DHCPv6 サーバーから一意のグローバル IPv6 アドレスの割り当てを受けることができます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-107">A Client who does not or cannot use IPv6 stateless address auto-configuration can use DHCPv6 to be assigned a unique global IPv6 address from a DHCPv6 Server.</span></span>

<span data-ttu-id="6daf3-108">NetX Duo は、IPv6 ネットワーク ベースのアプリケーションと、DHCPv6 などのネットワーク プロトコルをサポートするために開発されました。</span><span class="sxs-lookup"><span data-stu-id="6daf3-108">NetX Duo was developed to support IPv6 network based applications and network protocols such as DHCPv6.</span></span> <span data-ttu-id="6daf3-109">このドキュメントでは、NetX Duo DHCPv6 サーバーが DHCPv6 クライアントに IPv6 アドレスを割り当てるしくみについて詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-109">This document will explain in detail how the NetX Duo DHCPv6 Server assigns IPv6 addresses to DHCPv6 Clients.</span></span>

## <a name="dhcpv6-communication"></a><span data-ttu-id="6daf3-110">DHCPv6 通信</span><span class="sxs-lookup"><span data-stu-id="6daf3-110">DHCPv6 Communication</span></span>

<span data-ttu-id="6daf3-111">**DHCPv6 メッセージの構造**</span><span class="sxs-lookup"><span data-stu-id="6daf3-111">**DHCPv6 Message structure**</span></span>

<span data-ttu-id="6daf3-112">メッセージ ヘッダーの後に 1 つまたは複数 (通常は複数) のオプション ブロックが続いているのが、メッセージの基本的な内容です。</span><span class="sxs-lookup"><span data-stu-id="6daf3-112">Message content is basically a message header followed by one or more (usually more) option blocks.</span></span> <span data-ttu-id="6daf3-113">この基本構造を次に示します。各ブロックは 1 バイトを表しています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-113">Below is the basic structure where each block represents one byte:</span></span>

![DHCPv6 メッセージとオプション ブロックの構造を示す図。](media/image2.jpg)

<span data-ttu-id="6daf3-115">**図 1. DHCPv6 メッセージとオプション ブロックの構造**</span><span class="sxs-lookup"><span data-stu-id="6daf3-115">**Figure 1. DHCPv6 message and option block structure**</span></span>

<span data-ttu-id="6daf3-116">1 バイトの Msg-Type フィールドは、DHCPv6 メッセージの種類を示します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-116">The 1-byte Msg-Type field indicates the type of DHCPv6 message.</span></span> <span data-ttu-id="6daf3-117">3 バイトの Transaction-ID フィールドは、クライアントによって設定されます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-117">The 3-byte Transaction-ID field is set by the Client.</span></span> <span data-ttu-id="6daf3-118">任意の文字シーケンスを使用できますが、サーバーへのクライアント メッセージごとに一意である必要があります (クライアントによって送信される重複するメッセージ間で保持されます)。</span><span class="sxs-lookup"><span data-stu-id="6daf3-118">It can by any sequence of characters but must be unique for each Client message to the Server (conserved across duplicate messages sent by the Client).</span></span> <span data-ttu-id="6daf3-119">サーバーではクライアントへの各応答にその Transaction-ID を使用して、ネットワーク上でパケットの遅延やドロップが発生した場合にクライアントがサーバー メッセージを照合できるようにします。</span><span class="sxs-lookup"><span data-stu-id="6daf3-119">The Server uses that Transaction-ID for each response to the Client to enable the Client to match up Server messages in the event of packets that are delayed or dropped on the network.</span></span> <span data-ttu-id="6daf3-120">Transaction-ID フィールドの後には、クライアントの要求の内容を示すために使用される 1 つ以上の DHCPv6 オプションが続きます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-120">Following the Transaction-ID field, are one or more DHCPv6 options used to indicate what the Client is requesting.</span></span>

<span data-ttu-id="6daf3-121">DHCPv6 オプションの構造は、オプション コード、長さまたはコード フィールドを含まないオプション長フィールド、オプション データ自体 (クライアントが要求しているデータの 1 つ以上の 2 バイトのオプション コード フィールド) で構成されます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-121">The DHCPv6 option structure is composed of an option code, an option length field, which does not include the length or code fields, and finally the option data itself which is one or more 2 byte option code fields for the data the Client is requesting.</span></span>

<span data-ttu-id="6daf3-122">一部のオプション ブロックには入れ子になったオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-122">Some option blocks have nested options.</span></span> <span data-ttu-id="6daf3-123">たとえば、"*非一時アドレス用 ID 関連付け (IANA)* " オプションには、IPv6 アドレスを要求するための "*ID 関連付け (IA)* " オプションが 1 つ以上含まれています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-123">For example, an *Identity Association for Non Temporary Address (IANA)* option contains one or more *Identity Association (IA)* options to request IPv6 addresses.</span></span> <span data-ttu-id="6daf3-124">サーバー応答メッセージで返される *IANA* オプションには、サーバーによって付与された IPv6 アドレスとリース時間を含む同じ *IA* オプションと、クライアント アドレス要求でエラーが発生したかどうかを示す *Status* オプションが含まれています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-124">The *IANA* option returned in the Server Reply message contains the same *IA* option(s) with the IPv6 address and lease times granted by the Server, as well as a *Status* option indicating if there is an error with the Client address request.</span></span>

<span data-ttu-id="6daf3-125">すべてのオプション ブロックとその説明の一覧については、**付録 A** をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="6daf3-125">A list of all option blocks and their description is provided in **Appendix A**.</span></span>

<span data-ttu-id="6daf3-126">**DHCPv6 メッセージの種類**</span><span class="sxs-lookup"><span data-stu-id="6daf3-126">**DHCPv6 Message Types**</span></span>

<span data-ttu-id="6daf3-127">DHCPv6 では、DHCP の機能が大幅に強化されていますが、DHCP と同じ数のメッセージが使用され、DHCP と同じベンダー オプションがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-127">Although DHCPv6 greatly enhances the functionality of DHCP, it uses the same number of messages as DHCP and supports the same vendor options as DHCP.</span></span> <span data-ttu-id="6daf3-128">DHCPv6 メッセージの一覧を次に示します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-128">The list of DHCPv6 messages are as follows:</span></span>

- <span data-ttu-id="6daf3-129">SOLICT (1) (クライアントから送信)</span><span class="sxs-lookup"><span data-stu-id="6daf3-129">SOLICT (1) (sent by Client)</span></span>
- <span data-ttu-id="6daf3-130">ADVERTISE (2) (サーバーから送信)</span><span class="sxs-lookup"><span data-stu-id="6daf3-130">ADVERTISE (2) (sent by Server)</span></span>
- <span data-ttu-id="6daf3-131">REQUEST (3) (クライアントから送信)</span><span class="sxs-lookup"><span data-stu-id="6daf3-131">REQUEST (3) (sent by Client)</span></span>
- <span data-ttu-id="6daf3-132">REPLY (7) (サーバーから送信)</span><span class="sxs-lookup"><span data-stu-id="6daf3-132">REPLY (7) (sent by Server)</span></span>
- <span data-ttu-id="6daf3-133">CONFIRM (4) (クライアントから送信)</span><span class="sxs-lookup"><span data-stu-id="6daf3-133">CONFIRM (4) (sent by Client)</span></span>
- <span data-ttu-id="6daf3-134">RENEW (5) (クライアントから送信)</span><span class="sxs-lookup"><span data-stu-id="6daf3-134">RENEW (5) (sent by Client)</span></span>
- <span data-ttu-id="6daf3-135">REBIND (6) (クライアントから送信)</span><span class="sxs-lookup"><span data-stu-id="6daf3-135">REBIND (6) (sent by Client)</span></span>
- <span data-ttu-id="6daf3-136">RELEASE (8) (クライアントから送信)</span><span class="sxs-lookup"><span data-stu-id="6daf3-136">RELEASE (8) (sent by Client)</span></span>
- <span data-ttu-id="6daf3-137">DECLINE (9) (クライアントから送信)</span><span class="sxs-lookup"><span data-stu-id="6daf3-137">DECLINE (9) (sent by Client)</span></span>
- <span data-ttu-id="6daf3-138">INFORM_REQUEST (11) (クライアントから送信)</span><span class="sxs-lookup"><span data-stu-id="6daf3-138">INFORM_REQUEST (11) (sent by Client)</span></span>
- <span data-ttu-id="6daf3-139">RECONFIGURE\* (10) (サーバーから送信)</span><span class="sxs-lookup"><span data-stu-id="6daf3-139">RECONFIGURE\* (10) (sent by Server)</span></span>

<span data-ttu-id="6daf3-140">\*RECONFIGURE は、NetX Duo DHCPv6 サーバーではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="6daf3-140">\*RECONFIGURE is not supported by the NetX Duo DHCPv6 Server.</span></span>

<span data-ttu-id="6daf3-141">基本的な DHCPv6 要求シーケンスは次のとおりです。かっこ内は同等の DHCPv4 メッセージの種類を示しています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-141">The basic DHCPv6 request sequence, with the equivalent DHCPv4 message type in parenthesis, is as follows:</span></span>

<span data-ttu-id="6daf3-142">クライアント ***Solicit** _ (_Discovery *) サーバー **Advertise** (* Offer *) クライアント **Request** (* Request *) サーバー **Reply** (* DHCPAck*)</span><span class="sxs-lookup"><span data-stu-id="6daf3-142">Client ***Solicit** _ (_Discovery *) Server **Advertisement** (* Offer *) Client **Request** (* Request *) Server **Reply** (* DHCPAck*)</span></span>

<span data-ttu-id="6daf3-143">クライアント **Renew** (同じ) サーバー **Reply** (*DHCPAck*)</span><span class="sxs-lookup"><span data-stu-id="6daf3-143">Client **Renew**(same) Server **Reply** (*DHCPAck*)</span></span>

## <a name="dhcpv6-message-validation"></a><span data-ttu-id="6daf3-144">DHCPv6 メッセージの検証</span><span class="sxs-lookup"><span data-stu-id="6daf3-144">DHCPv6 Message Validation</span></span>

<span data-ttu-id="6daf3-145">トランザクション ID: クライアントは、サーバーに送信するメッセージごとにトランザクション ID を生成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-145">Transaction ID: The Client must generate a transaction ID for each message it sends to the Server.</span></span> <span data-ttu-id="6daf3-146">DHCPv6 サーバーは、このトランザクション ID と一致しないクライアントからのメッセージを拒否します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-146">The DHCPv6 Server will reject any message from the Client not matching this transaction ID.</span></span> <span data-ttu-id="6daf3-147">このサーバーでは次に、クライアントへの応答で同じトランザクション ID を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-147">The Server in turn must use the same transaction ID in its responses back to the Client.</span></span>

<span data-ttu-id="6daf3-148">**DHCPv6 一意識別子 (DUID)**</span><span class="sxs-lookup"><span data-stu-id="6daf3-148">**DHCPv6 unique Identifiers (DUIDs)**</span></span>

<span data-ttu-id="6daf3-149">すべてのサーバー メッセージでは、各メッセージに DHCPv6 一意識別子 (DUID) も含める必要があります。そうしないと、DHCPv6 クライアントはメッセージを受け入れることができません。</span><span class="sxs-lookup"><span data-stu-id="6daf3-149">All Server messages must also include a DHCPv6 unique Identifier (DUID) in each message or the DHCPv6 Client should not accept the message.</span></span> <span data-ttu-id="6daf3-150">Link Layer (LL) DUID は、クライアントの MAC アドレス、ハードウェアの種類、DUID の種類を含む制御ブロックです。</span><span class="sxs-lookup"><span data-stu-id="6daf3-150">A Link Layer (LL) DUID is a control block containing client MAC address, hardware type, and DUID type.</span></span> <span data-ttu-id="6daf3-151">Link Layer Time (LLT) DUID には、ホスト ネットワーク上で DUID が一意でなくなる可能性を低減する時刻フィールドも含まれています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-151">A Link Layer Time (LLT) DUID additionally contains a time field which decreases the chances the DUID will not be unique on the host network.</span></span> <span data-ttu-id="6daf3-152">そのため、RFC 3315 では、LL DUID よりも LLT DUID が推奨されています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-152">For that reason RFC 3315 recommends LLT DUIDs over LL DUIDs.</span></span> <span data-ttu-id="6daf3-153">ホスト アプリケーションによって独自の一意の時刻値が作成されていない場合は、NetX Duo DHCPv6 によって既定値が提供されます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-153">If the host application does not create its own unique time value, NetX Duo DHCPv6 will provide a default one.</span></span> <span data-ttu-id="6daf3-154">DUID の 3 つ目の種類は、エンタープライズ (ベンダー割り当て) DUID です。これには、登録済みのエンタープライズ ID (IANA に登録されているものなど) と、メモリ サイズやオペレーティング システムの種類などのハードウェア構成に基づいて型と長さが変わるプライベート データが含まれています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-154">The third type of DUID is the Enterprise (Vendor assigned) DUID which contains a registered Enterprise ID (as in registered with IANA) and private data that is variable in type and length e.g. based on memory size, operating system type of other hardware configuration.</span></span> <span data-ttu-id="6daf3-155">サーバーのベンダー割り当ておよびプライベート ID 値の設定については、このドキュメントの別の場所にある構成オプションの一覧を参照してください。</span><span class="sxs-lookup"><span data-stu-id="6daf3-155">See the list of Configuration Options elsewhere in this document for setting up the Server vendor assigned and private ID values.</span></span>

<span data-ttu-id="6daf3-156">クライアントも、サーバーへのメッセージ (INFORM_REQUEST を除く) に DUID を含める必要があります。そうしないと、サーバーはそれらを拒否します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-156">The Client must also include its DUID in its messages to the Server except for INFORM_REQUEST, or the Server will reject them.</span></span>

<span data-ttu-id="6daf3-157">**DHCPv6 クライアント サーバー セッション**</span><span class="sxs-lookup"><span data-stu-id="6daf3-157">**DHCPv6 Client Server Sessions**</span></span>

<span data-ttu-id="6daf3-158">DHCPv6 クライアントとサーバーは、UDP を介してメッセージを交換します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-158">DHCPv6 Clients and Servers exchange messages over UDP.</span></span> <span data-ttu-id="6daf3-159">クライアントではポート 546 を使用して DHCPv6 メッセージを送受信し、サーバーではポート 547 を使用します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-159">The Client uses port 546 to send and receive DHCPv6 messages and the Server uses port 547.</span></span> <span data-ttu-id="6daf3-160">クライアントでは、最初にリンクローカル アドレスを使用して DHCPv6 メッセージを送受信します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-160">The Client initially uses its link-local address for transmitting and receiving DHCPv6 messages.</span></span> <span data-ttu-id="6daf3-161">*All_DHCP_Relay_Agents_and_Servers* マルチキャスト アドレス *(FF02::01:02)* と呼ばれるリンクスコープの予約済みマルチキャスト アドレスを使用して、すべてのメッセージが DHCPv6 サーバーに送信されます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-161">It sends all messages to DHCPv6 servers using a reserved, link-scoped multicast address known as the *All_DHCP_Relay_Agents_and_Servers* multicast address *(FF02::01:02)*.</span></span>

<span data-ttu-id="6daf3-162">IPv6 アドレス割り当て要求の場合、DHCPv6 サーバーは、*All_DHCP_Relay_Agents_and_Servers* アドレスに送信された *Solicit* メッセージをリッスンします。</span><span class="sxs-lookup"><span data-stu-id="6daf3-162">ForIPv6 address assignment requests, the DHCPv6 Server listens for *Solicit* messages sent to the *All_DHCP_Relay_Agents_and_Servers* address.</span></span> <span data-ttu-id="6daf3-163">*Solicit* 要求では、クライアントは特定の IPv6 アドレスの割り当てを要求することも、サーバーに選択させることもできます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-163">In the *Solicit* request, the Client can request the assignment of specific IPv6 address or let the Server choose one.</span></span> <span data-ttu-id="6daf3-164">また、サーバーに他のネットワーク構成情報を要求することもできます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-164">It can also request other network configuration information from the Server.</span></span>

<span data-ttu-id="6daf3-165">DHCPv6 サーバーは、有効な *Solicit* メッセージを抽出し、IPv6 アドレスをクライアントに割り当てることができる場合、クライアントに付与する IPv6 アドレス、IPv6 アドレスのリース時間、クライアントから要求された追加情報を含む *Advertise* メッセージで応答します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-165">If the DHCPv6Server extracts a valid *Solicit* message and can assign an IPv6 address to the Client, it responds with an *Advertise* message containing the IPv6 address it will grant to the Client, the IPv6 address lease time and any additional information requested by the Client.</span></span> <span data-ttu-id="6daf3-166">クライアントは、サーバーのオファーを受け入れる場合、IPv6 アドレスを受け入れることをサーバーに通知する *Request* メッセージで応答します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-166">If the Client accepts the Server offer it responds with a *Request* message letting the Server know it will accept the IPv6 address.</span></span> <span data-ttu-id="6daf3-167">サーバーは、クライアントが IPv6 アドレスにバインドされていることを *Reply* メッセージで確認します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-167">The Server confirms the Client is bound to the IPv6 address with a *Reply* message.</span></span>

<span data-ttu-id="6daf3-168">クライアントの DHCPv6 メッセージが無効の場合、サーバーはそのメッセージを警告なしに破棄します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-168">If the Client DHCPv6 message is invalid, the Server will discard the message silently.</span></span> <span data-ttu-id="6daf3-169">サーバーは、要求に応えることができない場合、IP アドレスの IANA オプションの状態フィールドに問題があることを示す *Reply* メッセージを送信します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-169">If the Server is unable to grant the request it will send a *Reply* message with an indication of the problem in the status field of the IP address IANA option.</span></span> <span data-ttu-id="6daf3-170">重複するクライアント要求を受信した場合、サーバーは、クライアントが単にパケットを受信していなかったと想定して、以前の DHCPv6 応答を再送信します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-170">If duplicate Client requests are received the Server resends its previous DHCPv6 response, assuming the Client simply did not receive the packet.</span></span>

<span data-ttu-id="6daf3-171">クライアントでは、重複アドレス検出などのさまざまな IPv6 プロトコルを使用して、サーバーから割り当てられた IPv6 アドレスがシステム上の別のホストに割り当てられていないことを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-171">It is up to the Client to verify that its assigned IPv6 address from the Server is not assigned to another host on the system by using various IPv6 protocols such as Duplicate Address Detection.</span></span> <span data-ttu-id="6daf3-172">アドレスが一意でない場合、クライアントはサーバーに *Decline* メッセージを送信します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-172">If the address is not unique, the Client will send the Server a *Decline* message.</span></span> <span data-ttu-id="6daf3-173">サーバーは、この情報で IP リース テーブルを更新し、そのアドレスが既に割り当てられていることを記録します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-173">The Server updates its IP lease table with this information, recording that the address is already assigned.</span></span> <span data-ttu-id="6daf3-174">その間に、クライアントは別の *Solicit* メッセージで DHCPv6 要求プロセスを再開する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-174">Meanwhile the Client must restart the DHCPv6 request process with another *Solicit* message.</span></span>

<span data-ttu-id="6daf3-175">クライアントは IPv6 アドレスのほかに、DNS サーバーや、場合によってはネットワーク ドメイン名などの他のネットワーク情報を必要とする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-175">In addition to an IPv6 address, a Client will likely also need to know the DNS server and possibly other network information such as the network domain name.</span></span> <span data-ttu-id="6daf3-176">DHCPv6 では、オプション要求を *Solicit* および *Request* メッセージで使用するか、*Information Request* メッセージで個別に使用して、この情報を要求する手段が提供されます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-176">DHCPv6 provides the means to request this information using either the use of Option Requests in the *Solicit* and *Request* messages, or separately in *Information Request* messages.</span></span> <span data-ttu-id="6daf3-177">DHCPv6 オプションについては、この章で後述します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-177">DHCPv6 options are explained later in this chapter.</span></span>

<span data-ttu-id="6daf3-178">**IPv6 のリース期間**</span><span class="sxs-lookup"><span data-stu-id="6daf3-178">**IPv6 Lease Duration**</span></span>

<span data-ttu-id="6daf3-179">サーバーは、IPv6 アドレスをクライアントに付与するときに、IANA オプションでリース期間 (有効期間) も割り当てます。これにより、*Renew* および *Rebind* メッセージを使用してクライアントが IPv6 アドレスの更新 (T1) または再バインド (T2) を開始することが推奨される時間が示されます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-179">When the Server grants an IPv6 address to a Client, it also assigns the lease duration (lifetime)in the IANA option for when it recommends the Client to start renewing (T1) or rebinding (T2) its IPv6 address using *Renew* and *Rebind* messages.</span></span> <span data-ttu-id="6daf3-180">この 2 つの違いは、クライアントが *Renew* メッセージをサーバーに送信するために *Renew* 要求にサーバー DUID を含めるという点にあります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-180">The difference between the two is the Client directs the *Renew* message to the Server by including the Server DUID in the *Renew* request.</span></span> <span data-ttu-id="6daf3-181">一方、*All_DHCP_Relay_Agents_and_Servers* アドレスへの *Rebind* メッセージではサーバーを指定しないため、そこにサーバー DUID を含めません。</span><span class="sxs-lookup"><span data-stu-id="6daf3-181">However, it does not specify any server, and hence does not include a Server DUID, in the *Rebind* message to the *All_DHCP_Relay_Agents_and_Servers* address.</span></span> <span data-ttu-id="6daf3-182">サーバーがクライアントに付与する実際の IPv6 アドレスを含む IA オプションには、リースされた IPv6 アドレスが非推奨になるまでの優先有効期間と古くなる (無効になる) までの有効な有効期間も含まれます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-182">The IA option which contains the actual IPv6 address the Server grants the Client also contains the preferred and valid lifetimes when the leased IPv6 address becomes deprecated or obsolete (invalid), respectively.</span></span>

<span data-ttu-id="6daf3-183">NetX Duo DHCPv6 サーバーでは、クライアント メッセージ間の時間を追跡するために、クライアントごとにセッション タイムアウトが維持されます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-183">The NetX Duo DHCPv6 Server maintains a session timeout for each Client to track the time between Client messages.</span></span> <span data-ttu-id="6daf3-184">これは、クライアント ホストが接続を失った場合や、ネットワークがダウンした場合に必要となります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-184">This is necessary in the event of a Client host losing connectivity or the network doing down.</span></span> <span data-ttu-id="6daf3-185">セッションがタイムアウトになると、クライアントがサーバーに対して DHCPv6 要求を行う必要がなくなったか、要求を実行できなくなったと想定されます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-185">When the session timeout expires, it is assumed the Client is either no longer interested or able to make DHCPv6 requests of the Server.</span></span> <span data-ttu-id="6daf3-186">サーバーはクライアント レコードを削除し、暫定的に割り当てられた IPv6 アドレスを使用可能なプールに戻します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-186">The Server deletes the Client record and returns any tentatively assigned IPv6 address back to the available pool.</span></span> <span data-ttu-id="6daf3-187">セッション タイムアウトの待機はユーザーが構成可能なオプションです。</span><span class="sxs-lookup"><span data-stu-id="6daf3-187">The session timeout wait is a user configurable option.</span></span>

<span data-ttu-id="6daf3-188">クライアントは、IPv6 アドレスを解放する必要がある場合、または DHCPv6 サーバーによって割り当てられた IPv6 アドレスが既に使用されていることを検出した場合に、*Release* または *Decline* メッセージをそれぞれ送信します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-188">If the Client wishes to release its IPv6 address, or discovers that the IPv6 address assigned to it by the DHCPv6 Server is already in use, it send a *Release* or *Decline* message respectively.</span></span> <span data-ttu-id="6daf3-189">*Release* メッセージの場合、サーバーはその IPv6 アドレスの状態を使用可能なプールに戻します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-189">In the case of a *Release* message, the Server returns that IPv6 address status back to the available pool.</span></span> <span data-ttu-id="6daf3-190">*Decline* メッセージの場合、IP リース テーブルを更新して、この IPv6 アドレスが使用できないこと (ネットワーク上の別のエンティティが所有していること) を示します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-190">In the case of the *Decline* message, it updates its IP lease table to indicate this IPv6 address is not available (owned by another entity elsewhere on the network).</span></span>

<span data-ttu-id="6daf3-191">**IPv6 リースとクライアント レコードのデータ**</span><span class="sxs-lookup"><span data-stu-id="6daf3-191">**IPv6 Lease and Client Record Data**</span></span>

<span data-ttu-id="6daf3-192">DHCPv6 サーバーは、クライアント要求の受け入れを開始すると、IPv6 アドレスを要求しているか、既に割り当てられているアクティブなクライアントのリストを保持します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-192">When the DHCPv6 Server starts accepting Client requests it maintains a list of active Clients who are requesting or have been assigned IPv6 addresses.</span></span> <span data-ttu-id="6daf3-193">サーバーでは、クライアントのリース期間を定期的に更新するリース タイマーを使用して、IP リースの有効期限を確認します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-193">The Server checks for IP lease expiration by means of a lease timer that periodically updates the Client lease duration.</span></span> <span data-ttu-id="6daf3-194">期間が有効な有効期間を超えると、サーバーはクライアント レコードをクリアし、IPv6 アドレスを使用可能なプールに戻します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-194">When the duration exceeds the valid lifetime, the Server clears the Client record and returns its IPv6 address back to the available pool.</span></span> <span data-ttu-id="6daf3-195">これが行われる前に、更新または再バインド プロセスを開始することはクライアントに委ねられています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-195">It is up to the Client to start the renewal/rebinding process before this happens!</span></span>

<span data-ttu-id="6daf3-196">NetX Duo DHCPv6 サーバーのクライアント レコード テーブルには、クライアントを識別するための情報と、DHCPv6 クライアント要求を検証し、IPv6 アドレスの割り当てまたは再割り当てを行うための "状態" 情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-196">The NetX Duo DHCPv6 Server client record table contains information to identify Clients, and ‘state’ information for validating DHCPv6 Client requests and assigning or re-assigning IPv6 addresses.</span></span> <span data-ttu-id="6daf3-197">これらの情報は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="6daf3-197">Such information includes:</span></span>

- <span data-ttu-id="6daf3-198">ネットワーク上の各クライアント ホストを一意に定義する、クライアントの DHCPv6 一意識別子 (DUID)。</span><span class="sxs-lookup"><span data-stu-id="6daf3-198">The Client DHCPv6 Unique Identifier (DUID) which uniquely defines each Client host on a network.</span></span> <span data-ttu-id="6daf3-199">クライアントでは、すべての DHCPv6 メッセージにこの同じ DUID を常に使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-199">The Client must always use this same DUID for all its DHCPv6 messages.</span></span>

- <span data-ttu-id="6daf3-200">クライアントの IPv6 アドレス割り当てパラメーターを定義する、非一時アドレス用 ID 関連付け (IANA) と累積的な ID 関連付け IPv6 アドレス (IA)。</span><span class="sxs-lookup"><span data-stu-id="6daf3-200">The Client Identity Association for Non Temporary Addresses (IANA) and Identity Association IPv6 address (IA) cumulatively which define the Client IPv6 address assignment parameters.</span></span>

- <span data-ttu-id="6daf3-201">クライアントのオプション要求 (DNS サーバー、ドメイン名など)。</span><span class="sxs-lookup"><span data-stu-id="6daf3-201">Client option requests (DNS server, domain name, etc).</span></span>

- <span data-ttu-id="6daf3-202">クライアントの最新の DHCPv6 要求の IPv6 送信元アドレス (設定されている場合) と宛先アドレス (マルチキャストでない場合)。</span><span class="sxs-lookup"><span data-stu-id="6daf3-202">The Client IPv6 source address (if set) and destination address (if not multicast) of its most recent DHCPv6 request.</span></span>

- <span data-ttu-id="6daf3-203">クライアントの最新のメッセージの種類と DHCPv6 の "状態"。</span><span class="sxs-lookup"><span data-stu-id="6daf3-203">The Client’s most recent message type and DHCPv6 ‘state’.</span></span>

## <a name="netx-duo-dhcpv6-server-requirements-and-constraints"></a><span data-ttu-id="6daf3-204">NetX Duo DHCPv6 サーバーの要件と制約</span><span class="sxs-lookup"><span data-stu-id="6daf3-204">NetX Duo DHCPv6 Server Requirements and Constraints</span></span>

<span data-ttu-id="6daf3-205">NetX Duo DHCPv6 サーバー API には、ThreadX 5.1 以降と NetX Duo 5.5 以降が必要です。</span><span class="sxs-lookup"><span data-stu-id="6daf3-205">The NetX Duo DHCPv6 Server API requires ThreadX 5.1 or later, and NetX Duo 5.5 or later.</span></span>

<span data-ttu-id="6daf3-206">**必要条件**</span><span class="sxs-lookup"><span data-stu-id="6daf3-206">**Requirements**</span></span>

<span data-ttu-id="6daf3-207">***IP スレッド タスクの設定***</span><span class="sxs-lookup"><span data-stu-id="6daf3-207">***IP Thread Task Setup***</span></span>

<span data-ttu-id="6daf3-208">NetX Duo DHCPv6 サーバーでは、ネットワーク リンクで DHCPv6 へのメッセージを送受信するための IP インスタンスを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-208">The NetX Duo DHCPv6 Server requires a creation of an IP instance for sending and receiving messages to DHCPv6 on its network link.</span></span> <span data-ttu-id="6daf3-209">これを行うには、*nx_ip_create* サービスを使用します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-209">This is done using the *nx_ip_create* service.</span></span> <span data-ttu-id="6daf3-210">NetX Duo DHCPv6 サーバー自体を作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-210">The NetX Duo DHCPv6 Server itself must be created.</span></span> <span data-ttu-id="6daf3-211">これを行うには、*nx_dhcpv6_server_create* サービスを使用します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-211">This is done using the *nx_dhcpv6_server_create* service.</span></span>

<span data-ttu-id="6daf3-212">DHCPv6 では、NetX Duo、ICMPv6、UDP を使用します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-212">DHCPv6 utilizes NetX Duo, ICMPv6 and UDP.</span></span> <span data-ttu-id="6daf3-213">そのため、DHCPv6 サーバーを使用する前に、次の NetX Duo サービスを呼び出して、まず IPv6 を有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-213">Therefore IPv6 must first be enabled prior to using DHCPv6 Server by calling the following NetX Duo services:</span></span>

- <span data-ttu-id="6daf3-214">*nx_udp_enable*</span><span class="sxs-lookup"><span data-stu-id="6daf3-214">*nx_udp_enable*</span></span>
- <span data-ttu-id="6daf3-215">*nxd_ipv6_enable*</span><span class="sxs-lookup"><span data-stu-id="6daf3-215">*nxd_ipv6_enable*</span></span>
- <span data-ttu-id="6daf3-216">*nxd_icmp_enable*</span><span class="sxs-lookup"><span data-stu-id="6daf3-216">*nxd_icmp_enable*</span></span>

<span data-ttu-id="6daf3-217">さらに、DHCPv6 サーバーを起動する前に、いくつかの設定タスクを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-217">Further, before the DHCPv6 Server can be started, it has a number of set up tasks to perform:</span></span>

- <span data-ttu-id="6daf3-218">リンク ローカル アドレスと IPv6 グローバル アドレスを作成して検証します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-218">Create and validate its link local and IPv6 global addresses.</span></span> <span data-ttu-id="6daf3-219">アドレスの検証は、重複アドレス検出 (有効になっている場合) を使用して、NetX Duo によって自動的に実行されます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-219">Address validation is performed automatically by NetX Duo using Duplicate Address Detection if it is enabled.</span></span> <span data-ttu-id="6daf3-220">リンク ローカル アドレスとグローバル IP アドレスの検証の詳細については、"*NetX Duo ユーザー マニュアル*" をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="6daf3-220">See the *NetX Duo User Manual* for details on link local and global IP address validation.</span></span>

- <span data-ttu-id="6daf3-221">DHCPv6 インターフェイスのネットワーク インターフェイス インデックスを設定します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-221">Set the network interface index for its DHCPv6 interface.</span></span>

- <span data-ttu-id="6daf3-222">割り当て可能な IPv6 アドレスの IP アドレス範囲を作成します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-222">Create an IP address range for assignable IPv6 addresses.</span></span> <span data-ttu-id="6daf3-223">または、前のサーバー DHCPv6 セッションのデータが存在する場合は、そのセッションの IPv6 リース テーブルとクライアント レコードを、不揮発性メモリから DHCPv6 サーバーにアップロードする必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-223">Or, if data exists from a previous Server DHCPv6 session, IPv6 lease table and client records from that session must be uploaded from non volatile memory to the DHCPv6 Server.</span></span> <span data-ttu-id="6daf3-224">このドキュメントの別の場所にある簡単なシステムの例で、この要件を実現するための DHCPv6 サーバー サービスが示されています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-224">The small example system elsewhere in this document will demonstrate the DHCPv6 Server services for accomplishing this requirement.</span></span>

- <span data-ttu-id="6daf3-225">サーバー DUID を設定します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-225">Set the Server DUID.</span></span> <span data-ttu-id="6daf3-226">前のセッションでサーバーによって DUID が作成された場合、同じデータを使用して、クライアントへのメッセージ用に同じ DUID が作成される必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-226">If the Server has created its DUID in a previous session it must use the same data to create the same DUID for messages to its Clients.</span></span> <span data-ttu-id="6daf3-227">このドキュメントの別の場所にある簡単なシステムの例で、この要件を実現する方法が示されています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-227">The small example system elsewhere in this document will demonstrate how this requirement is accomplished.</span></span>

<span data-ttu-id="6daf3-228">この時点で、DHCPv6 サーバーを実行する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="6daf3-228">At this point the DHCPv6 Server is ready to run.</span></span> <span data-ttu-id="6daf3-229">内部的には、NetX Duo DHCPv6 サーバーは、ポート 547 にバインドされた UDP ソケットを作成し、クライアント要求のリッスンを開始します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-229">Internally the NetX Duo DHCPv6 Server will create a UDP socket bound to port 547, and starts listening for Client requests.</span></span>

<span data-ttu-id="6daf3-230">***パケット プールの要件***</span><span class="sxs-lookup"><span data-stu-id="6daf3-230">***Packet Pool Requirements***</span></span>

<span data-ttu-id="6daf3-231">NetX Duo DHCPv6 サーバーには、DHCPv6 メッセージを送信するためのパケット プールが必要です。</span><span class="sxs-lookup"><span data-stu-id="6daf3-231">NetX Duo DHCPv6 Server requires a packet pool for sending DHCPv6 messages.</span></span> <span data-ttu-id="6daf3-232">パケット プールのサイズは、パケット ペイロードと使用可能なパケットの数に関してユーザーが構成可能であり、DHCPv6 メッセージとホスト アプリケーションによる他の送信の予想される量によって異なります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-232">The size of the packet pool in terms of packet payload and number of packets available is user configurable, and depends on the anticipated volume of DHCPv6 messages and other transmissions the host application will be sending.</span></span>

<span data-ttu-id="6daf3-233">クライアントから要求された追加オプションの数とサーバーから入手可能な情報に応じて、一般的な DHCPv6 メッセージは約 200 から 300 バイトになります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-233">A typical DHCPv6 message is about 200-300 bytes depending on the number of additional options requested by the Client, and information available from the Server.</span></span>

<span data-ttu-id="6daf3-234">***DHCPv6 サーバー インターフェイスの設定***</span><span class="sxs-lookup"><span data-stu-id="6daf3-234">***Setting the DHCPv6 Server interface***</span></span>

<span data-ttu-id="6daf3-235">DHCPv6 サーバーでは、クライアント要求を受け入れるインターフェイスとして、プライマリ ネットワーク インターフェイスが既定で使用されます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-235">The DHCPv6 Server defaults to the primary network interface as the interface it will accept Client requests on.</span></span> <span data-ttu-id="6daf3-236">ただし、ホスト アプリケーションでは、サーバーのグローバル アドレスの作成に使用されたグローバル アドレス インデックスを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-236">However, the host application must still set the global address index which it used to create the Server global address.</span></span> <span data-ttu-id="6daf3-237">DHCPv6 インターフェイス インデックスとグローバル アドレス インデックスは、*nx_dhcpv6_server_interface_set* サービスを使用して設定されます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-237">The DHCPv6 interface index and global address index are set using the *nx_dhcpv6_server_interface_set* service.</span></span> <span data-ttu-id="6daf3-238">これも、このドキュメントの "簡単な例" に示されています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-238">This is also demonstrated in the “small example” in this document.</span></span>

<span data-ttu-id="6daf3-239">***サーバーの再起動時に使用する DHCPv6 DUID の保存***</span><span class="sxs-lookup"><span data-stu-id="6daf3-239">***Saving DHCPv6 DUID across Server Reboots***</span></span>

<span data-ttu-id="6daf3-240">DHCPv6 プロトコルでは、サーバーで再起動するたびに同じ DUID を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-240">The DHCPv6 protocol requires the Server to use the same DUID across multiple reboots.</span></span> <span data-ttu-id="6daf3-241">この要件に対応するために、DUID の作成に使用するデータを不揮発性メモリに保存し、そこから取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-241">Any data used to create the DUID must therefore be stored and retrieved from nonvolatile memory for this requirement.</span></span> <span data-ttu-id="6daf3-242">リンク層 + 時刻 DUID を使用するホストの場合、リアルタイム クロックにアクセスする必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-242">For hosts that use the Link Layer Plus Time DUID which requires access to a real time clock.</span></span> <span data-ttu-id="6daf3-243">NetX Duo DHCPv6 ホスト アプリケーションでは、最初のサーバー DUID の作成時に時刻値を生成するためのリアルタイム データ アクセスを含め、後続のサーバー セッションで再利用できるようにそのデータを保存する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-243">The NetX Duo DHCPv6 host application should include real time data access for generating a time value for the initial Server DUID creation, and store that data for reuse on subsequent Server sessions.</span></span> <span data-ttu-id="6daf3-244">その後、*nx_dhcpv6_set_server_duid* で DUID データを引数として受け取り、DUID の種類に応じた構成オプションを取得して、独自の DUID を生成 (または再生成) します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-244">The *nx_dhcpv6_set_server_duid* then takes DUID data as its arguments, as well as configuration options depending on DUID type, to produce (or reproduce) its own DUID.</span></span>

<span data-ttu-id="6daf3-245">***割り当て可能な IPv6 アドレス リストの作成***</span><span class="sxs-lookup"><span data-stu-id="6daf3-245">***Assignable IPv6 Address List Creation***</span></span>

<span data-ttu-id="6daf3-246">DHCPv6 サーバーの作成後、以前に保存された IP アドレス リスト データがない場合は、サーバー ホスト アプリケーションで、割り当て可能な IPv6 グローバル アドレスの範囲を作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-246">After creation of the DHCPv6 Server, the Server host application must create a range of assignable IPv6 global addresses if there is no previously stored IP address list data.</span></span> <span data-ttu-id="6daf3-247">これを行うには、開始および終了 IPv6 アドレスを入力として受け取る *nx_dhcpv6_create_ip_address_range* サービスを使用します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-247">This is done using the *nx_dhcpv6_create_ip_address_range* service which takes as input a starting and ending IPv6 address.</span></span>

<span data-ttu-id="6daf3-248">***DHCPv6 の割り当て可能なアドレスとクライアントのデータの保存***</span><span class="sxs-lookup"><span data-stu-id="6daf3-248">***Saving DHCPv6 Assignable Address and Client data***</span></span>

<span data-ttu-id="6daf3-249">DHCPv6 プロトコルでは、DHCPv6 サーバーは、サーバーを再起動する場合に備えて、クライアントと IPv6 アドレスのデータを不揮発性ストレージに保存することを求められます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-249">The DHCPv6 protocol requires that the DHCPv6 Server save its Client and IPv6 address data in nonvolatile storage in the event of rebooting the server.</span></span> <span data-ttu-id="6daf3-250">NetX Duo DHCPv6 サーバーには、DHCPv6 サーバーとの間でクライアントと IPv6 アドレスのデータをアップロードおよびダウンロードするための API がいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-250">The NetX Duo DHCPv6 Server has several API for uploading and downloading Client and IPv6 address data to and from the DHCPv6 Server, respectively:</span></span>

<span data-ttu-id="6daf3-251">*nx_dhcpv6_add_client_record*</span><span class="sxs-lookup"><span data-stu-id="6daf3-251">*nx_dhcpv6_add_client_record*</span></span>

<span data-ttu-id="6daf3-252">*nx_dhcpv6_add_ip_address_lease*</span><span class="sxs-lookup"><span data-stu-id="6daf3-252">*nx_dhcpv6_add_ip_address_lease*</span></span>

<span data-ttu-id="6daf3-253">*nx_dhcpv6_retrieve_client_record*</span><span class="sxs-lookup"><span data-stu-id="6daf3-253">*nx_dhcpv6_retrieve_client_record*</span></span>

<span data-ttu-id="6daf3-254">*nx_dhcpv6_retrieve_ip_address_lease*</span><span class="sxs-lookup"><span data-stu-id="6daf3-254">*nx_dhcpv6_retrieve_ip_address_lease*</span></span>

<span data-ttu-id="6daf3-255">サーバーへのデータのアップロードは、サーバーを再起動する前に実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-255">Uploading data to the Server must be done before restarting the Server.</span></span> <span data-ttu-id="6daf3-256">データのダウンロードは、DHCPv6 サーバーを停止 (または一時停止) した後にのみ実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-256">Downloading the data should be done only after the DHCPv6 Server is stopped (or suspended).</span></span> <span data-ttu-id="6daf3-257">これを行うためのサービスについては、このドキュメントで後ほど詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-257">The services for doing so are described in detail later in this document.</span></span> <span data-ttu-id="6daf3-258">ただし、NetX Duo DHCPv6 では、不揮発性ストレージへのアクセスは定義できません。</span><span class="sxs-lookup"><span data-stu-id="6daf3-258">However, the NetX Duo DHCPv6 provides does not define an access to nonvolatile storage.</span></span> <span data-ttu-id="6daf3-259">これは、ホスト アプリケーションで処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-259">This must be handled by the host application.</span></span> <span data-ttu-id="6daf3-260">簡単な例に、ホスト アプリケーションでこれを行う方法が示されています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-260">The small example demonstrates how the host application does this.</span></span>

<span data-ttu-id="6daf3-261">***サーバーの DHCP 一意識別子 (DUID)***</span><span class="sxs-lookup"><span data-stu-id="6daf3-261">***Server DHCP Unique Identifier (DUID)***</span></span>

<span data-ttu-id="6daf3-262">サーバー DUID により、ネットワーク上の DHCPv6 サーバー ホストが一意に定義されます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-262">The Server DUID uniquely defines the DHCPv6 Server host on the network.</span></span> <span data-ttu-id="6daf3-263">サーバーで DUID をまだ作成していない場合は、*nx_dhcpv6_server_set_duid* を使用して作成できます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-263">If a Server has not previously created its DUID, it can use the *nx_dhcpv6_server_set_duid* to create one.</span></span> <span data-ttu-id="6daf3-264">RFC 3315 に従い、DHCPv6 サーバーは、サーバーの再起動後に取得できるように、この DUID を不揮発性メモリに保存する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-264">As per RFC 3315, the DHCPv6 Server must save this DUID to nonvolatile memory to be able to retrieve it after Server reboots.</span></span> <span data-ttu-id="6daf3-265">DHCPv6 サーバーでは、DUID の種類として、Link Layer、Link Layer Time、エンタープライズ (ベンダー割り当て) がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-265">The DHCPv6 Server supports the Link Layer, Link Layer Time and Enterprise (Vendor assigned) DUID types.</span></span> <span data-ttu-id="6daf3-266">ベンダー タイプの DUID は、クライアントが直接送信する必要があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="6daf3-266">Note that the Client must send in the Vendor type DUID directly.</span></span> <span data-ttu-id="6daf3-267">NetX Duo DHPv6 サーバーでは、ベンダー タイプの DUID (17) のオプションは直接サポートされていません。</span><span class="sxs-lookup"><span data-stu-id="6daf3-267">The option for Vendor type DUIDs (17) is not directly supported by the NetX Duo DHPv6 Server.</span></span>

<span data-ttu-id="6daf3-268">DHCPv6 サーバー ホスト アプリケーションには、リース タイムアウトを含む IPv6 アドレス割り当ての既定値があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-268">The DHCPv6 Server host application has default values for IPv6 address assignment including lease timeout.</span></span> <span data-ttu-id="6daf3-269">これらのオプションを設定する方法については、このドキュメントで後述する構成可能なオプションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="6daf3-269">See Configurable Options later in this document for how to set these options.</span></span> <span data-ttu-id="6daf3-270">:</span><span class="sxs-lookup"><span data-stu-id="6daf3-270">:</span></span>

<span data-ttu-id="6daf3-271">*IANA* 制御ブロックには、T1 フィールドと T2 フィールドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-271">The *IANA* control block contains the T1 and T2 fields.</span></span> <span data-ttu-id="6daf3-272">*IANA* 制御ブロック内の *IA* ブロックには、優先有効期間フィールドと有効な有効期間フィールドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-272">The *IA* block in the *IANA* control block contains the preferred and valid lifetime fields.</span></span> <span data-ttu-id="6daf3-273">これらのオプションを設定するために、ホスト アプリケーションには、このドキュメントの別の場所で定義されている構成可能なオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-273">The host application has configurable options defined elsewhere in this document for setting these options.</span></span> <span data-ttu-id="6daf3-274">これらは、すべてのクライアント IPv6 アドレス要求に割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-274">They are assigned to all Client IPv6 address requests.</span></span>

<span data-ttu-id="6daf3-275">これらの DHCPv6 IP リース パラメーターは次のように定義されています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-275">These DHCPv6 IP lease parameters are defined below.</span></span>

<span data-ttu-id="6daf3-276">T1 - IPv6 アドレスを割り当てたサーバーから、クライアントがアドレスの更新を開始する必要がある時間 (秒単位)。</span><span class="sxs-lookup"><span data-stu-id="6daf3-276">T1 – time in seconds when the Client must start renewing its IPv6 address from the Server that assigned it.</span></span>

<span data-ttu-id="6daf3-277">T2 - 更新に失敗した場合に、クライアントがリンク上の任意のサーバーで IPv6 アドレスの再バインドを開始する必要がある時間 (秒単位)。</span><span class="sxs-lookup"><span data-stu-id="6daf3-277">T2 – time in seconds when the Client must start rebinding the IPv6 address, if renewal failed, with any Server on its link.</span></span>

<span data-ttu-id="6daf3-278">優先有効期間 - クライアントがアドレスを更新または再バインドしていない場合に、クライアント アドレスが非推奨になるまでの時間 (秒単位)。</span><span class="sxs-lookup"><span data-stu-id="6daf3-278">Preferred lifetime – time in seconds when the Client address becomes deprecated if the Client has not renewed or rebound it.</span></span> <span data-ttu-id="6daf3-279">クライアントは引き続きこのアドレスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-279">The Client can still use this address.</span></span>

<span data-ttu-id="6daf3-280">有効な有効期間 - クライアント IP アドレスの有効期限が切れ、ネットワーク送信でこのアドレスを使用できなくなるまでの時間 (秒)。</span><span class="sxs-lookup"><span data-stu-id="6daf3-280">Valid lifetime – time in seconds when the Client IP address is expired and MUST not use this address in its network transmissions.</span></span>

<span data-ttu-id="6daf3-281">RFC では、クライアントの *IANA* オプションの優先有効期間の T1 および T2 時間として、それぞれ 0.5 と 0.8 が推奨されています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-281">The RFC recommends T1 and T2 times that are 0.5 and 0.8, respectively, of the preferred lifetime in the Client *IANA* option.</span></span> <span data-ttu-id="6daf3-282">サーバーは、優先設定がない場合に、これらの時間を 0 に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-282">If the Server has no preference, it should set these times to zero.</span></span> <span data-ttu-id="6daf3-283">0 に設定された T1 および T2 時間がサーバー応答に含まれている場合は、クライアントが独自の T1 および T2 時間を設定できます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-283">If a Server reply contains T1 and T2 times set to zero, it is letting the Client set its own T1 and T2 times.</span></span>

<span data-ttu-id="6daf3-284">**制約**</span><span class="sxs-lookup"><span data-stu-id="6daf3-284">**Constraints**</span></span>

<span data-ttu-id="6daf3-285">NetX Duo DHCPv6 サーバーでは、次の DHCPv6 オプションはサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="6daf3-285">NetX Duo DHCPv6 Server does not support the following DHCPv6 options:</span></span>

  - <span data-ttu-id="6daf3-286">DHCPv6 アドレス要求プロセスを最適化して、Solicit と Reply のメッセージ交換だけを行う Rapid Commit オプション。</span><span class="sxs-lookup"><span data-stu-id="6daf3-286">Rapid Commit option which optimizes the DHCPv6 address request process to just the Solicit and Reply message exchange</span></span>

  - <span data-ttu-id="6daf3-287">サーバーがクライアントの IP アドレスの状態の変更を開始できるようにする Reconfigure オプション。</span><span class="sxs-lookup"><span data-stu-id="6daf3-287">Reconfigure option which allows the Server can initiate changes to the Client’s IP address status.</span></span>

  - <span data-ttu-id="6daf3-288">Unicast オプション。すべてのクライアント メッセージは、DHCPv6 サーバーに直接送信するのではなく、*All_DHCP_Relay_Agents_and_Servers* マルチキャスト アドレスに送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-288">Unicast option; all Client messages must be sent to the *All_DHCP_Relay_Agents_and_Servers* multicast address rather than to the DHCPv6 Server directly.</span></span>

  - <span data-ttu-id="6daf3-289">クライアントに付与される一時 IP アドレスである、一時アドレス用 ID 関連付け (IA_TA) オプション。</span><span class="sxs-lookup"><span data-stu-id="6daf3-289">Identity Association for the Temporary Addresses(IA_TA)option which is a temporary IP address granted to a Client.</span></span>

  - <span data-ttu-id="6daf3-290">クライアント要求ごとに複数の IA (IPv6 アドレス) オプション。</span><span class="sxs-lookup"><span data-stu-id="6daf3-290">Multiple IA (IPv6 addresses) options per Client Request</span></span>

  - <span data-ttu-id="6daf3-291">DHCPv6 クライアントとサーバー間のリレー ホスト。たとえば、クライアントとサーバーは同じネットワーク上に存在する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-291">Relay host between DHCPv6 Client and Server e.g. Client and Server must be on the same network.</span></span>

  - <span data-ttu-id="6daf3-292">DHCPv6 メッセージングでの IPSec と認証はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="6daf3-292">IPSec and Authentication are not supported in DHCPv6 messaging.</span></span> <span data-ttu-id="6daf3-293">ただし、使用している NetX Duo のバージョンによっては、IP インスタンスで IPSec が有効になっている場合があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-293">However, the IP instance may be IPSec enabled depending on the version of NetX Duo in use.</span></span>

  - <span data-ttu-id="6daf3-294">NetX Duo DHCPv6 サーバーで直接サポートされるのは、DNS サーバー オプション要求だけです。</span><span class="sxs-lookup"><span data-stu-id="6daf3-294">The NetX Duo DHCPv6 Server directly supports only the DNS server option request.</span></span> <span data-ttu-id="6daf3-295">これは、将来のリリースで変更される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="6daf3-295">This may change in future releases.</span></span>

  - <span data-ttu-id="6daf3-296">プレフィックス委任オプションはサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="6daf3-296">The Prefix Delegation option is not supported.</span></span>

  - <span data-ttu-id="6daf3-297">DHCPv6 メッセージの認証。ただし、基になる NetX Duo 環境で IPSec を有効にすることは可能です。</span><span class="sxs-lookup"><span data-stu-id="6daf3-297">Authentication of DHCPv6 messages although IPSec can be enabled in the underlying NetX Duo environment.</span></span> <span data-ttu-id="6daf3-298">NetX Duo DHCPv6 サーバーでは、クライアントへのリレー接続もサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="6daf3-298">Neither does the NetX Duo DHCPv6 Server support relay connections to the Clients.</span></span> <span data-ttu-id="6daf3-299">すべてのクライアント要求は、サーバー ネットワーク上のホストからのものと見なされます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-299">It is assumed all Client requests originate from hosts on the Server network.</span></span>

## <a name="netx-duo-dhcpv6-server-callback-functions"></a><span data-ttu-id="6daf3-300">NetX Duo DHCPv6 サーバーのコールバック関数</span><span class="sxs-lookup"><span data-stu-id="6daf3-300">NetX Duo DHCPv6 Server Callback Functions</span></span>

<span data-ttu-id="6daf3-301">*nx_dhcpv6_IP_address_declined_handler*</span><span class="sxs-lookup"><span data-stu-id="6daf3-301">*nx_dhcpv6_IP_address_declined_handler*</span></span>

<span data-ttu-id="6daf3-302">DHCPv6 クライアントが Decline メッセージを送信すると、NetX Duo DHCPv6 サーバーは、IPv6 アドレス テーブルでそのアドレスを使用不可としてマークします。</span><span class="sxs-lookup"><span data-stu-id="6daf3-302">When the DHCPv6 Client sends a Decline message, the NetX Duo DHCPv6 Server marks the address as not available in its IPv6 address tables.</span></span> <span data-ttu-id="6daf3-303">このメッセージのサーバー処理をカスタマイズできるようにするために、*nx_dhcpv6_IP_address_declined_handler* が用意されています *。*</span><span class="sxs-lookup"><span data-stu-id="6daf3-303">To have the ability to customize the Server handling of this message, the *nx_dhcpv6_IP_address_declined_handler* is provided *.*</span></span> <span data-ttu-id="6daf3-304">ただし、このコールバックは現在実装されていません。</span><span class="sxs-lookup"><span data-stu-id="6daf3-304">However, this callback is not currently implemented.</span></span>

<span data-ttu-id="6daf3-305">*nx_dhcpv6_server_option_request_handler*</span><span class="sxs-lookup"><span data-stu-id="6daf3-305">*nx_dhcpv6_server_option_request_handler*</span></span>

<span data-ttu-id="6daf3-306">DHCPv6 クライアント メッセージにオプション要求データが含まれている場合、NetX Duo DHCPv6 サーバーは、各オプション要求のオプション コードをこのユーザー コールバック (定義されている場合) に転送します。</span><span class="sxs-lookup"><span data-stu-id="6daf3-306">When the DHCPv6 Client message contains option request data, the NetX Duo DHCPv6 Server forwards each option request option code to this user callback, if defined.</span></span> <span data-ttu-id="6daf3-307">これにより、NetX Duo サーバーは、ユーザー定義のコールバックにデータを入力させることができます。</span><span class="sxs-lookup"><span data-stu-id="6daf3-307">This gives the NetX Duo Server the capability to let the user defined callback fill in the data.</span></span> <span data-ttu-id="6daf3-308">ただし、この機能は現在実装されていません。</span><span class="sxs-lookup"><span data-stu-id="6daf3-308">However this functionality is not currently implemented.</span></span>

## <a name="supported-dhcpv6-rfcs"></a><span data-ttu-id="6daf3-309">サポートされている DHCPv6 RFC</span><span class="sxs-lookup"><span data-stu-id="6daf3-309">Supported DHCPv6 RFCs</span></span>

<span data-ttu-id="6daf3-310">NetX Duo DHCPv6 は、RFC3315、RFC3646、および関連する RFC に準拠しています。</span><span class="sxs-lookup"><span data-stu-id="6daf3-310">NetX Duo DHCPv6 is compliant with RFC3315, RFC3646, and related RFCs.</span></span>