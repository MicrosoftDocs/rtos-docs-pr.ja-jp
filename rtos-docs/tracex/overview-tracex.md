---
title: Azure RTOS TraceX を理解する
description: Azure RTOS TraceX は、開発者がリアルタイム システムのイベントをグラフィカルに表示し、リアルタイム システムの動作への理解を深めることができる、Microsoft のホストベース分析ツールです。
author: philmea
ms.author: philmea
ms.date: 5/19/2020
ms.service: rtos
ms.topic: overview
ms.openlocfilehash: 966f3be5ebe34e006067175e422480fbf1ab664bb0ff627d7b01e71036dc5e82
ms.sourcegitcommit: 93d716cf7e3d735b18246d659ec9ec7f82c336de
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/07/2021
ms.locfileid: "116792182"
---
# <a name="overview-of-azure-rtos-tracex"></a>Azure RTOS TraceX の概要

Azure RTOS TraceX は、開発者がリアルタイム システムのイベントをグラフィカルに表示し、リアルタイム システムの動作への理解を深めることができる、Microsoft のホストベース分析ツールです。 Azure RTOS TraceX を使用すると、開発者は、標準的なデバッグ ツールでは発生状況がわからない、割り込みやコンテキスト切り替えなどのシステム イベントの発生を明確に確認できます。 このようなイベントを特定して調査し、システムの全体的な動作のコンテキスト内からそれらの発生のタイミングを特定できるので、開発者は、予期しない動作を見つけ、実行時にアプリケーションによって決定されたバッファーの場所やサイズを使って、ターゲット システムのバッファーに格納されている詳しいトレース情報を調べ、特定の領域を調査して、プログラムの問題を解決することができます。 Azure RTOS TraceX では、適切な方法で構築されたあらゆるバッファーを処理できます。Azure RTOS ThreadX だけでなく、任意のアプリケーションや RTOS から構築されたものにも対応しています。 トレース情報は、いつでもホストにアップロードし、分析することができます (事後分析とブレークポイントの両方に対応)。 Azure RTOS ThreadX では、循環バッファーが実装されているので、システムの誤動作やその他の重要なイベントが発生した際に、直近の "N" 個のイベントを調べることができます。

![Azure RTOS TraceX のシングル コア表示](./media/user-guide/screen_shot_33.png)

**TraceX のシングル コア表示**

## <a name="key-capabilites"></a>主な機能

### <a name="azure-rtos-tracex-built-in-system-analysis"></a>Azure RTOS TraceX の組み込みシステム分析

Azure RTOS TraceX には、組み込みのシステム分析レポートが用意されています。これらは、TraceX ツールバーのボタンを 1 回クリックするだけで利用できます。 これらのボタンとレポートには次のものが含まれます。

![実行プロファイル レポートの生成](./media/overview-tracex/execution-profile-report-button.jpg) 実行プロファイル レポートの生成

![パフォーマンス統計レポートの生成](./media/overview-tracex/performance-statistics-report-button.jpg) パフォーマンス統計レポートの生成

![スレッド スタックの使用状況レポートの生成](./media/overview-tracex/thread-stack-usage-report-button.jpg) スレッド スタックの使用状況レポートの生成

### <a name="trace-data-collected-by-azure-rtos-threadx"></a>Azure RTOS ThreadX によって収集されるトレース データ

Azure RTOS TraceX は、Azure RTOS ThreadX と連携するように設計されています。ThreadX では、実行時にターゲット システム上で発生するシステムとアプリケーションの "イベント" に関するデータベースが構築されます。 イベントには次のものがあります。

* スレッド コンテキスト切り替え
* プリエンプション
* 中断
* 終了
* システム割り込み
* アプリケーション固有のイベント
* すべての Azure RTOS ThreadX API 呼び出し
* すべての Azure RTOS NetX API 呼び出し
* すべての Azure RTOS FileX API 呼び出し
* すべての Azure RTOS USBX API 呼び出し
* アプリケーションで定義されたアイコンと情報

イベントは、タイムスタンプとアクティブ スレッド ID を使用してプログラムの制御下で記録されるので、後から、適切な時間シーケンスで、適切なスレッドに関連付けて表示することができます。 イベント ログは、アプリケーション プログラムによって動的に (たとえば、関心領域が検出されたときなどに) 停止および再起動することができます。 そのため、システムが正常に動作しているときにデータベースを操作して、ターゲットのメモリを消費する必要がなくなります。

### <a name="azure-rtos-tracex-is-like-a-software-logic-analyzer"></a>Azure RTOS TraceX はソフトウェア ロジック アナライザーに似ている

イベント ログがターゲット メモリからホストにアップロードされると、Azure RTOS TraceX では、時間を表す水平軸上にイベントがグラフィカルに表示されます。また、イベントが関連しているさまざまなアプリケーション スレッドとシステム ルーチンが、縦軸に沿って表示されます。 Azure RTOS TraceX では、"ソフトウェア ロジック アナライザー" をホスト上に作成することで、システム イベントをわかりやすく表示できます。 イベントは、色分けされたアイコンによって表され、水平のタイムライン上の発生時の位置に表示されます (関連するスレッドまたはシステム ルーチンの右側)。 イベント アイコンを選択すると、そのイベントに対応する情報が表示されます。また、その前後それぞれ 2 件のイベントの情報も表示されます。 そのため、対象のイベントとその前後のイベントに関する重要な情報に、シングルクリックですばやくアクセスできます。 Azure RTOS TraceX では、すべてのシステム イベントを 1 つの水平線上に表示して、多数のスレッドがあるシステムの分析を簡略化できる、"概要" 表示も利用できます。

### <a name="sequential-view-mode"></a>シーケンシャル ビュー モード

シーケンシャル ビュー モードを選択するには、[シーケンシャル ビュー] タブをクリックします。これは既定のモードです。 このモードでは、イベント間の経過時間に関係なく、イベントが相互に連結されて表示されます。 表示領域の上にあるルーラーにも注目してください。 ここには、トレース開始時点からの相対イベント番号が表示されます。 このモードは既定のモードであり、システムの動作の概要を把握するのに特に役立ちます。

![シーケンシャル ビュー モード](./media/user-guide/screen_shot_10.png)

**シーケンシャル ビュー モード**

### <a name="time-view-mode"></a>時間ビュー モード

このモードでは、イベントは時間の経過に即した方法で表示されます。緑色で塗られたバーが、イベント間の実行時間を示します。 このモードは特に、システム内のどこで大量の処理が行われているかを確認するのに役立ちます。これにより、開発者はシステムをチューニングして、パフォーマンスや応答性を向上させることができます。

イベント表示の上にあるルーラーにも注目してください。 このルーラーには、トレース開始時点からの相対ティック数が表示されます。値は、Azure RTOS ThreadX 内のイベント トレース ログに記録されたタイムスタンプから抽出されます。 タイムスタンプの間隔が狭すぎる場合 (低周波タイマー) は、複数のイベントが同時に実行されます。 逆に、タイムスタンプの間隔が広すぎる場合 (高周波タイマー) は、イベントどうしの間隔が空きすぎます。 適切な頻度のタイムスタンプを選択することは、時間ビューをわかりやすくするための重要な考慮事項です。

![時間ビュー モード](./media/user-guide/screen_shot_31.png)

### <a name="system-summary-line"></a>システム概要行

Azure RTOS TraceX には、すべてのイベントが同じ行に表示される、概要行もあります。 概要行にはコンテキストの概要が表示され、その下には対応するイベントの概要が表示されます。 これにより、複雑なシステムの概要を簡単に確認できます。 概要バーは、大量のスレッドがあるシステムで特に役立ちます。 このような概要行がないと、ユーザーは複雑なシステムの状況を把握するために、垂直スクロール バーを使って実行のコンテキストを確認しなければならなくなります。

Azure RTOS TraceX では、画面の左側にシステム コンテキストが一覧表示されます。
特定のコンテキストで発生したイベントは、そのコンテキストの右側の水平線上に表示されます。 これにより、ユーザーはイベントが発生したコンテキストを簡単に確認できるだけでなく、そのコンテキストの線をたどって、特定のコンテキストで発生したすべてのイベントを確認することができます。

![システム概要行](./media/user-guide/screen_shot_32.png)

**システム概要行**

最初の 2 つのコンテキスト エントリは、常に "割り込み" コンテキストと "初期化/アイドル" コンテキストになります。 "割り込み" コンテキストは、割り込みサービス ルーチン (ISR) によって生成されたすべてのシステム イベントを表します。 "初期化/アイドル" コンテキストは、Azure RTOS ThreadX 内での 2 つのコンテキストを表します。 tx_application_define 中に発生したイベントは "初期化" イベントであり、"初期化/アイドル" コンテキストに表示されます。 システムがアイドル状態でイベントが発生していない場合、時間ビューで "実行中" を表す緑色のバーが "初期化/アイドル" コンテキストに表示されます。

## <a name="methods-of-navigation"></a>ナビゲーションの方法

Azure RTOS TraceX では、"次へ" と "前へ" のナビゲーション ボタンの動作を開発者が指定できます。

![ナビゲーション ボタン](./media/user-guide/event.png)

"イベント" が選択されている場合、ナビゲーションは次/前のイベントに対して実行されます。 "コンテキスト" が選択されている場合、ナビゲーションは、同じコンテキスト上の次/前のイベントに対して実行されます。 "オブジェクト" が選択されている場合、ナビゲーションは、現在のオブジェクトの次/前のイベント (特定のキューに関連付けられているイベントなど) に対して実行されます。 "切り替え" が選択されている場合、ナビゲーションは次/前のコンテキスト切り替えに対して実行されます。 "同じ ID" が選択されている場合、ナビゲーションは、同じイベント ID の次/前のイベントに対して実行されます。

### <a name="event-information-display"></a>イベント情報の表示

Azure RTOS TraceX では、約 300 のイベントについて詳細な情報が提供されます。 これには、6 つの内部的な Azure RTOS ThreadX イベント、2 つの ISR イベント (開始および終了)、14 の内部的な Azure RTOS FileX イベント、42 の内部的な Azure RTOS NetX イベント、および 1 つのユーザー定義イベントが含まれます。 残りのイベントは、Azure RTOS ThreadX、Azure RTOS FileX、および Azure RTOS NetX API サービスに直接対応したものです。
シーケンシャル ビューと時間ビューのどちらの表示モードが選択されているかにかかわらず、表示領域内の任意のイベントにマウス ポインターを置くと、そのイベントの近くに詳細なイベント情報が表示されます。 次に示すのは、デモ用の demo_threadx.trx トレース ファイルにあるイベント 494 にマウス ポインターを置いた場合の例です。

![マウス ポインターを置いたときに表示される詳細情報](./media/user-guide/screen_shot_37.png)

**マウス ポインターを置いたときに表示される詳細情報**

表示される各イベントには、コンテキストの情報に加え、相対時刻とタイム スタンプの両方に関する標準的な情報が含まれています。 [コンテキスト] フィールドには、イベントが発生したコンテキストが表示されます。 スレッド、アイドル、ISR、および初期化の 4 つのコンテキストがあります。 イベントがスレッド コンテキストで発生すると、その時点でのスレッド名とその優先順位が収集され、上記のように表示されます。 相対時間は、トレース開始時点からの相対的なタイマー ティック数を示します。 生のタイム スタンプには、イベントの生のタイム ソースが表示されます。 最後に、すべてのイベント固有情報が表示されます。

### <a name="zooming-in-and-out"></a>拡大と縮小

Azure RTOS TraceX の既定では、ピクセルとティックを 1:1 でマッピングした、見やすいサイズでイベントが表示されます。 ユーザーは、必要に応じて拡大や縮小を行うことができます。 100% に縮小すると、現在の表示ビューでトレース全体を表示できます。拡大は、タイム スタンプ ソースの解像度によってイベントが重なって表示される場合に便利です。

![縮小による 100% 表示と拡大による詳細表示](./media/user-guide/screen_shot_41.png)

**縮小による 100% 表示と拡大による詳細表示**

100% に縮小すると、現在の表示ページ内にトレース全体が表示されます。これにより、トレースでキャプチャされたすべてのコンテキストの実行と、それらのコンテキスト内で発生している全般的なイベントを簡単に確認できます。 "スレッド 1" と "スレッド 2" が最も頻繁に実行されていることに注意してください。 イベントを青色で表示することで、これらのスレッドがキュー サービス呼び出しを行っていることも示されています (キュー イベントは青色)。

詳細なアイコン ビューに戻すのも、同じように簡単です。[拡大] ボタンを繰り返し選択するか、100 の倍数を入力します。

### <a name="delta-ticks-between-events"></a>イベント間の差分ティック数

Azure RTOS TraceX では、さまざまなイベント間のタイマー ティック数を簡単に確認できます。開始イベントをクリックし、終了イベントまでドラッグするだけです。
イベント間のティックの差分数は、画面の右上隅に表示されます。

![差分ティック数](./media/user-guide/screen_shot_42.png)

**差分ティック数**

この差分ティック数は、イベント 494 とイベント 496 の間で 5032 ティックが経過したことを示しています。 各イベント内の相対タイム スタンプを見て引き算することで、手動で計算することもできますが、GUI を使ったほうがすばやく簡単に確認できます。

### <a name="priority-inversions"></a>優先度逆転

Azure RTOS TraceX では、トレース ファイル内で検出された優先度逆転が自動的に表示されます。 優先度逆転とは、優先度の高いスレッドが、優先度の低いスレッドによって現在所有されているミューテックスを取得しようとしてブロックされた状態のことです。 この状態は、"決定論的" という用語で表現されます。システムがそのように動作するよう設定されているためです。 ユーザーにわかるように、Azure RTOS TraceX では、"決定論的な" 優先度逆転の範囲が薄いサーモン ピンク色で表示されます。

Azure RTOS TraceX には、"非決定論的" な優先度逆転も表示されます。 これらの優先度逆転では、優先度レベルの異なる別のスレッドが、"決定論的な" 優先度逆転であったものの中間に実行されることで、優先度逆転内の時間がやや "非決定論的" になります。その点で、"決定論的" 優先度逆転とは異なります。 多くの場合、この状況はユーザーからはわからず、非常に深刻な状況をもたらす可能性があります。 この状況をユーザーに警告するために、Azure RTOS TraceX では、"非決定論的" な優先度逆転が、濃いサーモン ピンク色で表示されます。

![決定論的な優先度逆転と非決定論的な優先度逆転](./media/user-guide/screen_shot_43.png)

**決定論的な優先度逆転と非決定論的な優先度逆転**

### <a name="execution-profile"></a>実行プロファイル

Azure RTOS TraceX では、現在読み込まれているトレース ファイル内のすべての実行コンテキストを対象に、組み込みの実行プロファイル レポートを利用できます。

![実行プロファイル](./media/user-guide/execution_profile.png)

### <a name="performance-statistics"></a>Performance statistics

Azure RTOS TraceX では、現在読み込まれているトレース ファイルを対象に、組み込みのパフォーマンス統計レポートを利用できます。

![Performance statistics](./media/user-guide/performance_statistics.png)

### <a name="thread-stack-usage"></a>スレッド スタック使用状況

Azure RTOS TraceX では、現在読み込まれているトレース ファイル内で実行されているすべてのスレッドを対象に、組み込みのスタック使用状況レポートを利用できます。

![スタックの使用](./media/user-guide/thread_stack_usage.png)

Azure RTOS TraceX では、現在読み込まれているトレース ファイルの Azure RTOS FileX パフォーマンス統計を表示できます。 この情報は、システム全体 (開いているすべてのメディア オブジェクト) を対象に表示されます。

![FileX 統計](./media/user-guide/filex_statistics.png)

### <a name="azure-rtos-netx-statistics"></a>Azure RTOS NetX 統計

Azure RTOS TraceX では、現在読み込まれているトレース ファイルの NetX パフォーマンス統計を表示できます。 この情報は、システム全体を対象に表示されます。

![NetX 統計](./media/user-guide/netx_statistics.png)

### <a name="raw-trace-dump"></a>生のトレース ダンプ

Azure RTOS TraceX では、生のトレース ファイルをテキスト形式で作成し、メモ帳で開いて表示することができます。

![生のトレース ダンプ](./media/user-guide/raw_trace_dump.png)

表示されるすべてのタイミングとサイズの数値は推定値であり、開発プラットフォームによって異なる場合があることに注意してください
