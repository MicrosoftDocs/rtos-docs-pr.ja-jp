---
title: 第 4 章 - Azure RTOS TraceX のパフォーマンス分析
description: この章では、Azure RTOS TraceX のパフォーマンス分析ツールについて説明します。
author: philmea
ms.service: rtos
ms.topic: article
ms.date: 5/19/2020
ms.author: philmea
ms.openlocfilehash: 6cf1b5bd5349efd97c3afc8a9e7f57f477f06f8f
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/22/2021
ms.locfileid: "104812353"
---
# <a name="chapter-4---azure-rtos-tracex-performance-analysis"></a>第 4 章 - Azure RTOS TraceX のパフォーマンス分析

この章では、Azure RTOS TraceX のパフォーマンス分析ツールについて説明します。

## <a name="performance-analysis"></a>パフォーマンス分析

TraceX には、トレース ファイルのパフォーマンス分析機能が組み込みで用意されています。 *実行プロファイル*、*人気のあるサービス*、*スレッド スタックの使用状況*、および各種 *パフォーマンス統計* (FileX および NetX の統計を含む) などの情報を、簡単に確認できます。 これらの情報は、***[表示]*** メニュー項目から確認できます。 


## <a name="execution-profile"></a>実行プロファイル

***[実行プロファイルの生成]** _ ボタンまたは _*_[表示] - [実行プロファイル]_*_ を選択すると、現在読み込まれているトレース ファイルの TraceX 実行プロファイルが表示されます。 _*図 19** に示すのは、サンプルの ThreadX デモ トレースに関連付けられた実行プロファイルです。

![サンプルの ThreadX デモ トレースに関連付けられた実行プロファイルのスクリーンショット。](./media/user-guide/execution_profile.png)

**図 19**

**図 19** の例では、処理時間の約 45% が "**_スレッド 2_*_" 内にあり、処理時間の約 51% が "_*_スレッド 1_**" 内にあります。トレースの大部分ではこれらのスレッドによってメッセージが送受信されているので、これは理にかなった値と言えます。 この例では、残りの実行コンテキストでの実行時間はごくわずかです。

## <a name="popular-services"></a>人気のあるサービス

***[表示] -> [人気のあるサービス]** _ を選択すると、現在読み込まれているトレース ファイル内の人気のあるサービスが表示されます。 既定では、この情報はシステム全体を対象に表示されます。 ただし、特定のスレッドを対象にして人気のサービスを確認することもできます。 *図 20** に示すのは、サンプルの ThreadX デモ トレースの人気サービスです。

![サンプルの ThreadX デモ トレースの人気サービスのスクリーンショット。](./media/user-guide/popular_services.png)

**図 20**

**図 20** の例では、**_tx_queue_send_*_ と _*_tx_queue_receive_** が、このトレースで最もよく使用されている 2 つのサービスであることがわかります。 これは、このトレースのキャプチャ元である標準の ThreadX デモの動作と一致しています。

このウィンドウの上部にあるドロップダウン リストを使用すると、特定のスレッドを選択してこの分析を行うことができます。 **図 21** は、"**_スレッド 3_**" を対象にしてこの分析を行った場合の結果です。

![TraceX の人気サービス分析のスクリーンショット。](./media/user-guide/popular_services_thread3.png)

**図 21**

## <a name="thread-stack-usage-analysis-for-thread-3"></a>スレッド スタックの使用状況 ![スレッド 3 の分析。](./media/user-guide/screen_shot_17.png)

***[スレッド スタック使用状況の生成]** _ ボタンまたは _*_[表示] -> [スレッド スタックの使用状況]_*_ を選択すると、トレース ファイル内の各スレッドのスタック使用状況が表示されます。 これは、ファイル内のトレース エントリの多くに現在のスレッド スタック ポインターを含んでいる ThreadX によって実現されます。 スタックの使用率が100% の場合、それはスタックがオーバーフローした状態であり、アプリケーションで修正する必要があることを示します。 そのトレース ファイル内でスレッドの実行がない場合、そのスレッドのスタック使用率は 0% と表示されます。 _* 図 22** に示すのは、サンプルの ThreadX デモ トレースのスレッド スタック使用状況です。

![TraceX のスレッド スタック使用状況のスクリーンショット。](./media/user-guide/thread_stack_usage.png)

**図 22**

**図 22** の例では、このトレースのほとんどのスレッドのスタック使用率が、9% から 12% であると示されています。

## <a name="performance-statistics"></a>パフォーマンス統計

***[パフォーマンス統計の生成]** _ ボタンまたは _ *_[表示] -> [パフォーマンス統計]_** を選択すると、現在読み込まれているトレース ファイルのパフォーマンス統計が表示されます。 既定では、この情報はシステム全体を対象に表示されます。 ただし、特定のスレッドを対象にパフォーマンス統計を表示することもできます。

**図 23** に示すのは、サンプルの ThreadX デモ トレースのパフォーマンス統計です。

![TraceX のパフォーマンス統計のスクリーンショット。](./media/user-guide/performance_statistics.png)

**図 23**

**図 23** の例の場合、このトレース ファイルには、18 件のコンテキスト切り替え、5 件のスレッド プリエンプション、16 件のスレッド保留、19 件のスレッド再開、および 3 件の割り込みがあると表示されています。 このトレース ファイルに優先度逆転は見つかりませんでした。 優先度逆転には、"*決定論的*" と "*非決定論的*" の 2 つのカテゴリがあります。 決定論的な優先度逆転とは、優先度の低いスレッドによって所有されているミューテックスでスレッドがブロックされる優先度逆転のことです。 非決定論的な優先度逆転とは、決定論的な優先度逆転の最中に、別の優先度の低いスレッドが実行される状況のことです。 後者の場合、アプリケーションで予期しないタイミング動作が発生する可能性があるため、注意深く調査する必要があります。

## <a name="filex-statistics"></a>FileX 統計

***[表示] -> [FileX 統計]** _ を選択すると、現在読み込まれているトレース ファイルの FileX パフォーマンス統計が表示されます。 この情報は、システム全体 (開いているすべてのメディア オブジェクト) を対象に表示されます。 _*図 24** に示すのは、サンプルの FileX デモ トレースのパフォーマンス統計です。

![FileX 統計のスクリーンショット。](./media/user-guide/filex_statistics.png)

**図 24**

**図 27** の例では、19 件のメディア オープン、19 件のメディア クローズ、19 件のメディア フラッシュ、18 件のディレクトリ読み取り、19 件のディレクトリ書き込み、および 18 件のディレクトリ キャッシュ ミスがあったと表示されています。 統計ウィンドウで下にスクロールすると、その他の情報も確認できます。

## <a name="netx-statistics"></a>NetX 統計

***[表示] - [NetX 統計]** _ を選択すると、現在読み込まれているトレース ファイルの NetX パフォーマンス統計が表示されます。 この情報は、システム全体を対象に表示されます。 _*図 25** に示すのは、サンプルの NetX デモ トレースのパフォーマンス統計です。

![NetX 統計のスクリーンショット。](./media/user-guide/netx_statistics.png)

**図 25**

**図 25** の例では、ARP、Ping、および UDP イベントはなく、30 件の IP パケット送信、1368 件の IP バイト送信、30 件の IP パケット受信、および 1360 件の IP バイト受信があったと表示されています。

## <a name="trace-file-information"></a>トレース ファイル情報

***[表示] -> [トレース ファイル情報]** _ を選択すると、開いているトレース ファイルに関する、いくつかの基本的な情報が表示されます。 この情報には、ファイルのバイト順、タイム ソースのサイズ、各オブジェクト名の最大バイト数、およびすべてのトレース ファイル ポインターのベース アドレスが含まれます。 _ *図 26** に示すのは、標準の **_demo_threadx.trx_** トレース ファイルのトレース ファイル情報です。

![TraceX のファイル情報のスクリーンショット。](./media/user-guide/trace_file_info.png)

**図 26**

## <a name="raw-trace-dump"></a>生のトレース ダンプ

***[表示] -> [生のトレース ダンプ]** _ を選択すると、生のトレース ダンプを含んだファイルを指定するダイアログが表示されます。 ファイル名とパスを入力すると、TraceX によって生のトレース ファイルがテキスト形式で作成され、_*_notepad.exe_*_ が起動してファイルが表示されます。 _ *図 27** に示すのは、標準の **_demo_threadx.trx_** トレース ファイルの生のトレース ファイル ダンプです。

![生のトレース ダンプのスクリーンショット。](./media/user-guide/raw_trace_dump.png)

**図 27**
