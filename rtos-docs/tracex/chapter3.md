---
title: 第 3 章 - Azure RTOS TraceX の説明
description: この章では、Azure RTOS TraceX システム分析ツールの全体的な機能について説明します。これには、GUI の全体的な機能が含まれます。
author: philmea
ms.service: rtos
ms.topic: article
ms.date: 5/19/2020
ms.author: philmea
ms.openlocfilehash: 1c974b353c92e0a3cf51c92818794197cf999582
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/22/2021
ms.locfileid: "104812440"
---
# <a name="chapter-3---description-of-azure-rtos-tracex"></a>第 3 章 - Azure RTOS TraceX の説明

この章では、Azure RTOS TraceX システム分析ツールの全体的な機能について説明します。これには、GUI の全体的な機能が含まれます。 

## <a name="display-overview"></a>表示の概要

**図 4** は、TraceX システム分析ツールのメインの表示ウィンドウを示したものです。 レイアウトはわかりやすく、実行コンテキストが左側の垂直の要素によって表されます。たとえば、初期化、割り込み、アイドル、各種スレッド エントリなどです。 各コンテキストで実行されるイベントは、同じコンテキスト行に水平方向に表示されます。 たとえば、次に示す **QR** イベントでは、"**_スレッド 2_ *_" が _* _tx_queue_receive_** に対して連続呼び出しを行っていることがわかります。

![TraceX システム分析ツールのメイン表示ウィンドウのスクリーンショット。](./media/user-guide/screen_shot_10.png)


**図 5**

コンテキストの変更は、コンテキスト行をつなぐ黒い縦線で表されます。 現在選択されているイベントは、赤い縦線で表されます。 この例では、イベント 494 が選択されています。

## <a name="title-bar"></a>タイトル バー

TraceX のタイトル バーには、いくつかの有用な情報が表示されます。 1 つ目は、TraceX の現在のバージョンです。 2 つ目は、現在開いているトレース ファイルの完全なパスです。 **図 6** の例では、**_TraceX_ *_ バージョン _* _6.0.0_ *_ に、_* _demo_threadx.trx_** トレース ファイルが表示されています。

![TraceX のタイトル バーのスクリーンショット。](./media/user-guide/screen_shot_11.png)

**図 6**

## <a name="tool-bar"></a>ツール バー

TraceX ツールバーには、トレース ファイルを開いたり、その表示の要素を制御したりするためのボタンがいくつか用意されています。

![TraceX ツール バーのスクリーンショット。](./media/user-guide/screen_shot_12.png)


**図 7**

TraceX のツール バーのボタン (左から右) は、次のように定義されています。
                                             
| **ボタン**                         | **Function** |
| ---------------------------------- | ----------------------------------------------------------------------------------------------- |
| ![トレース ファイルを開くボタン](./media/user-guide/screen_shot_13.png)      | トレース ファイルを開きます |
| ![ユーザー ガイドを開くボタン](./media/user-guide/screen_shot_14.png)      | このユーザー ガイドを開きます |
| ![実行プロファイルの生成ボタン](./media/user-guide/screen_shot_15.png)       | 実行プロファイルを生成します |
| ![ パフォーマンス統計の生成ボタン](./media/user-guide/screen_shot_16.png)       | パフォーマンス統計を生成します |
| ![スレッド スタック使用状況の生成ボタン](./media/user-guide/screen_shot_17.png)       | スレッド スタックの使用状況を生成します |
| ![選択したイベントの表示ボタン](./media/user-guide/screen_shot_18.png)       | 現在選択されているイベントを表示します |
| ![検索ボタン](./media/user-guide/screen_shot_19.png)      | イベントを検索します |
| ![拡大ボタン](./media/user-guide/screen_shot_20.png)      | [拡大] |
| ![拡大表示ボタン](./media/user-guide/screen_shot_21.png)      | 拡大表示のパーセンテージを選択します。100% を指定すると、現在のビュー内にトレース ファイル全体が表示されます。 |
| ![縮小ボタン](./media/user-guide/screen_shot_22.png)      | 縮小 |
| ![最初のイベントの選択ボタン](./media/user-guide/screen_shot_23.png)      | 最初のイベントを選択します。 |
| ![前のイベント ページの表示ボタン](./media/user-guide/screen_shot_24.png)      | 前のイベント ページを表示します。 |
| ![前のイベントの表示ボタン](./media/user-guide/screen_shot_25.png)      | 前のイベントを表示します。 |
| ![次へ/前へナビゲーション ボタン](./media/user-guide/screen_shot_26.png)      | [次へ/前へ] ナビゲーション ボタンの動作を決定します。 "***イベント** _" が選択されている場合、ナビゲーションは次/前のイベントに対して実行されます。 "_*_コンテキスト_*_" が選択されている場合、ナビゲーションは、指定されたコンテキスト上の次/前のイベントに対して実行されます。 "_*_オブジェクト_*_" が選択されている場合、ナビゲーションは、指定されたオブジェクトの次/前のイベント (特定のキューに関連付けられているイベントなど) に対して実行されます。 "_*_切り替え_*_" が選択されている場合、ナビゲーションは次/前のコンテキスト変更に対して実行されます。 "_ *_ID_**" が選択されている場合、ナビゲーションは、指定されたイベント ID の次/前のイベントに対して実行されます。 |
| ![次のイベントの表示ボタン](./media/user-guide/screen_shot_27.png)      | 次のイベントを表示します。 |
| ![次のイベント ページの表示ボタン](./media/user-guide/screen_shot_28.png)      | 次のイベント ページを表示します。 |
| ![最後のイベントの選択ボタン](./media/user-guide/screen_shot_29.png)      | 最後のイベントを選択します。 |

## <a name="display-mode-tabs"></a>表示モード タブ

TraceX では、システム イベントが 2 種類の方法で表示されます。"*シーケンシャル*" と "*相対時間*"です。 既定のモードはシーケンシャルで、**図 8** に示されているモードです。

モードの変更は簡単です。TraceX ウィンドウで、* **[シーケンシャル ビュー]** _ または _*_[時間ビュー]_*_ の各タブを選択するだけです。 _*図 8** は、**_[シーケンシャル ビュー]_*_ と _ *_[時間ビュー]_** の各タブを示したものです。

![シーケンシャル ビューと時間ビューの各タブのスクリーンショット。](./media/user-guide/screen_shot_30.png)

**図 8**

## <a name="sequential-view-mode"></a>シーケンシャル ビュー モード

シーケンシャル ビュー モードは、_*Figure 8** に示されている * **[シーケンシャル ビュー]** _ タブによって選択されます。 これは既定のモードです。 このモードでは、イベント間の経過時間に関係なく、イベントが相互に連結されて表示されます。 **図 8** の表示領域の上にあるルーラーにも注目してください。 ここには、トレース開始時点からの相対イベント番号が表示されます。

このモードは既定のモードであり、システムの動作の概要を把握するのに役立ちます。

## <a name="time-view-mode"></a>時間ビュー モード

時間ビュー モードは、* **[時間ビュー]** _ ボタンによって選択されます。 _ *図 9** は、**図 8** と同じイベントト レースを時間ビュー モードで表示したものです。 このモードでは、イベントは時間の経過に即した方法で表示されます。緑色で塗られたバーが、イベント間の実行時間を示します。 このモードは、システム内のどこで大量の処理が行われているかを確認するのに役立ちます。これにより、開発者はシステムをチューニングして、パフォーマンスや応答性を向上させることができます。

![時間ビュー タブのスクリーンショット。](./media/user-guide/screen_shot_31.png)

**図 9**

**図 9** のイベント表示の上にあるルーラーにも注目してください。 このルーラーには、トレース開始時点からの相対ティック数が表示されます。値は、ThreadX 内のイベント トレース ログに記録されたタイムスタンプから抽出されます。 タイム スタンプの間隔が狭すぎる場合 (低周波タイマー) は、複数のイベントが同時に実行されます。 逆に、タイム スタンプの間隔が広すぎる場合 (高周波タイマー) は、イベントどうしの間隔が空きすぎます。 適切な頻度のタイムスタンプを選択することは、時間ビューをわかりやすくするための重要な考慮事項です。

## <a name="system-summary-line"></a>システム概要行

TraceX には、すべてのイベントが同じ行に表示される、概要行もあります (**図 10** の上部にあるコンテキスト)。 これにより、複雑なシステムの概要を簡単に確認できます。 概要バーは、多数のスレッドがあるシステムで特に役立ちます。 このような概要行がないと、ユーザーは複雑なシステムの状況を把握するために、垂直スクロール バーを使って実行のコンテキストを確認しなければならなくなります。

![[シーケンシャル ビュー] タブのシステム概要行のスクリーンショット。](./media/user-guide/screen_shot_32.png)


**図 10**

概要行にはコンテキストの概要が表示され、その下には対応するイベントの概要が表示されます。 **図 10** に示されている例では、"**_スレッド 2_ *_" が実行中で、現在中断されていることが簡単にわかります。割り込みによって、"_* _スレッド 3_**"、"***スレッド 6** _"、"_*_スレッド 4_*_"、"_*_スレッド 7_*_ " によるプリエンプションが発生し、その後 _ *_スレッド 2_* * が実行を再開しています。

## <a name="system-contexts"></a>システム コンテキスト

TraceX では、**図 11** に示すように、画面の左側にシステム コンテキストが一覧表示されます。 特定のコンテキストで発生したイベントは、そのコンテキストの右側の水平線上に表示されます。 これにより、ユーザーはイベントが発生したコンテキストを簡単に確認できるだけでなく、そのコンテキストの線をたどって、特定のコンテキストで発生したすべてのイベントを確認することができます。

最初の 2 つのコンテキスト エントリは、常に "***割り込み** _" コンテキストと "_*_初期化/アイドル_*_" コンテキストになります。 "_*_割り込み_*_" コンテキストは、割り込みサービス ルーチン (ISR) によって生成されたすべてのシステム イベントを表します。 "_*_初期化/アイドル_*_" コンテキストは、ThreadX 内での 2 つのコンテキストを表します。 _*_tx_application_define_*_ 中に発生したイベントは、"_*_初期化/アイドル_*_" コンテキストです。 システムがアイドル状態でイベントが発生していない場合、時間ビューで "_*_実行中_*_" を表す緑色のバーが "_ *_初期化/アイドル_**" コンテキストに表示されます。

![画面左側のシステム コンテキストのスクリーンショット。](./media/user-guide/screen_shot_33.png)

**図 11**

**図 11** の例では、"**_システム タイマー スレッド_ *_" コンテキストから始まる 9 つのスレッド コンテキストがあります。個々のコンテキストにマウス ポインターを置くと、そのコンテキストに関する追加情報を確認できます。追加情報には、スレッドの開始スタック アドレス、終了スタック アドレス、合計サイズ、使用率、相対実行率、中断の回数、再開、およびトレース中の最高優先度と最低優先度が含まれます。_* 図 12** では、"**_スレッド 0_**" の情報が表示されています。

![スレッド 0 の情報のスクリーンショット。](./media/user-guide/screen_shot_34.png)


**図 12**

コンテキストを移動させて、特に注目するべきコンテキストをグループ化することもできます。 これを行うには、コンテキストをドラッグ アンド ドロップするか、コンテキストを右クリックします。 コンテキストを右クリックすると、コンテキストを上下に移動するためのダイアログが表示されます。 

* **[上端へ移動]** _ を選択すると、_*図 13** のように、"_*_スレッド 3_*_" のコンテキストがコンテキスト リストの一番上に移動されます。

![コンテキストがコンテキスト リストの一番上に移動された様子を示すスクリーンショット。](./media/user-guide/screen_shot_35.png)


**図 13**

## <a name="thread-status-information"></a>スレッドの状態の情報

有効にすると、TraceX ではスレッドのコンテキストに色付きの線が表示され、各スレッドの状態が示されます。 緑色の線は、スレッドが "準備できている" 状態であることを示し、その他の色の線は、スレッドが中断されていることを示します。 中断されたスレッドの場合、線の色は、スレッドが中断されている ThreadX オブジェクトの種類を表します。 たとえば、**図 13** では、イベント 147 から始まる "**_システム タイマー スレッド_ *_" コンテキストの緑色の線によって、"_* _システム タイマー スレッド_ *_" の準備完了状態が示されています。イベント 147 の前と イベント 154 の後で、緑色の線は "_* _システム タイマー スレッド_ *_" が準備できた状態であることを示し、緑色の線がない箇所は "_* _システム タイマー スレッド_**" が中断されていることを示しています。

![スレッドのコンテキスト上の色付きの線によって各スレッドの状態が表されている画面のスクリーンショット。](./media/user-guide/screen_shot_36.png)

**図 14**

スレッドの状態表示には 3 つのモードがあり、* **[オプション] -> [Status Lines]\(ステータス ライン\)** _ メニューから選択できます。 "_*_準備完了のみ_*_" オプションを選択すると、準備完了状態を表す線 (緑) のみが表示され、中断状態を表す線は表示されません。 これが TraceX の既定のオプションです。 "_ *_すべてオン_**" オプションを選択すると、すべての状態の線 (準備完了と中断) が表示されます。

最後に、"***すべてオフ***" オプションを選択すると、すべての状態の線が表示されなくなります。

## <a name="event-information-display"></a>イベント情報の表示

TraceX では、ThreadX、FileX、NetX、NetX Duo、および USBX API 呼び出しや内部イベントなど、約 600 のランタイム イベントに関する詳細情報を確認できます。 また TraceX では、最大 61,439 個の、一意のユーザー定義イベントも追加でサポートできます。

シーケンシャル ビューと時間ビューのどちらの表示モードが選択されているかにかかわらず、表示領域内の任意のイベントにマウス ポインターを置くと、そのイベントの近くに詳細なイベント情報が表示されます。 _*図 15** に示すのは、デモ用の ***demo_threadx.trx** _ トレース ファイルにあるイベント 143 にマウス ポインターを置いた場合の例です。

![サンプル トレース ファイル内のイベント 143 にマウス ポインターを置いた様子を示すスクリーンショット](./media/user-guide/screen_shot_37.png)

**図 15**

表示される各イベントには、"***コンテキスト** _" の情報に加え、"_*_相対時間_*_"と"_*_タイム スタンプ_*_"の両方に関する標準的な情報が含まれています。 [コンテキスト] フィールドには、イベントが発生したコンテキストが表示されます。 スレッド、アイドル、ISR、および初期化の 4 つのコンテキストがあります。 イベントがスレッド コンテキストで発生すると、その時点でのスレッド名とその優先順位が収集され、上記のように表示されます。 "_*_相対時間_*_" は、トレース開始時点からの相対的なタイマー ティック数を示します。 "_ *_生のタイム スタンプ_**" には、イベントの生のタイム ソースが表示されます。 最後に、すべてのイベント固有情報が表示されます。 この情報については、この章の残りの部分で詳しく説明します。

詳細なイベント情報は、イベントをダブル クリックすることでも表示できます。 **図 16** は、イベント 143 をダブル クリックした場合の例です。

![イベントをダブルクリックして表示された詳細なイベント情報のスクリーンショット。](./media/user-guide/screen_shot_38.png)

**図 16**

一度に複数のイベントを表示すると、ユーザーは何が起こっているのかをより高度に把握することができます。 多数のイベントが相互に関連し合っているので、それらを並べて表示できるというのは非常に便利です。 これを行うには、複数のイベントをダブル クリックします。

## <a name="current-event-display"></a>現在のイベントの表示

TraceX では、現在のイベントを個別のウィンドウで表示できます。これは、ユーザーが ***[表示] -> [現在のイベント]*** で選択するか、ツール バーの [現在のイベント] ボタンをクリックした場合に表示されます。 選択すると、TraceX では、現在選択されているイベントがスタンドアロンのウィンドウで表示されます。このウィンドウは、別のイベントが選択されるたびに更新されます。

## <a name="event-searching"></a>イベント検索

TraceX では、幅広いイベント検索機能が提供されています。 各イベントのイベント ID フィールドと情報フィールドが、主要な検索パラメーターです。 特定の検索パラメーターの値を指定しなかった場合、そのパラメーターは検索から除外されます。 また、検出されたパラメーターのいずれかが条件に適合するものを検索したり、検出されたすべてのパラメーターが条件に適合するものを検索したりすることもできます。 さらに、検索対象を特定のコンテキストに制限したり、トレース内のすべてのコンテキストを対象にしたりすることもできます。 イベント検索は、ツール バーの * **[値で検索]** _ ボタン ( _*図 17**) を選択することで起動できます。選択すると、検索ダイアログが表示されます。ここで、検索のすべてのパラメーターを指定します。検索ダイアログの **_[次へ]_*_ ボタンと _*_[前へ]_*_ ボタンを使用すると、指定した検索条件に一致する次のイベントや前のイベントを検索できます。 _ *図 17** は、検索ダイアログを示したものです。

![イベント検索のスクリーンショット。](./media/user-guide/screen_shot_39.png)

**図 17**

![検索ダイアログのスクリーンショット。](./media/user-guide/screen_shot_40.png)

**図 18**

## <a name="zooming-in-and-out"></a>拡大と縮小

TraceX の既定では、イベントはフル サイズで表示されます。 ユーザーは、必要に応じて拡大や縮小を行うことができます。 縮小は、トレース内でキャプチャされたイベント全体を表示したい場合に便利です。拡大は、タイム スタンプ ソースの解像度によってイベントが重なって表示される場合に便利です。 **図 19** は、**_demo_threadx.trx_** ファイルの表示を縮小して、トレース ファイルが 100% 表示されるようにしたときの様子です。

![トレース ファイルが100% 表示されるように縮小したサンプル ファイルのスクリーンショット。](./media/user-guide/screen_shot_41.png)

**図 19**

100% に縮小して、現在の表示ページ内にトレース全体が表示されるようにすると、トレース内でキャプチャされたすべてのコンテキストの実行と、それらのコンテキスト内で発生している全般的なイベントを簡単に確認できます。 **図 16** で、"**_スレッド 1_ *_" と "_* _スレッド 2_**" が最も頻繁に実行されていることに注意してください。 イベントを青色で表示することで、これらのスレッドがキュー サービス呼び出しを行っていることも示されています (キュー イベントは青色)。

詳細なアイコン ビューに戻すのも、同じように簡単です。[拡大] ボタンを繰り返し選択するか、100 の倍数を入力します。

## <a name="delta-ticks-between-events"></a>イベント間の差分ティック数

TraceX では、さまざまなイベント間のティック数を簡単に確認できます。開始イベントをクリックし、終了イベントまでドラッグするだけです。 イベント間のティックの差分数は、**図 17** に示すように、画面の右上隅に表示されます。

![イベント間のティックの差分数のスクリーンショット。](./media/user-guide/screen_shot_42.png)

**図 17**

**図 17** の差分ティック数は、イベント 125 とイベント 154の間で 5032 ティックが経過したことを示しています。 各イベント内の相対タイム スタンプを見て引き算することで、手動で計算することもできますが、GUI を使ったほうがすばやく簡単に確認できます。

## <a name="actual-time-display"></a>実際の時間の表示

有効にした場合、TraceX では、実際の時間 (マイクロ秒単位) が ***時間ビュー** _ で表示されるほか、TraceX によって表示されるさまざまな差分時間情報についても表示されます。 既定では、実際の時間の表示は無効になっています。 実際の時間の表示を有効にするには、_ *_[オプション] -> [マイクロ秒あたりのティック数]_** メニューを選択して、1 マイクロ秒あたりのティック数を入力する必要があります (入力する値は、ターゲットでの TraceX イベント ログに使用されるハードウェア タイマー ソースによって決まります)。

## <a name="priority-inversions"></a>優先度逆転

TraceX では、トレース ファイル内で検出された優先度逆転が自動的に表示されます。 優先度逆転とは、優先度の高いスレッドが、優先度の低いスレッドによって現在所有されているミューテックスを取得しようとしてブロックされた状態のことです。 この状態は、"*決定論的*" という用語で表現されます。システムがそのように動作するよう設定されているためです。 ユーザーにわかるように、TraceX では、"*決定論的* な" 優先度逆転の範囲が薄いサーモン ピンク色で表示されます。

TraceX には、"*非決定論的*" な優先度逆転も表示されます。 これらの優先度逆転では、優先度レベルの異なる別のスレッドが、"*決定論的*" な優先度逆転であったものの中間に実行されることで、優先度逆転内の時間がやや "*非決定論的*" になります。その点で、"*決定論的*" 優先度逆転とは異なります。 多くの場合、この状況はユーザーからはわからず、非常に深刻な状況をもたらす可能性があります。 この状況をユーザーに警告するために、TraceX では、"*非決定論的*" な優先度逆転が、濃いサーモン ピンク色で表示されます。 **図 18** は、"*決定論的*" 優先度逆転と "*非決定論的*" 優先度逆転の両方を示したものです。

![トレース ファイル内の優先度逆転のスクリーンショット。](./media/user-guide/screen_shot_43.png)

**図 18**

**図 18** では、イベント 398 からイベント 402 までの "*決定論的*" 優先度逆転が示されています。 この範囲では、優先度の低い "_*_スレッド 1_*_" が所有するミューテックスで、優先度の高い "***スレッド 0** _" がブロックされます。 イベント 402 で、"_ *_スレッド 1_**" がミューテックスを解放し、優先度逆転が終了しています。

濃い色え網掛けされた領域は、イベント 408 からイベント 420 までの間の "*非決定論的*" 優先度逆転を示しています。 これがなぜ "*非決定論的*" かというと、優先度の高い "_*_スレッド 0_*_" がブロックされているミューテックスを "***スレッド 1** _" が保有しているときに、"_*_スレッド 2_**" を再開するという割り込みが発生し、その後実行されることで、システムの優先度逆転状態の時間が長くなるからです。 この状況は非常に深刻な事態を招いたり、特定するのが困難な場合もありますが、TraceX では簡単に識別できます。
