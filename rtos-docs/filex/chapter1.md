---
title: 第 1 章 - Azure RTOS FileX の概要
description: Azure RTOS FileX は、深く埋め込まれたアプリケーション用の完全な FAT 形式のメディアおよびファイル管理システムです。
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: be7e6f9cd9fbc69ac0908d1de733dac1c4f73bf6
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/22/2021
ms.locfileid: "104810334"
---
# <a name="chapter-1---introduction-to-azure-rtos-filex"></a>第 1 章 - Azure RTOS FileX の概要

Azure RTOS FileX は、深く埋め込まれたアプリケーション用の完全な FAT 形式のメディアおよびファイル管理システムです。 この章では、FileX の概要と、そのアプリケーションおよび利点について説明します。

## <a name="filex-unique-features"></a>FileX の固有の機能

Azure RTOS FileX では、RAM ディスク、FLASH マネージャー、実際の物理デバイスなど、無制限の数のメディア デバイスが同時にサポートされています。 12 ビット、16 ビット、32 ビットのファイル アロケーション テーブル (FAT) 形式がサポートされています。また、拡張ファイル アロケーション テーブル (exFAT) と連続したファイルの割り当てもサポートされており、サイズとパフォーマンスの両方について高度に最適化されています。 FileX には、フォールト トレラントのサポート、メディアのオープンとクローズ、ファイル書き込みコールバック関数も含まれています。

FileX は、拡大する FLASH デバイスのニーズを満たすように設計されており、ThreadX と同じ設計とコーディングの方法が使用されています。 すべての Microsoft 製品と同様に、FileX と共に完全な ANSI C ソース コードが配布されており、実行時のロイヤリティはありません。

### <a name="product-highlights"></a>製品の特徴

- ThreadX プロセッサの完全なサポート
- ロイヤリティなし
- 完全な ANSI C ソース コード
- リアルタイムのパフォーマンス
- すばやく対応するテクニカル サポート
- 無制限の FileX オブジェクト (メディア、ディレクトリ、ファイル)
- FileX オブジェクトの動的な作成と削除
- 柔軟なメモリの使用
- サイズの自動スケーリング
- 小さいフットプリント (最小 6 KB) の命令領域サイズ: 6 - 30 K
- ThreadX との完全な統合
- エンディアン ニュートラル
- 簡単に実装できる FileX I/O ドライバー
- 12、16、32 ビットの FAT のサポート
- exFAT のサポート
- 長いファイル名のサポート
- 内部 FAT エントリ キャッシュ
- Unicode 名のサポート
- 連続したファイルの割り当て
- 連続するセクターとクラスターの読み取りと書き込み
- 内部論理セクターのキャッシュ
- すぐに実行できる RAM ディスクのデモ
- メディア フォーマット機能
- エラーの検出と回復
- フォールト トレラント オプション
- 組み込みのパフォーマンス統計情報
- スタンドアロンのサポート (Azure RTOS なし)

## <a name="safety-certifications"></a>安全性の認定

### <a name="tv-certification"></a>TÜV 認定

FileX は、IEC-61508 および IEC-62304 に従って、安全性が重要なシステムでの使用を SGS-TÜV Saar によって認定されています。 この認定により、「電気・電子・プログラマブル電子安全関連系の機能安全」に関する国際電気標準会議 (IEC) 61508 および IEC 62304 の安全性の最高レベルに対応する安全関連ソフトウェアの開発で FileX を使用できることが確認されています。 ドイツの SGS-Group と TÜV Saarland の共同事業を通じて結成された SGS-TÜV Saar は、世界中の安全関連システムのための組み込みソフトウェアのテスト、監査、検証、認定を行う、世界有数の公認された独立系企業になりました。 工業安全規格の IEC 61508 と、それから派生したすべての標準 (IEC 62304 を含む) は、電気・電子・プログラマブル電子安全関連の医療デバイス、プロセス制御システム、工業機械、鉄道制御システムの機能安全を保証するために使用されます。

SGS-TÜV Saar は、ISO 26262 標準に従って、安全性が重要な自動車システムで FileX を使用することを認可しました。 さらに、FileX は、ISO 26262 認定の最高レベルを表す Automotive Safety Integrity Level (ASIL) D に認定されています。

さらに、SGS-TÜV Saar では、FileX が SW-SIL 4 までの EN 50128 標準を満たしており、安全性が重要な鉄道アプリケーションで使用できるものとして認定しています。

![SGS-TUV Saar のロゴ](./media/user-guide/sgs-tuv-saar-logo.png)

- IEC 61508 (SIL 4 まで)
- IEC 62304 (SW 安全性クラス C まで)
- ISO 26262 ASIL D
- EN 50128 SW-SIL 4

> [!IMPORTANT]
> TÜV によって認定されている FileX のバージョンに関する情報や、テスト レポート、証明書、関連ドキュメントの入手については、Microsoft までお問い合わせください。*

### <a name="ul-certification"></a>UL 認定

FileX は、プログラマブル コンポーネント内のソフトウェアに対する UL 60730-1 付属文書 H、CSA E60730-1 付属文書 H、IEC 60730-1 付属文書 H、UL 60335-1 付属文書 R、IEC 603351 付属文書 R、UL 1998 の各安全標準に準拠しているものとして UL によって認定されています。 IEC/UL 60730-1 (付属文書 H に「ソフトウェアを使用した制御」に対する要件がある) と共に、IEC 60335-1 標準では、「プログラマブル電子回路」に対する要件がその付属文書 R で説明されています。IEC 60730 付属文書 R と IEC 60335-1 付属文書 R では、洗濯機、乾燥機、冷蔵庫、冷凍庫、オーブンなどのアプライアンスで使用される MCU のハードウェアとソフトウェアの安全性が取り上げられています。

![C RU US 2](./media/user-guide/c-ru-us-logo.png)

*UL/IEC 60730、UL/IEC 60335、UL 1998*

> [!IMPORTANT]
>*UL によって認定されている FileX のバージョンに関する情報や、テスト レポート、証明書、関連ドキュメントの入手については、Microsoft までお問い合わせください。*

## <a name="powerful-services-of-filex"></a>FileX の強力なサービス

### <a name="multiple-media-management"></a>複数のメディア管理

FileX でサポートできる物理メディアの数に制限はありません。 各メディア インスタンスには、***fx_media_open*** の呼び出しで指定された、独自のメモリ領域と関連ドライバーがあります。 FileX の既定のディストリビューションには、簡単な RAM メディア ドライバーと、この RAM ディスクを使用するデモ システムが付属しています。

### <a name="logical-sector-cache"></a>論理セクター キャッシュ

FileX 論理セクター キャッシュによって、メディアとの間の両方向のセクター転送の数が減るため、パフォーマンスが大幅に向上します。 開かれているメディアごとに、FileX によって論理セクター キャッシュが保持されます。 論理セクター キャッシュの深さは、***fx_media_open*** API の呼び出しで FileX に提供されるメモリの量によって決まります。

### <a name="contiguous-file-support"></a>連続ファイルのサポート

FileX によって API サービス ***fx_file_allocate*** を通して連続したファイルのサポートが提供され、ファイル アクセス時間が向上して、決定論的になります。 このルーチンは、必要なメモリの量を受け取り、要求を満たす一連の隣接するクラスターを検索します。 そのようなクラスターが見つかった場合は、割り当て済みクラスターのファイル チェーンの一部にすることによって、事前に割り当てられます。 物理メディアを移動する場合、FileX の連続したファイルのサポートによってパフォーマンスが大幅に向上し、アクセス時間が決定論的になります。

### <a name="dynamic-creation"></a>動的作成

FileX を使用すると、システム リソースを動的に作成できます。 これは、アプリケーションに複数の構成要件または動的な構成要件がある場合に特に重要です。 さらに、使用できる FileX リソース (メディアまたはファイル) の数に、あらかじめ決められた制限はありません。 また、システム オブジェクトの数によってパフォーマンスが影響を受けることはありません。

## <a name="easy-to-use-api"></a>使いやすい API

FileX により、わかりやすく使いやすい方法で、非常に優れた深く埋め込まれたファイル システム テクノロジが提供されます。 FileX のアプリケーション プログラミング インターフェイス (API) を使用すると、サービスが直観的で一貫したものになります。 他のファイル システムではよくある "略語だらけ" のサービスを解読する必要はありません。

FileX バージョン 5 のサービスの完全な一覧については、「[付録 A](appendix-a.md)」を参照してください。

## <a name="exfat-support"></a>exFAT のサポート

exFAT (拡張ファイル アロケーション テーブル) は、Microsoft によって設計されたファイル システムであり、FAT32 ファイル システムによる 2 GB の制限を超えるファイル サイズが許可されます。 これは、容量が 32 GB を超える SD カードの既定のファイル システムです。 FileX exFAT 形式でフォーマットされた SD カードまたはフラッシュ ドライブは、Windows と互換性があります。 exFAT によって、最大 1 エクサバイト (EB) (約 10 億 GB) のファイル サイズがサポートされます。

exFAT を使用するユーザーは、シンボル ***FX_ENABLE_EXFAT** _ を定義して FileX ライブラリを再コンパイルする必要があります。 メディアを開くと、FileX によってメディアの種類が検出されます。 メディアが exFAT でフォーマットされている場合、FileX により exFAT 標準に従ってファイル システムの読み取りと書き込みが行われます。 新しいメディアを exFAT でフォーマットするには、サービス _*_fx_media_exFAT_format_** を使用します。 exFAT は既定では無効になっています。

## <a name="fault-tolerant-support"></a>フォールト トレラントのサポート

FileX のフォールト トレラント モジュールは、ファイルまたはディレクトリの更新中の中断によってファイル システムが破損しないように設計されています。 たとえば、ファイルにデータを追加する場合、FileX は、ファイルの内容、ディレクトリ エントリ、および場合によっては FAT エントリを更新する必要があります。 この更新シーケンスが中断された場合 (電源障害や、更新の途中でメディアが取り出された場合など)、ファイル システムが一貫性のない状態になり、ファイル システム全体の整合性に影響を与える可能性があります。これは、他のファイルの破損につながる可能性があります。

FileX のフォールト トレラント モジュールの機能によって、ファイルまたはディレクトリを更新する過程で必要なすべての手順が記録されます。 このログ エントリは、メディア上の FileX で検出してアクセスできる専用のセクター (ブロック) に格納されます。 ログ データの場所には、適切なファイル システムがなくてもアクセスできます。 したがって、ファイル システムが破損した場合でも、FileX でログ エントリを見つけて、ファイル システムを正常な状態に戻すことができます。

FileX によってファイルまたはディレクトリが更新されると、ログ エントリが作成されます。 更新操作が正常に完了すると、ログ エントリは削除されます。 ファイルの更新が正常に完了した後でログ エントリが適切に削除されず、復旧プロセスによって、ログ エントリの内容がファイル システムと一致すると判断された場合、実行する必要があることは何もなく、ログ エントリはクリーンアップできます。

ファイル システムの更新操作が中断された場合は、FileX で次にメディアがマウントされるときに、フォールト トレラント モジュールによってログ エントリが分析されます。 FileX は、ログ エントリ内の情報を使用して、ファイル システムに既に適用されている部分的な変更を取り消すことができます (ファイル更新操作の初期段階でエラーが発生した場合)。または、ログ エントリに再実行情報が含まれている場合は、FileX は前の操作を完了するために必要な変更を適用できます。

このフォールト トレラント機能は、FileX でサポートされているすべての FAT ファイル システム (FAT12、FAT16、FAT32、exFAT など) で使用できます。 既定では、FileX のフォールト トレラントは有効になっていません。 フォールト トレラント機能を有効にするには、シンボル **FX_ENABLE_FAULT_TOLERANT** と **FX_FAULT_TOLERANT** を定義して FileX をビルドする必要があります。 実行時には、アプリケーションにより **_fx_fault_tolerant_enable_** を呼び出すことにより、フォールト トレラント サービスが開始されます。
サービスが開始した後、ファイルとディレクトリのすべての書き込み操作は、フォールト トレラント モジュールを経由して行われます。

開始されたフォールト トレラント サービスにより、最初に、そのメディアがフォールト トレラント モジュールで保護されているかどうかが検出されます。 そうでない場合、ファイル システムの整合性の維持は FileX によって行われ、ファイル システムからログとキャッシュに使用される空きブロックが割り当てられて保護が開始されます。 ファイル システムにフォールト トレラント モジュールのログが見つかった場合は、そのログ エントリが分析されます。 ログ エントリの内容に応じて、FileX により、前の操作が元に戻されるか、前の操作がやり直されます。 以前のすべてのログ エントリが処理された後、ファイル システムは使用できるようになります。 これにより、FIleX が既知の正常な状態から開始することが保証されます。

FileX のフォールト トレラント モジュールによってメディアが保護されるようになった後、メディアは別のファイル システムでは更新されません。 それを行うと、ファイル システム上のログ エントリは、FAT テーブルのディレクトリ エントリの内容と整合性がなくなります。 フォールト トレラント モジュールによって FileX に戻される前に、別のファイル システムによってメディアが更新された場合、結果は未定義になります。

## <a name="callback-functions"></a>コールバック関数

次の 3 つのコールバック関数が FileX に追加されます。

- メディア オープン コールバック
- メディア クローズ コールバック
- ファイル書き込みコールバック

登録後は、そのようなイベントが発生すると、これらの関数によってアプリケーションに通知されます。

## <a name="easy-integration"></a>簡単な統合

FileX は、事実上すべての FLASH またはメディア デバイスと簡単に統合できます。 FileX の移植は簡単です。 このガイドでは、プロセスの詳細について説明します。また、手始めとしては、デモ システムの RAM ドライバーが最適です。
